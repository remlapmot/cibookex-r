<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12. IP Weighting and Marginal Structural Models | Causal Inference: What If. R and Stata code for Exercises</title>
  <meta name="description" content="Code examples from Causal Inference: What If by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="12. IP Weighting and Marginal Structural Models | Causal Inference: What If. R and Stata code for Exercises" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Code examples from Causal Inference: What If by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12. IP Weighting and Marginal Structural Models | Causal Inference: What If. R and Stata code for Exercises" />
  
  <meta name="twitter:description" content="Code examples from Causal Inference: What If by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

<meta name="author" content="Book by M. A. Hern치n and J. M. Robins" />
<meta name="author" content="R code by Joy Shi and Sean McGrath" />
<meta name="author" content="Stata code by Eleanor Murray and Roger Logan" />
<meta name="author" content="R Markdown code by Tom Palmer" />


<meta name="date" content="2023-11-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="why-model.html"/>
<link rel="next" href="standardization-and-the-parametric-g-formula.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Table of Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#downloading-the-code"><i class="fa fa-check"></i>Downloading the code</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installing-dependency-packages"><i class="fa fa-check"></i>Installing dependency packages</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#downloading-the-datasets"><i class="fa fa-check"></i>Downloading the datasets</a></li>
</ul></li>
<li class="part"><span><b>R code</b></span></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html"><i class="fa fa-check"></i>11. Why model?</a>
<ul>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.2"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.3"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.2"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.3"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.4"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.5"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.6"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.7"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula</a>
<ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.2"><i class="fa fa-check"></i>Program 13.2</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.3"><i class="fa fa-check"></i>Program 13.3</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.4"><i class="fa fa-check"></i>Program 13.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.1"><i class="fa fa-check"></i>Program 14.1</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.2"><i class="fa fa-check"></i>Program 14.2</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-one-possible-value-of-psi"><i class="fa fa-check"></i>G-estimation: Checking one possible value of psi</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-multiple-possible-values-of-psi"><i class="fa fa-check"></i>G-estimation: Checking multiple possible values of psi</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.3"><i class="fa fa-check"></i>Program 14.3</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-linear-mean-models"><i class="fa fa-check"></i>G-estimation: Closed form estimator linear mean models</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-for-2-parameter-model"><i class="fa fa-check"></i>G-estimation: Closed form estimator for 2-parameter model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores</a>
<ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.1"><i class="fa fa-check"></i>Program 15.1</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.2"><i class="fa fa-check"></i>Program 15.2</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.3"><i class="fa fa-check"></i>Program 15.3</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.4"><i class="fa fa-check"></i>Program 15.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html"><i class="fa fa-check"></i>16. Instrumental variables estimation</a>
<ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.1"><i class="fa fa-check"></i>Program 16.1</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.2"><i class="fa fa-check"></i>Program 16.2</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.3"><i class="fa fa-check"></i>Program 16.3</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.4"><i class="fa fa-check"></i>Program 16.4</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.5"><i class="fa fa-check"></i>Program 16.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html"><i class="fa fa-check"></i>17. Causal survival analysis</a>
<ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.1"><i class="fa fa-check"></i>Program 17.1</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.2"><i class="fa fa-check"></i>Program 17.2</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.3"><i class="fa fa-check"></i>Program 17.3</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.4"><i class="fa fa-check"></i>Program 17.4</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.5"><i class="fa fa-check"></i>Program 17.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-information-r.html"><a href="session-information-r.html"><i class="fa fa-check"></i>Session information: R</a></li>
<li class="part"><span><b>Stata code</b></span></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html"><i class="fa fa-check"></i>11. Why model: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.1-1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.2-1"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.3-1"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.1-1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.2-1"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.3-1"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.4-1"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.5-1"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.6-1"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.7-1"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.1-1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.2-1"><i class="fa fa-check"></i>Program 13.2</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.3-1"><i class="fa fa-check"></i>Program 13.3</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.4-1"><i class="fa fa-check"></i>Program 13.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.1-1"><i class="fa fa-check"></i>Program 14.1</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.2-1"><i class="fa fa-check"></i>Program 14.2</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.3-1"><i class="fa fa-check"></i>Program 14.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.1-1"><i class="fa fa-check"></i>Program 15.1</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#prorgam-15.2"><i class="fa fa-check"></i>Prorgam 15.2</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.3-1"><i class="fa fa-check"></i>Program 15.3</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.4-1"><i class="fa fa-check"></i>Program 15.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html"><i class="fa fa-check"></i>16. Instrumental variables estimation: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.1-1"><i class="fa fa-check"></i>Program 16.1</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.2-1"><i class="fa fa-check"></i>Program 16.2</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.3-1"><i class="fa fa-check"></i>Program 16.3</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.4-1"><i class="fa fa-check"></i>Program 16.4</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.5-1"><i class="fa fa-check"></i>Program 16.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html"><i class="fa fa-check"></i>17. Causal survival analysis: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.1-1"><i class="fa fa-check"></i>Program 17.1</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.2-1"><i class="fa fa-check"></i>Program 17.2</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.3-1"><i class="fa fa-check"></i>Program 17.3</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.4-1"><i class="fa fa-check"></i>Program 17.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-information-stata.html"><a href="session-information-stata.html"><i class="fa fa-check"></i>Session information: Stata</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Causal Inference: What If. R and Stata code for Exercises</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ip-weighting-and-marginal-structural-models" class="section level1 unnumbered hasAnchor">
<h1>12. IP Weighting and Marginal Structural Models<a href="ip-weighting-and-marginal-structural-models.html#ip-weighting-and-marginal-structural-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="program-12.1" class="section level2 hasAnchor">
<h2>Program 12.1<a href="ip-weighting-and-marginal-structural-models.html#program-12.1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Descriptive statistics from NHEFS data (Table 12.1)</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="ip-weighting-and-marginal-structural-models.html#cb10-1" tabindex="-1"></a><span class="fu">library</span>(here)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="ip-weighting-and-marginal-structural-models.html#cb11-1" tabindex="-1"></a><span class="co"># install.packages(&quot;readxl&quot;) # install package if required</span></span>
<span id="cb11-2"><a href="ip-weighting-and-marginal-structural-models.html#cb11-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;readxl&quot;</span>)</span>
<span id="cb11-3"><a href="ip-weighting-and-marginal-structural-models.html#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="ip-weighting-and-marginal-structural-models.html#cb11-4" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;NHEFS.xls&quot;</span>))</span>
<span id="cb11-5"><a href="ip-weighting-and-marginal-structural-models.html#cb11-5" tabindex="-1"></a>nhefs<span class="sc">$</span>cens <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(nhefs<span class="sc">$</span>wt82), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb11-6"><a href="ip-weighting-and-marginal-structural-models.html#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="ip-weighting-and-marginal-structural-models.html#cb11-7" tabindex="-1"></a><span class="co"># provisionally ignore subjects with missing values for weight in 1982</span></span>
<span id="cb11-8"><a href="ip-weighting-and-marginal-structural-models.html#cb11-8" tabindex="-1"></a>nhefs.nmv <span class="ot">&lt;-</span></span>
<span id="cb11-9"><a href="ip-weighting-and-marginal-structural-models.html#cb11-9" tabindex="-1"></a>  nhefs[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(nhefs<span class="sc">$</span>wt82)),] </span>
<span id="cb11-10"><a href="ip-weighting-and-marginal-structural-models.html#cb11-10" tabindex="-1"></a></span>
<span id="cb11-11"><a href="ip-weighting-and-marginal-structural-models.html#cb11-11" tabindex="-1"></a><span class="fu">lm</span>(wt82_71 <span class="sc">~</span> qsmk, <span class="at">data =</span> nhefs.nmv)</span>
<span id="cb11-12"><a href="ip-weighting-and-marginal-structural-models.html#cb11-12" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-13"><a href="ip-weighting-and-marginal-structural-models.html#cb11-13" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb11-14"><a href="ip-weighting-and-marginal-structural-models.html#cb11-14" tabindex="-1"></a><span class="do">## lm(formula = wt82_71 ~ qsmk, data = nhefs.nmv)</span></span>
<span id="cb11-15"><a href="ip-weighting-and-marginal-structural-models.html#cb11-15" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-16"><a href="ip-weighting-and-marginal-structural-models.html#cb11-16" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb11-17"><a href="ip-weighting-and-marginal-structural-models.html#cb11-17" tabindex="-1"></a><span class="do">## (Intercept)         qsmk  </span></span>
<span id="cb11-18"><a href="ip-weighting-and-marginal-structural-models.html#cb11-18" tabindex="-1"></a><span class="do">##       1.984        2.541</span></span>
<span id="cb11-19"><a href="ip-weighting-and-marginal-structural-models.html#cb11-19" tabindex="-1"></a><span class="co"># Smoking cessation</span></span>
<span id="cb11-20"><a href="ip-weighting-and-marginal-structural-models.html#cb11-20" tabindex="-1"></a><span class="fu">predict</span>(<span class="fu">lm</span>(wt82_71 <span class="sc">~</span> qsmk, <span class="at">data =</span> nhefs.nmv), <span class="fu">data.frame</span>(<span class="at">qsmk =</span> <span class="dv">1</span>))</span>
<span id="cb11-21"><a href="ip-weighting-and-marginal-structural-models.html#cb11-21" tabindex="-1"></a><span class="do">##        1 </span></span>
<span id="cb11-22"><a href="ip-weighting-and-marginal-structural-models.html#cb11-22" tabindex="-1"></a><span class="do">## 4.525079</span></span>
<span id="cb11-23"><a href="ip-weighting-and-marginal-structural-models.html#cb11-23" tabindex="-1"></a><span class="co"># No smoking cessation</span></span>
<span id="cb11-24"><a href="ip-weighting-and-marginal-structural-models.html#cb11-24" tabindex="-1"></a><span class="fu">predict</span>(<span class="fu">lm</span>(wt82_71 <span class="sc">~</span> qsmk, <span class="at">data =</span> nhefs.nmv), <span class="fu">data.frame</span>(<span class="at">qsmk =</span> <span class="dv">0</span>)) </span>
<span id="cb11-25"><a href="ip-weighting-and-marginal-structural-models.html#cb11-25" tabindex="-1"></a><span class="do">##        1 </span></span>
<span id="cb11-26"><a href="ip-weighting-and-marginal-structural-models.html#cb11-26" tabindex="-1"></a><span class="do">## 1.984498</span></span>
<span id="cb11-27"><a href="ip-weighting-and-marginal-structural-models.html#cb11-27" tabindex="-1"></a></span>
<span id="cb11-28"><a href="ip-weighting-and-marginal-structural-models.html#cb11-28" tabindex="-1"></a><span class="co"># Table</span></span>
<span id="cb11-29"><a href="ip-weighting-and-marginal-structural-models.html#cb11-29" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv[<span class="fu">which</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">0</span>),]<span class="sc">$</span>age)</span>
<span id="cb11-30"><a href="ip-weighting-and-marginal-structural-models.html#cb11-30" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb11-31"><a href="ip-weighting-and-marginal-structural-models.html#cb11-31" tabindex="-1"></a><span class="do">##   25.00   33.00   42.00   42.79   51.00   72.00</span></span>
<span id="cb11-32"><a href="ip-weighting-and-marginal-structural-models.html#cb11-32" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv[<span class="fu">which</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">0</span>),]<span class="sc">$</span>wt71)</span>
<span id="cb11-33"><a href="ip-weighting-and-marginal-structural-models.html#cb11-33" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb11-34"><a href="ip-weighting-and-marginal-structural-models.html#cb11-34" tabindex="-1"></a><span class="do">##   40.82   59.19   68.49   70.30   79.38  151.73</span></span>
<span id="cb11-35"><a href="ip-weighting-and-marginal-structural-models.html#cb11-35" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv[<span class="fu">which</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">0</span>),]<span class="sc">$</span>smokeintensity)</span>
<span id="cb11-36"><a href="ip-weighting-and-marginal-structural-models.html#cb11-36" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb11-37"><a href="ip-weighting-and-marginal-structural-models.html#cb11-37" tabindex="-1"></a><span class="do">##    1.00   15.00   20.00   21.19   30.00   60.00</span></span>
<span id="cb11-38"><a href="ip-weighting-and-marginal-structural-models.html#cb11-38" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv[<span class="fu">which</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">0</span>),]<span class="sc">$</span>smokeyrs)</span>
<span id="cb11-39"><a href="ip-weighting-and-marginal-structural-models.html#cb11-39" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb11-40"><a href="ip-weighting-and-marginal-structural-models.html#cb11-40" tabindex="-1"></a><span class="do">##    1.00   15.00   23.00   24.09   32.00   64.00</span></span>
<span id="cb11-41"><a href="ip-weighting-and-marginal-structural-models.html#cb11-41" tabindex="-1"></a></span>
<span id="cb11-42"><a href="ip-weighting-and-marginal-structural-models.html#cb11-42" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv[<span class="fu">which</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">1</span>),]<span class="sc">$</span>age)</span>
<span id="cb11-43"><a href="ip-weighting-and-marginal-structural-models.html#cb11-43" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb11-44"><a href="ip-weighting-and-marginal-structural-models.html#cb11-44" tabindex="-1"></a><span class="do">##   25.00   35.00   46.00   46.17   56.00   74.00</span></span>
<span id="cb11-45"><a href="ip-weighting-and-marginal-structural-models.html#cb11-45" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv[<span class="fu">which</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">1</span>),]<span class="sc">$</span>wt71)</span>
<span id="cb11-46"><a href="ip-weighting-and-marginal-structural-models.html#cb11-46" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb11-47"><a href="ip-weighting-and-marginal-structural-models.html#cb11-47" tabindex="-1"></a><span class="do">##   39.58   60.67   71.21   72.35   81.08  136.98</span></span>
<span id="cb11-48"><a href="ip-weighting-and-marginal-structural-models.html#cb11-48" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv[<span class="fu">which</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">1</span>),]<span class="sc">$</span>smokeintensity)</span>
<span id="cb11-49"><a href="ip-weighting-and-marginal-structural-models.html#cb11-49" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb11-50"><a href="ip-weighting-and-marginal-structural-models.html#cb11-50" tabindex="-1"></a><span class="do">##     1.0    10.0    20.0    18.6    25.0    80.0</span></span>
<span id="cb11-51"><a href="ip-weighting-and-marginal-structural-models.html#cb11-51" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv[<span class="fu">which</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">1</span>),]<span class="sc">$</span>smokeyrs)</span>
<span id="cb11-52"><a href="ip-weighting-and-marginal-structural-models.html#cb11-52" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb11-53"><a href="ip-weighting-and-marginal-structural-models.html#cb11-53" tabindex="-1"></a><span class="do">##    1.00   15.00   26.00   26.03   35.00   60.00</span></span>
<span id="cb11-54"><a href="ip-weighting-and-marginal-structural-models.html#cb11-54" tabindex="-1"></a></span>
<span id="cb11-55"><a href="ip-weighting-and-marginal-structural-models.html#cb11-55" tabindex="-1"></a><span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>sex)</span>
<span id="cb11-56"><a href="ip-weighting-and-marginal-structural-models.html#cb11-56" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-57"><a href="ip-weighting-and-marginal-structural-models.html#cb11-57" tabindex="-1"></a><span class="do">##       0   1</span></span>
<span id="cb11-58"><a href="ip-weighting-and-marginal-structural-models.html#cb11-58" tabindex="-1"></a><span class="do">##   0 542 621</span></span>
<span id="cb11-59"><a href="ip-weighting-and-marginal-structural-models.html#cb11-59" tabindex="-1"></a><span class="do">##   1 220 183</span></span>
<span id="cb11-60"><a href="ip-weighting-and-marginal-structural-models.html#cb11-60" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>sex), <span class="dv">1</span>)</span>
<span id="cb11-61"><a href="ip-weighting-and-marginal-structural-models.html#cb11-61" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-62"><a href="ip-weighting-and-marginal-structural-models.html#cb11-62" tabindex="-1"></a><span class="do">##             0         1</span></span>
<span id="cb11-63"><a href="ip-weighting-and-marginal-structural-models.html#cb11-63" tabindex="-1"></a><span class="do">##   0 0.4660361 0.5339639</span></span>
<span id="cb11-64"><a href="ip-weighting-and-marginal-structural-models.html#cb11-64" tabindex="-1"></a><span class="do">##   1 0.5459057 0.4540943</span></span>
<span id="cb11-65"><a href="ip-weighting-and-marginal-structural-models.html#cb11-65" tabindex="-1"></a></span>
<span id="cb11-66"><a href="ip-weighting-and-marginal-structural-models.html#cb11-66" tabindex="-1"></a><span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>race)</span>
<span id="cb11-67"><a href="ip-weighting-and-marginal-structural-models.html#cb11-67" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-68"><a href="ip-weighting-and-marginal-structural-models.html#cb11-68" tabindex="-1"></a><span class="do">##       0   1</span></span>
<span id="cb11-69"><a href="ip-weighting-and-marginal-structural-models.html#cb11-69" tabindex="-1"></a><span class="do">##   0 993 170</span></span>
<span id="cb11-70"><a href="ip-weighting-and-marginal-structural-models.html#cb11-70" tabindex="-1"></a><span class="do">##   1 367  36</span></span>
<span id="cb11-71"><a href="ip-weighting-and-marginal-structural-models.html#cb11-71" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>race), <span class="dv">1</span>)</span>
<span id="cb11-72"><a href="ip-weighting-and-marginal-structural-models.html#cb11-72" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-73"><a href="ip-weighting-and-marginal-structural-models.html#cb11-73" tabindex="-1"></a><span class="do">##              0          1</span></span>
<span id="cb11-74"><a href="ip-weighting-and-marginal-structural-models.html#cb11-74" tabindex="-1"></a><span class="do">##   0 0.85382631 0.14617369</span></span>
<span id="cb11-75"><a href="ip-weighting-and-marginal-structural-models.html#cb11-75" tabindex="-1"></a><span class="do">##   1 0.91066998 0.08933002</span></span>
<span id="cb11-76"><a href="ip-weighting-and-marginal-structural-models.html#cb11-76" tabindex="-1"></a></span>
<span id="cb11-77"><a href="ip-weighting-and-marginal-structural-models.html#cb11-77" tabindex="-1"></a><span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>education)</span>
<span id="cb11-78"><a href="ip-weighting-and-marginal-structural-models.html#cb11-78" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-79"><a href="ip-weighting-and-marginal-structural-models.html#cb11-79" tabindex="-1"></a><span class="do">##       1   2   3   4   5</span></span>
<span id="cb11-80"><a href="ip-weighting-and-marginal-structural-models.html#cb11-80" tabindex="-1"></a><span class="do">##   0 210 266 480  92 115</span></span>
<span id="cb11-81"><a href="ip-weighting-and-marginal-structural-models.html#cb11-81" tabindex="-1"></a><span class="do">##   1  81  74 157  29  62</span></span>
<span id="cb11-82"><a href="ip-weighting-and-marginal-structural-models.html#cb11-82" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>education), <span class="dv">1</span>)</span>
<span id="cb11-83"><a href="ip-weighting-and-marginal-structural-models.html#cb11-83" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-84"><a href="ip-weighting-and-marginal-structural-models.html#cb11-84" tabindex="-1"></a><span class="do">##              1          2          3          4          5</span></span>
<span id="cb11-85"><a href="ip-weighting-and-marginal-structural-models.html#cb11-85" tabindex="-1"></a><span class="do">##   0 0.18056750 0.22871883 0.41272571 0.07910576 0.09888220</span></span>
<span id="cb11-86"><a href="ip-weighting-and-marginal-structural-models.html#cb11-86" tabindex="-1"></a><span class="do">##   1 0.20099256 0.18362283 0.38957816 0.07196030 0.15384615</span></span>
<span id="cb11-87"><a href="ip-weighting-and-marginal-structural-models.html#cb11-87" tabindex="-1"></a></span>
<span id="cb11-88"><a href="ip-weighting-and-marginal-structural-models.html#cb11-88" tabindex="-1"></a><span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>exercise)</span>
<span id="cb11-89"><a href="ip-weighting-and-marginal-structural-models.html#cb11-89" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-90"><a href="ip-weighting-and-marginal-structural-models.html#cb11-90" tabindex="-1"></a><span class="do">##       0   1   2</span></span>
<span id="cb11-91"><a href="ip-weighting-and-marginal-structural-models.html#cb11-91" tabindex="-1"></a><span class="do">##   0 237 485 441</span></span>
<span id="cb11-92"><a href="ip-weighting-and-marginal-structural-models.html#cb11-92" tabindex="-1"></a><span class="do">##   1  63 176 164</span></span>
<span id="cb11-93"><a href="ip-weighting-and-marginal-structural-models.html#cb11-93" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>exercise), <span class="dv">1</span>)</span>
<span id="cb11-94"><a href="ip-weighting-and-marginal-structural-models.html#cb11-94" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-95"><a href="ip-weighting-and-marginal-structural-models.html#cb11-95" tabindex="-1"></a><span class="do">##             0         1         2</span></span>
<span id="cb11-96"><a href="ip-weighting-and-marginal-structural-models.html#cb11-96" tabindex="-1"></a><span class="do">##   0 0.2037833 0.4170249 0.3791917</span></span>
<span id="cb11-97"><a href="ip-weighting-and-marginal-structural-models.html#cb11-97" tabindex="-1"></a><span class="do">##   1 0.1563275 0.4367246 0.4069479</span></span>
<span id="cb11-98"><a href="ip-weighting-and-marginal-structural-models.html#cb11-98" tabindex="-1"></a></span>
<span id="cb11-99"><a href="ip-weighting-and-marginal-structural-models.html#cb11-99" tabindex="-1"></a><span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>active)</span>
<span id="cb11-100"><a href="ip-weighting-and-marginal-structural-models.html#cb11-100" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-101"><a href="ip-weighting-and-marginal-structural-models.html#cb11-101" tabindex="-1"></a><span class="do">##       0   1   2</span></span>
<span id="cb11-102"><a href="ip-weighting-and-marginal-structural-models.html#cb11-102" tabindex="-1"></a><span class="do">##   0 532 527 104</span></span>
<span id="cb11-103"><a href="ip-weighting-and-marginal-structural-models.html#cb11-103" tabindex="-1"></a><span class="do">##   1 170 188  45</span></span>
<span id="cb11-104"><a href="ip-weighting-and-marginal-structural-models.html#cb11-104" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>active), <span class="dv">1</span>)</span>
<span id="cb11-105"><a href="ip-weighting-and-marginal-structural-models.html#cb11-105" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb11-106"><a href="ip-weighting-and-marginal-structural-models.html#cb11-106" tabindex="-1"></a><span class="do">##             0         1         2</span></span>
<span id="cb11-107"><a href="ip-weighting-and-marginal-structural-models.html#cb11-107" tabindex="-1"></a><span class="do">##   0 0.4574377 0.4531384 0.0894239</span></span>
<span id="cb11-108"><a href="ip-weighting-and-marginal-structural-models.html#cb11-108" tabindex="-1"></a><span class="do">##   1 0.4218362 0.4665012 0.1116625</span></span></code></pre></div>
</div>
<div id="program-12.2" class="section level2 hasAnchor">
<h2>Program 12.2<a href="ip-weighting-and-marginal-structural-models.html#program-12.2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating IP weights</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="ip-weighting-and-marginal-structural-models.html#cb12-1" tabindex="-1"></a><span class="co"># Estimation of ip weights via a logistic model</span></span>
<span id="cb12-2"><a href="ip-weighting-and-marginal-structural-models.html#cb12-2" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb12-3"><a href="ip-weighting-and-marginal-structural-models.html#cb12-3" tabindex="-1"></a>  qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="ip-weighting-and-marginal-structural-models.html#cb12-4" tabindex="-1"></a>    <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span></span>
<span id="cb12-5"><a href="ip-weighting-and-marginal-structural-models.html#cb12-5" tabindex="-1"></a>    <span class="fu">I</span>(smokeintensity <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="ip-weighting-and-marginal-structural-models.html#cb12-6" tabindex="-1"></a>    <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71 <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb12-7"><a href="ip-weighting-and-marginal-structural-models.html#cb12-7" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb12-8"><a href="ip-weighting-and-marginal-structural-models.html#cb12-8" tabindex="-1"></a>  <span class="at">data =</span> nhefs.nmv</span>
<span id="cb12-9"><a href="ip-weighting-and-marginal-structural-models.html#cb12-9" tabindex="-1"></a>)</span>
<span id="cb12-10"><a href="ip-weighting-and-marginal-structural-models.html#cb12-10" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb12-11"><a href="ip-weighting-and-marginal-structural-models.html#cb12-11" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-12"><a href="ip-weighting-and-marginal-structural-models.html#cb12-12" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb12-13"><a href="ip-weighting-and-marginal-structural-models.html#cb12-13" tabindex="-1"></a><span class="do">## glm(formula = qsmk ~ sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span id="cb12-14"><a href="ip-weighting-and-marginal-structural-models.html#cb12-14" tabindex="-1"></a><span class="do">##     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span id="cb12-15"><a href="ip-weighting-and-marginal-structural-models.html#cb12-15" tabindex="-1"></a><span class="do">##     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2), </span></span>
<span id="cb12-16"><a href="ip-weighting-and-marginal-structural-models.html#cb12-16" tabindex="-1"></a><span class="do">##     family = binomial(), data = nhefs.nmv)</span></span>
<span id="cb12-17"><a href="ip-weighting-and-marginal-structural-models.html#cb12-17" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-18"><a href="ip-weighting-and-marginal-structural-models.html#cb12-18" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb12-19"><a href="ip-weighting-and-marginal-structural-models.html#cb12-19" tabindex="-1"></a><span class="do">##                         Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb12-20"><a href="ip-weighting-and-marginal-structural-models.html#cb12-20" tabindex="-1"></a><span class="do">## (Intercept)           -2.2425191  1.3808360  -1.624 0.104369    </span></span>
<span id="cb12-21"><a href="ip-weighting-and-marginal-structural-models.html#cb12-21" tabindex="-1"></a><span class="do">## sex                   -0.5274782  0.1540496  -3.424 0.000617 ***</span></span>
<span id="cb12-22"><a href="ip-weighting-and-marginal-structural-models.html#cb12-22" tabindex="-1"></a><span class="do">## race                  -0.8392636  0.2100665  -3.995 6.46e-05 ***</span></span>
<span id="cb12-23"><a href="ip-weighting-and-marginal-structural-models.html#cb12-23" tabindex="-1"></a><span class="do">## age                    0.1212052  0.0512663   2.364 0.018068 *  </span></span>
<span id="cb12-24"><a href="ip-weighting-and-marginal-structural-models.html#cb12-24" tabindex="-1"></a><span class="do">## I(age^2)              -0.0008246  0.0005361  -1.538 0.124039    </span></span>
<span id="cb12-25"><a href="ip-weighting-and-marginal-structural-models.html#cb12-25" tabindex="-1"></a><span class="do">## as.factor(education)2 -0.0287755  0.1983506  -0.145 0.884653    </span></span>
<span id="cb12-26"><a href="ip-weighting-and-marginal-structural-models.html#cb12-26" tabindex="-1"></a><span class="do">## as.factor(education)3  0.0864318  0.1780850   0.485 0.627435    </span></span>
<span id="cb12-27"><a href="ip-weighting-and-marginal-structural-models.html#cb12-27" tabindex="-1"></a><span class="do">## as.factor(education)4  0.0636010  0.2732108   0.233 0.815924    </span></span>
<span id="cb12-28"><a href="ip-weighting-and-marginal-structural-models.html#cb12-28" tabindex="-1"></a><span class="do">## as.factor(education)5  0.4759606  0.2262237   2.104 0.035384 *  </span></span>
<span id="cb12-29"><a href="ip-weighting-and-marginal-structural-models.html#cb12-29" tabindex="-1"></a><span class="do">## smokeintensity        -0.0772704  0.0152499  -5.067 4.04e-07 ***</span></span>
<span id="cb12-30"><a href="ip-weighting-and-marginal-structural-models.html#cb12-30" tabindex="-1"></a><span class="do">## I(smokeintensity^2)    0.0010451  0.0002866   3.647 0.000265 ***</span></span>
<span id="cb12-31"><a href="ip-weighting-and-marginal-structural-models.html#cb12-31" tabindex="-1"></a><span class="do">## smokeyrs              -0.0735966  0.0277775  -2.650 0.008061 ** </span></span>
<span id="cb12-32"><a href="ip-weighting-and-marginal-structural-models.html#cb12-32" tabindex="-1"></a><span class="do">## I(smokeyrs^2)          0.0008441  0.0004632   1.822 0.068398 .  </span></span>
<span id="cb12-33"><a href="ip-weighting-and-marginal-structural-models.html#cb12-33" tabindex="-1"></a><span class="do">## as.factor(exercise)1   0.3548405  0.1801351   1.970 0.048855 *  </span></span>
<span id="cb12-34"><a href="ip-weighting-and-marginal-structural-models.html#cb12-34" tabindex="-1"></a><span class="do">## as.factor(exercise)2   0.3957040  0.1872400   2.113 0.034571 *  </span></span>
<span id="cb12-35"><a href="ip-weighting-and-marginal-structural-models.html#cb12-35" tabindex="-1"></a><span class="do">## as.factor(active)1     0.0319445  0.1329372   0.240 0.810100    </span></span>
<span id="cb12-36"><a href="ip-weighting-and-marginal-structural-models.html#cb12-36" tabindex="-1"></a><span class="do">## as.factor(active)2     0.1767840  0.2149720   0.822 0.410873    </span></span>
<span id="cb12-37"><a href="ip-weighting-and-marginal-structural-models.html#cb12-37" tabindex="-1"></a><span class="do">## wt71                  -0.0152357  0.0263161  -0.579 0.562625    </span></span>
<span id="cb12-38"><a href="ip-weighting-and-marginal-structural-models.html#cb12-38" tabindex="-1"></a><span class="do">## I(wt71^2)              0.0001352  0.0001632   0.829 0.407370    </span></span>
<span id="cb12-39"><a href="ip-weighting-and-marginal-structural-models.html#cb12-39" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb12-40"><a href="ip-weighting-and-marginal-structural-models.html#cb12-40" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb12-41"><a href="ip-weighting-and-marginal-structural-models.html#cb12-41" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-42"><a href="ip-weighting-and-marginal-structural-models.html#cb12-42" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb12-43"><a href="ip-weighting-and-marginal-structural-models.html#cb12-43" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-44"><a href="ip-weighting-and-marginal-structural-models.html#cb12-44" tabindex="-1"></a><span class="do">##     Null deviance: 1786.1  on 1565  degrees of freedom</span></span>
<span id="cb12-45"><a href="ip-weighting-and-marginal-structural-models.html#cb12-45" tabindex="-1"></a><span class="do">## Residual deviance: 1676.9  on 1547  degrees of freedom</span></span>
<span id="cb12-46"><a href="ip-weighting-and-marginal-structural-models.html#cb12-46" tabindex="-1"></a><span class="do">## AIC: 1714.9</span></span>
<span id="cb12-47"><a href="ip-weighting-and-marginal-structural-models.html#cb12-47" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-48"><a href="ip-weighting-and-marginal-structural-models.html#cb12-48" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb12-49"><a href="ip-weighting-and-marginal-structural-models.html#cb12-49" tabindex="-1"></a></span>
<span id="cb12-50"><a href="ip-weighting-and-marginal-structural-models.html#cb12-50" tabindex="-1"></a>p.qsmk.obs <span class="ot">&lt;-</span></span>
<span id="cb12-51"><a href="ip-weighting-and-marginal-structural-models.html#cb12-51" tabindex="-1"></a>  <span class="fu">ifelse</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb12-52"><a href="ip-weighting-and-marginal-structural-models.html#cb12-52" tabindex="-1"></a>         <span class="dv">1</span> <span class="sc">-</span> <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb12-53"><a href="ip-weighting-and-marginal-structural-models.html#cb12-53" tabindex="-1"></a>         <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>))</span>
<span id="cb12-54"><a href="ip-weighting-and-marginal-structural-models.html#cb12-54" tabindex="-1"></a></span>
<span id="cb12-55"><a href="ip-weighting-and-marginal-structural-models.html#cb12-55" tabindex="-1"></a>nhefs.nmv<span class="sc">$</span>w <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> p.qsmk.obs</span>
<span id="cb12-56"><a href="ip-weighting-and-marginal-structural-models.html#cb12-56" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv<span class="sc">$</span>w)</span>
<span id="cb12-57"><a href="ip-weighting-and-marginal-structural-models.html#cb12-57" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb12-58"><a href="ip-weighting-and-marginal-structural-models.html#cb12-58" tabindex="-1"></a><span class="do">##   1.054   1.230   1.373   1.996   1.990  16.700</span></span>
<span id="cb12-59"><a href="ip-weighting-and-marginal-structural-models.html#cb12-59" tabindex="-1"></a><span class="fu">sd</span>(nhefs.nmv<span class="sc">$</span>w)</span>
<span id="cb12-60"><a href="ip-weighting-and-marginal-structural-models.html#cb12-60" tabindex="-1"></a><span class="do">## [1] 1.474787</span></span>
<span id="cb12-61"><a href="ip-weighting-and-marginal-structural-models.html#cb12-61" tabindex="-1"></a></span>
<span id="cb12-62"><a href="ip-weighting-and-marginal-structural-models.html#cb12-62" tabindex="-1"></a><span class="co"># install.packages(&quot;geepack&quot;) # install package if required</span></span>
<span id="cb12-63"><a href="ip-weighting-and-marginal-structural-models.html#cb12-63" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;geepack&quot;</span>)</span>
<span id="cb12-64"><a href="ip-weighting-and-marginal-structural-models.html#cb12-64" tabindex="-1"></a>msm.w <span class="ot">&lt;-</span> <span class="fu">geeglm</span>(</span>
<span id="cb12-65"><a href="ip-weighting-and-marginal-structural-models.html#cb12-65" tabindex="-1"></a>  wt82_71 <span class="sc">~</span> qsmk,</span>
<span id="cb12-66"><a href="ip-weighting-and-marginal-structural-models.html#cb12-66" tabindex="-1"></a>  <span class="at">data =</span> nhefs.nmv,</span>
<span id="cb12-67"><a href="ip-weighting-and-marginal-structural-models.html#cb12-67" tabindex="-1"></a>  <span class="at">weights =</span> w,</span>
<span id="cb12-68"><a href="ip-weighting-and-marginal-structural-models.html#cb12-68" tabindex="-1"></a>  <span class="at">id =</span> seqn,</span>
<span id="cb12-69"><a href="ip-weighting-and-marginal-structural-models.html#cb12-69" tabindex="-1"></a>  <span class="at">corstr =</span> <span class="st">&quot;independence&quot;</span></span>
<span id="cb12-70"><a href="ip-weighting-and-marginal-structural-models.html#cb12-70" tabindex="-1"></a>)</span>
<span id="cb12-71"><a href="ip-weighting-and-marginal-structural-models.html#cb12-71" tabindex="-1"></a><span class="fu">summary</span>(msm.w)</span>
<span id="cb12-72"><a href="ip-weighting-and-marginal-structural-models.html#cb12-72" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-73"><a href="ip-weighting-and-marginal-structural-models.html#cb12-73" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb12-74"><a href="ip-weighting-and-marginal-structural-models.html#cb12-74" tabindex="-1"></a><span class="do">## geeglm(formula = wt82_71 ~ qsmk, data = nhefs.nmv, weights = w, </span></span>
<span id="cb12-75"><a href="ip-weighting-and-marginal-structural-models.html#cb12-75" tabindex="-1"></a><span class="do">##     id = seqn, corstr = &quot;independence&quot;)</span></span>
<span id="cb12-76"><a href="ip-weighting-and-marginal-structural-models.html#cb12-76" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-77"><a href="ip-weighting-and-marginal-structural-models.html#cb12-77" tabindex="-1"></a><span class="do">##  Coefficients:</span></span>
<span id="cb12-78"><a href="ip-weighting-and-marginal-structural-models.html#cb12-78" tabindex="-1"></a><span class="do">##             Estimate Std.err  Wald Pr(&gt;|W|)    </span></span>
<span id="cb12-79"><a href="ip-weighting-and-marginal-structural-models.html#cb12-79" tabindex="-1"></a><span class="do">## (Intercept)   1.7800  0.2247 62.73 2.33e-15 ***</span></span>
<span id="cb12-80"><a href="ip-weighting-and-marginal-structural-models.html#cb12-80" tabindex="-1"></a><span class="do">## qsmk          3.4405  0.5255 42.87 5.86e-11 ***</span></span>
<span id="cb12-81"><a href="ip-weighting-and-marginal-structural-models.html#cb12-81" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb12-82"><a href="ip-weighting-and-marginal-structural-models.html#cb12-82" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb12-83"><a href="ip-weighting-and-marginal-structural-models.html#cb12-83" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-84"><a href="ip-weighting-and-marginal-structural-models.html#cb12-84" tabindex="-1"></a><span class="do">## Correlation structure = independence </span></span>
<span id="cb12-85"><a href="ip-weighting-and-marginal-structural-models.html#cb12-85" tabindex="-1"></a><span class="do">## Estimated Scale Parameters:</span></span>
<span id="cb12-86"><a href="ip-weighting-and-marginal-structural-models.html#cb12-86" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-87"><a href="ip-weighting-and-marginal-structural-models.html#cb12-87" tabindex="-1"></a><span class="do">##             Estimate Std.err</span></span>
<span id="cb12-88"><a href="ip-weighting-and-marginal-structural-models.html#cb12-88" tabindex="-1"></a><span class="do">## (Intercept)    65.06   4.221</span></span>
<span id="cb12-89"><a href="ip-weighting-and-marginal-structural-models.html#cb12-89" tabindex="-1"></a><span class="do">## Number of clusters:   1566  Maximum cluster size: 1</span></span>
<span id="cb12-90"><a href="ip-weighting-and-marginal-structural-models.html#cb12-90" tabindex="-1"></a></span>
<span id="cb12-91"><a href="ip-weighting-and-marginal-structural-models.html#cb12-91" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(msm.w)</span>
<span id="cb12-92"><a href="ip-weighting-and-marginal-structural-models.html#cb12-92" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(msm.w))[, <span class="dv">2</span>]</span>
<span id="cb12-93"><a href="ip-weighting-and-marginal-structural-models.html#cb12-93" tabindex="-1"></a>lcl <span class="ot">&lt;-</span> beta <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb12-94"><a href="ip-weighting-and-marginal-structural-models.html#cb12-94" tabindex="-1"></a>ucl <span class="ot">&lt;-</span> beta <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb12-95"><a href="ip-weighting-and-marginal-structural-models.html#cb12-95" tabindex="-1"></a><span class="fu">cbind</span>(beta, lcl, ucl)</span>
<span id="cb12-96"><a href="ip-weighting-and-marginal-structural-models.html#cb12-96" tabindex="-1"></a><span class="do">##              beta   lcl  ucl</span></span>
<span id="cb12-97"><a href="ip-weighting-and-marginal-structural-models.html#cb12-97" tabindex="-1"></a><span class="do">## (Intercept) 1.780 1.340 2.22</span></span>
<span id="cb12-98"><a href="ip-weighting-and-marginal-structural-models.html#cb12-98" tabindex="-1"></a><span class="do">## qsmk        3.441 2.411 4.47</span></span>
<span id="cb12-99"><a href="ip-weighting-and-marginal-structural-models.html#cb12-99" tabindex="-1"></a></span>
<span id="cb12-100"><a href="ip-weighting-and-marginal-structural-models.html#cb12-100" tabindex="-1"></a><span class="co"># no association between sex and qsmk in pseudo-population</span></span>
<span id="cb12-101"><a href="ip-weighting-and-marginal-structural-models.html#cb12-101" tabindex="-1"></a><span class="fu">xtabs</span>(nhefs.nmv<span class="sc">$</span>w <span class="sc">~</span> nhefs.nmv<span class="sc">$</span>sex <span class="sc">+</span> nhefs.nmv<span class="sc">$</span>qsmk)</span>
<span id="cb12-102"><a href="ip-weighting-and-marginal-structural-models.html#cb12-102" tabindex="-1"></a><span class="do">##              nhefs.nmv$qsmk</span></span>
<span id="cb12-103"><a href="ip-weighting-and-marginal-structural-models.html#cb12-103" tabindex="-1"></a><span class="do">## nhefs.nmv$sex     0     1</span></span>
<span id="cb12-104"><a href="ip-weighting-and-marginal-structural-models.html#cb12-104" tabindex="-1"></a><span class="do">##             0 763.6 763.6</span></span>
<span id="cb12-105"><a href="ip-weighting-and-marginal-structural-models.html#cb12-105" tabindex="-1"></a><span class="do">##             1 801.7 797.2</span></span>
<span id="cb12-106"><a href="ip-weighting-and-marginal-structural-models.html#cb12-106" tabindex="-1"></a></span>
<span id="cb12-107"><a href="ip-weighting-and-marginal-structural-models.html#cb12-107" tabindex="-1"></a><span class="co"># &quot;check&quot; for positivity (White women)</span></span>
<span id="cb12-108"><a href="ip-weighting-and-marginal-structural-models.html#cb12-108" tabindex="-1"></a><span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>age[nhefs.nmv<span class="sc">$</span>race <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> nhefs.nmv<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb12-109"><a href="ip-weighting-and-marginal-structural-models.html#cb12-109" tabindex="-1"></a>      nhefs.nmv<span class="sc">$</span>qsmk[nhefs.nmv<span class="sc">$</span>race <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> nhefs.nmv<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb12-110"><a href="ip-weighting-and-marginal-structural-models.html#cb12-110" tabindex="-1"></a><span class="do">##     </span></span>
<span id="cb12-111"><a href="ip-weighting-and-marginal-structural-models.html#cb12-111" tabindex="-1"></a><span class="do">##       0  1</span></span>
<span id="cb12-112"><a href="ip-weighting-and-marginal-structural-models.html#cb12-112" tabindex="-1"></a><span class="do">##   25 24  3</span></span>
<span id="cb12-113"><a href="ip-weighting-and-marginal-structural-models.html#cb12-113" tabindex="-1"></a><span class="do">##   26 14  5</span></span>
<span id="cb12-114"><a href="ip-weighting-and-marginal-structural-models.html#cb12-114" tabindex="-1"></a><span class="do">##   27 18  2</span></span>
<span id="cb12-115"><a href="ip-weighting-and-marginal-structural-models.html#cb12-115" tabindex="-1"></a><span class="do">##   28 20  5</span></span>
<span id="cb12-116"><a href="ip-weighting-and-marginal-structural-models.html#cb12-116" tabindex="-1"></a><span class="do">##   29 15  4</span></span>
<span id="cb12-117"><a href="ip-weighting-and-marginal-structural-models.html#cb12-117" tabindex="-1"></a><span class="do">##   30 14  5</span></span>
<span id="cb12-118"><a href="ip-weighting-and-marginal-structural-models.html#cb12-118" tabindex="-1"></a><span class="do">##   31 11  5</span></span>
<span id="cb12-119"><a href="ip-weighting-and-marginal-structural-models.html#cb12-119" tabindex="-1"></a><span class="do">##   32 14  7</span></span>
<span id="cb12-120"><a href="ip-weighting-and-marginal-structural-models.html#cb12-120" tabindex="-1"></a><span class="do">##   33 12  3</span></span>
<span id="cb12-121"><a href="ip-weighting-and-marginal-structural-models.html#cb12-121" tabindex="-1"></a><span class="do">##   34 22  5</span></span>
<span id="cb12-122"><a href="ip-weighting-and-marginal-structural-models.html#cb12-122" tabindex="-1"></a><span class="do">##   35 16  5</span></span>
<span id="cb12-123"><a href="ip-weighting-and-marginal-structural-models.html#cb12-123" tabindex="-1"></a><span class="do">##   36 13  3</span></span>
<span id="cb12-124"><a href="ip-weighting-and-marginal-structural-models.html#cb12-124" tabindex="-1"></a><span class="do">##   37 14  1</span></span>
<span id="cb12-125"><a href="ip-weighting-and-marginal-structural-models.html#cb12-125" tabindex="-1"></a><span class="do">##   38  6  2</span></span>
<span id="cb12-126"><a href="ip-weighting-and-marginal-structural-models.html#cb12-126" tabindex="-1"></a><span class="do">##   39 19  4</span></span>
<span id="cb12-127"><a href="ip-weighting-and-marginal-structural-models.html#cb12-127" tabindex="-1"></a><span class="do">##   40 10  4</span></span>
<span id="cb12-128"><a href="ip-weighting-and-marginal-structural-models.html#cb12-128" tabindex="-1"></a><span class="do">##   41 13  3</span></span>
<span id="cb12-129"><a href="ip-weighting-and-marginal-structural-models.html#cb12-129" tabindex="-1"></a><span class="do">##   42 16  3</span></span>
<span id="cb12-130"><a href="ip-weighting-and-marginal-structural-models.html#cb12-130" tabindex="-1"></a><span class="do">##   43 14  3</span></span>
<span id="cb12-131"><a href="ip-weighting-and-marginal-structural-models.html#cb12-131" tabindex="-1"></a><span class="do">##   44  9  4</span></span>
<span id="cb12-132"><a href="ip-weighting-and-marginal-structural-models.html#cb12-132" tabindex="-1"></a><span class="do">##   45 12  5</span></span>
<span id="cb12-133"><a href="ip-weighting-and-marginal-structural-models.html#cb12-133" tabindex="-1"></a><span class="do">##   46 19  4</span></span>
<span id="cb12-134"><a href="ip-weighting-and-marginal-structural-models.html#cb12-134" tabindex="-1"></a><span class="do">##   47 19  4</span></span>
<span id="cb12-135"><a href="ip-weighting-and-marginal-structural-models.html#cb12-135" tabindex="-1"></a><span class="do">##   48 19  4</span></span>
<span id="cb12-136"><a href="ip-weighting-and-marginal-structural-models.html#cb12-136" tabindex="-1"></a><span class="do">##   49 11  3</span></span>
<span id="cb12-137"><a href="ip-weighting-and-marginal-structural-models.html#cb12-137" tabindex="-1"></a><span class="do">##   50 18  4</span></span>
<span id="cb12-138"><a href="ip-weighting-and-marginal-structural-models.html#cb12-138" tabindex="-1"></a><span class="do">##   51  9  3</span></span>
<span id="cb12-139"><a href="ip-weighting-and-marginal-structural-models.html#cb12-139" tabindex="-1"></a><span class="do">##   52 11  3</span></span>
<span id="cb12-140"><a href="ip-weighting-and-marginal-structural-models.html#cb12-140" tabindex="-1"></a><span class="do">##   53 11  4</span></span>
<span id="cb12-141"><a href="ip-weighting-and-marginal-structural-models.html#cb12-141" tabindex="-1"></a><span class="do">##   54 17  9</span></span>
<span id="cb12-142"><a href="ip-weighting-and-marginal-structural-models.html#cb12-142" tabindex="-1"></a><span class="do">##   55  9  4</span></span>
<span id="cb12-143"><a href="ip-weighting-and-marginal-structural-models.html#cb12-143" tabindex="-1"></a><span class="do">##   56  8  7</span></span>
<span id="cb12-144"><a href="ip-weighting-and-marginal-structural-models.html#cb12-144" tabindex="-1"></a><span class="do">##   57  9  2</span></span>
<span id="cb12-145"><a href="ip-weighting-and-marginal-structural-models.html#cb12-145" tabindex="-1"></a><span class="do">##   58  8  4</span></span>
<span id="cb12-146"><a href="ip-weighting-and-marginal-structural-models.html#cb12-146" tabindex="-1"></a><span class="do">##   59  5  4</span></span>
<span id="cb12-147"><a href="ip-weighting-and-marginal-structural-models.html#cb12-147" tabindex="-1"></a><span class="do">##   60  5  4</span></span>
<span id="cb12-148"><a href="ip-weighting-and-marginal-structural-models.html#cb12-148" tabindex="-1"></a><span class="do">##   61  5  2</span></span>
<span id="cb12-149"><a href="ip-weighting-and-marginal-structural-models.html#cb12-149" tabindex="-1"></a><span class="do">##   62  6  5</span></span>
<span id="cb12-150"><a href="ip-weighting-and-marginal-structural-models.html#cb12-150" tabindex="-1"></a><span class="do">##   63  3  3</span></span>
<span id="cb12-151"><a href="ip-weighting-and-marginal-structural-models.html#cb12-151" tabindex="-1"></a><span class="do">##   64  7  1</span></span>
<span id="cb12-152"><a href="ip-weighting-and-marginal-structural-models.html#cb12-152" tabindex="-1"></a><span class="do">##   65  3  2</span></span>
<span id="cb12-153"><a href="ip-weighting-and-marginal-structural-models.html#cb12-153" tabindex="-1"></a><span class="do">##   66  4  0</span></span>
<span id="cb12-154"><a href="ip-weighting-and-marginal-structural-models.html#cb12-154" tabindex="-1"></a><span class="do">##   67  2  0</span></span>
<span id="cb12-155"><a href="ip-weighting-and-marginal-structural-models.html#cb12-155" tabindex="-1"></a><span class="do">##   69  6  2</span></span>
<span id="cb12-156"><a href="ip-weighting-and-marginal-structural-models.html#cb12-156" tabindex="-1"></a><span class="do">##   70  2  1</span></span>
<span id="cb12-157"><a href="ip-weighting-and-marginal-structural-models.html#cb12-157" tabindex="-1"></a><span class="do">##   71  0  1</span></span>
<span id="cb12-158"><a href="ip-weighting-and-marginal-structural-models.html#cb12-158" tabindex="-1"></a><span class="do">##   72  2  2</span></span>
<span id="cb12-159"><a href="ip-weighting-and-marginal-structural-models.html#cb12-159" tabindex="-1"></a><span class="do">##   74  0  1</span></span></code></pre></div>
</div>
<div id="program-12.3" class="section level2 hasAnchor">
<h2>Program 12.3<a href="ip-weighting-and-marginal-structural-models.html#program-12.3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating stabilized IP weights</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="ip-weighting-and-marginal-structural-models.html#cb13-1" tabindex="-1"></a><span class="co"># estimation of denominator of ip weights</span></span>
<span id="cb13-2"><a href="ip-weighting-and-marginal-structural-models.html#cb13-2" tabindex="-1"></a>denom.fit <span class="ot">&lt;-</span></span>
<span id="cb13-3"><a href="ip-weighting-and-marginal-structural-models.html#cb13-3" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb13-4"><a href="ip-weighting-and-marginal-structural-models.html#cb13-4" tabindex="-1"></a>    qsmk <span class="sc">~</span> <span class="fu">as.factor</span>(sex) <span class="sc">+</span> <span class="fu">as.factor</span>(race) <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="ip-weighting-and-marginal-structural-models.html#cb13-5" tabindex="-1"></a>      <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span></span>
<span id="cb13-6"><a href="ip-weighting-and-marginal-structural-models.html#cb13-6" tabindex="-1"></a>      <span class="fu">I</span>(smokeintensity <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="ip-weighting-and-marginal-structural-models.html#cb13-7" tabindex="-1"></a>      <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71 <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb13-8"><a href="ip-weighting-and-marginal-structural-models.html#cb13-8" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb13-9"><a href="ip-weighting-and-marginal-structural-models.html#cb13-9" tabindex="-1"></a>    <span class="at">data =</span> nhefs.nmv</span>
<span id="cb13-10"><a href="ip-weighting-and-marginal-structural-models.html#cb13-10" tabindex="-1"></a>  )</span>
<span id="cb13-11"><a href="ip-weighting-and-marginal-structural-models.html#cb13-11" tabindex="-1"></a><span class="fu">summary</span>(denom.fit)</span>
<span id="cb13-12"><a href="ip-weighting-and-marginal-structural-models.html#cb13-12" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-13"><a href="ip-weighting-and-marginal-structural-models.html#cb13-13" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb13-14"><a href="ip-weighting-and-marginal-structural-models.html#cb13-14" tabindex="-1"></a><span class="do">## glm(formula = qsmk ~ as.factor(sex) + as.factor(race) + age + </span></span>
<span id="cb13-15"><a href="ip-weighting-and-marginal-structural-models.html#cb13-15" tabindex="-1"></a><span class="do">##     I(age^2) + as.factor(education) + smokeintensity + I(smokeintensity^2) + </span></span>
<span id="cb13-16"><a href="ip-weighting-and-marginal-structural-models.html#cb13-16" tabindex="-1"></a><span class="do">##     smokeyrs + I(smokeyrs^2) + as.factor(exercise) + as.factor(active) + </span></span>
<span id="cb13-17"><a href="ip-weighting-and-marginal-structural-models.html#cb13-17" tabindex="-1"></a><span class="do">##     wt71 + I(wt71^2), family = binomial(), data = nhefs.nmv)</span></span>
<span id="cb13-18"><a href="ip-weighting-and-marginal-structural-models.html#cb13-18" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-19"><a href="ip-weighting-and-marginal-structural-models.html#cb13-19" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb13-20"><a href="ip-weighting-and-marginal-structural-models.html#cb13-20" tabindex="-1"></a><span class="do">##                        Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb13-21"><a href="ip-weighting-and-marginal-structural-models.html#cb13-21" tabindex="-1"></a><span class="do">## (Intercept)           -2.242519   1.380836   -1.62  0.10437    </span></span>
<span id="cb13-22"><a href="ip-weighting-and-marginal-structural-models.html#cb13-22" tabindex="-1"></a><span class="do">## as.factor(sex)1       -0.527478   0.154050   -3.42  0.00062 ***</span></span>
<span id="cb13-23"><a href="ip-weighting-and-marginal-structural-models.html#cb13-23" tabindex="-1"></a><span class="do">## as.factor(race)1      -0.839264   0.210067   -4.00  6.5e-05 ***</span></span>
<span id="cb13-24"><a href="ip-weighting-and-marginal-structural-models.html#cb13-24" tabindex="-1"></a><span class="do">## age                    0.121205   0.051266    2.36  0.01807 *  </span></span>
<span id="cb13-25"><a href="ip-weighting-and-marginal-structural-models.html#cb13-25" tabindex="-1"></a><span class="do">## I(age^2)              -0.000825   0.000536   -1.54  0.12404    </span></span>
<span id="cb13-26"><a href="ip-weighting-and-marginal-structural-models.html#cb13-26" tabindex="-1"></a><span class="do">## as.factor(education)2 -0.028776   0.198351   -0.15  0.88465    </span></span>
<span id="cb13-27"><a href="ip-weighting-and-marginal-structural-models.html#cb13-27" tabindex="-1"></a><span class="do">## as.factor(education)3  0.086432   0.178085    0.49  0.62744    </span></span>
<span id="cb13-28"><a href="ip-weighting-and-marginal-structural-models.html#cb13-28" tabindex="-1"></a><span class="do">## as.factor(education)4  0.063601   0.273211    0.23  0.81592    </span></span>
<span id="cb13-29"><a href="ip-weighting-and-marginal-structural-models.html#cb13-29" tabindex="-1"></a><span class="do">## as.factor(education)5  0.475961   0.226224    2.10  0.03538 *  </span></span>
<span id="cb13-30"><a href="ip-weighting-and-marginal-structural-models.html#cb13-30" tabindex="-1"></a><span class="do">## smokeintensity        -0.077270   0.015250   -5.07  4.0e-07 ***</span></span>
<span id="cb13-31"><a href="ip-weighting-and-marginal-structural-models.html#cb13-31" tabindex="-1"></a><span class="do">## I(smokeintensity^2)    0.001045   0.000287    3.65  0.00027 ***</span></span>
<span id="cb13-32"><a href="ip-weighting-and-marginal-structural-models.html#cb13-32" tabindex="-1"></a><span class="do">## smokeyrs              -0.073597   0.027777   -2.65  0.00806 ** </span></span>
<span id="cb13-33"><a href="ip-weighting-and-marginal-structural-models.html#cb13-33" tabindex="-1"></a><span class="do">## I(smokeyrs^2)          0.000844   0.000463    1.82  0.06840 .  </span></span>
<span id="cb13-34"><a href="ip-weighting-and-marginal-structural-models.html#cb13-34" tabindex="-1"></a><span class="do">## as.factor(exercise)1   0.354841   0.180135    1.97  0.04885 *  </span></span>
<span id="cb13-35"><a href="ip-weighting-and-marginal-structural-models.html#cb13-35" tabindex="-1"></a><span class="do">## as.factor(exercise)2   0.395704   0.187240    2.11  0.03457 *  </span></span>
<span id="cb13-36"><a href="ip-weighting-and-marginal-structural-models.html#cb13-36" tabindex="-1"></a><span class="do">## as.factor(active)1     0.031944   0.132937    0.24  0.81010    </span></span>
<span id="cb13-37"><a href="ip-weighting-and-marginal-structural-models.html#cb13-37" tabindex="-1"></a><span class="do">## as.factor(active)2     0.176784   0.214972    0.82  0.41087    </span></span>
<span id="cb13-38"><a href="ip-weighting-and-marginal-structural-models.html#cb13-38" tabindex="-1"></a><span class="do">## wt71                  -0.015236   0.026316   -0.58  0.56262    </span></span>
<span id="cb13-39"><a href="ip-weighting-and-marginal-structural-models.html#cb13-39" tabindex="-1"></a><span class="do">## I(wt71^2)              0.000135   0.000163    0.83  0.40737    </span></span>
<span id="cb13-40"><a href="ip-weighting-and-marginal-structural-models.html#cb13-40" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb13-41"><a href="ip-weighting-and-marginal-structural-models.html#cb13-41" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb13-42"><a href="ip-weighting-and-marginal-structural-models.html#cb13-42" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-43"><a href="ip-weighting-and-marginal-structural-models.html#cb13-43" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb13-44"><a href="ip-weighting-and-marginal-structural-models.html#cb13-44" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-45"><a href="ip-weighting-and-marginal-structural-models.html#cb13-45" tabindex="-1"></a><span class="do">##     Null deviance: 1786.1  on 1565  degrees of freedom</span></span>
<span id="cb13-46"><a href="ip-weighting-and-marginal-structural-models.html#cb13-46" tabindex="-1"></a><span class="do">## Residual deviance: 1676.9  on 1547  degrees of freedom</span></span>
<span id="cb13-47"><a href="ip-weighting-and-marginal-structural-models.html#cb13-47" tabindex="-1"></a><span class="do">## AIC: 1715</span></span>
<span id="cb13-48"><a href="ip-weighting-and-marginal-structural-models.html#cb13-48" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-49"><a href="ip-weighting-and-marginal-structural-models.html#cb13-49" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb13-50"><a href="ip-weighting-and-marginal-structural-models.html#cb13-50" tabindex="-1"></a></span>
<span id="cb13-51"><a href="ip-weighting-and-marginal-structural-models.html#cb13-51" tabindex="-1"></a>pd.qsmk <span class="ot">&lt;-</span> <span class="fu">predict</span>(denom.fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb13-52"><a href="ip-weighting-and-marginal-structural-models.html#cb13-52" tabindex="-1"></a></span>
<span id="cb13-53"><a href="ip-weighting-and-marginal-structural-models.html#cb13-53" tabindex="-1"></a><span class="co"># estimation of numerator of ip weights</span></span>
<span id="cb13-54"><a href="ip-weighting-and-marginal-structural-models.html#cb13-54" tabindex="-1"></a>numer.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(qsmk <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">data =</span> nhefs.nmv)</span>
<span id="cb13-55"><a href="ip-weighting-and-marginal-structural-models.html#cb13-55" tabindex="-1"></a><span class="fu">summary</span>(numer.fit)</span>
<span id="cb13-56"><a href="ip-weighting-and-marginal-structural-models.html#cb13-56" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-57"><a href="ip-weighting-and-marginal-structural-models.html#cb13-57" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb13-58"><a href="ip-weighting-and-marginal-structural-models.html#cb13-58" tabindex="-1"></a><span class="do">## glm(formula = qsmk ~ 1, family = binomial(), data = nhefs.nmv)</span></span>
<span id="cb13-59"><a href="ip-weighting-and-marginal-structural-models.html#cb13-59" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-60"><a href="ip-weighting-and-marginal-structural-models.html#cb13-60" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb13-61"><a href="ip-weighting-and-marginal-structural-models.html#cb13-61" tabindex="-1"></a><span class="do">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb13-62"><a href="ip-weighting-and-marginal-structural-models.html#cb13-62" tabindex="-1"></a><span class="do">## (Intercept)  -1.0598     0.0578   -18.3   &lt;2e-16 ***</span></span>
<span id="cb13-63"><a href="ip-weighting-and-marginal-structural-models.html#cb13-63" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb13-64"><a href="ip-weighting-and-marginal-structural-models.html#cb13-64" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb13-65"><a href="ip-weighting-and-marginal-structural-models.html#cb13-65" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-66"><a href="ip-weighting-and-marginal-structural-models.html#cb13-66" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb13-67"><a href="ip-weighting-and-marginal-structural-models.html#cb13-67" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-68"><a href="ip-weighting-and-marginal-structural-models.html#cb13-68" tabindex="-1"></a><span class="do">##     Null deviance: 1786.1  on 1565  degrees of freedom</span></span>
<span id="cb13-69"><a href="ip-weighting-and-marginal-structural-models.html#cb13-69" tabindex="-1"></a><span class="do">## Residual deviance: 1786.1  on 1565  degrees of freedom</span></span>
<span id="cb13-70"><a href="ip-weighting-and-marginal-structural-models.html#cb13-70" tabindex="-1"></a><span class="do">## AIC: 1788</span></span>
<span id="cb13-71"><a href="ip-weighting-and-marginal-structural-models.html#cb13-71" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-72"><a href="ip-weighting-and-marginal-structural-models.html#cb13-72" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb13-73"><a href="ip-weighting-and-marginal-structural-models.html#cb13-73" tabindex="-1"></a></span>
<span id="cb13-74"><a href="ip-weighting-and-marginal-structural-models.html#cb13-74" tabindex="-1"></a>pn.qsmk <span class="ot">&lt;-</span> <span class="fu">predict</span>(numer.fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb13-75"><a href="ip-weighting-and-marginal-structural-models.html#cb13-75" tabindex="-1"></a></span>
<span id="cb13-76"><a href="ip-weighting-and-marginal-structural-models.html#cb13-76" tabindex="-1"></a>nhefs.nmv<span class="sc">$</span>sw <span class="ot">&lt;-</span></span>
<span id="cb13-77"><a href="ip-weighting-and-marginal-structural-models.html#cb13-77" tabindex="-1"></a>  <span class="fu">ifelse</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">0</span>, ((<span class="dv">1</span> <span class="sc">-</span> pn.qsmk) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> pd.qsmk)),</span>
<span id="cb13-78"><a href="ip-weighting-and-marginal-structural-models.html#cb13-78" tabindex="-1"></a>         (pn.qsmk <span class="sc">/</span> pd.qsmk))</span>
<span id="cb13-79"><a href="ip-weighting-and-marginal-structural-models.html#cb13-79" tabindex="-1"></a></span>
<span id="cb13-80"><a href="ip-weighting-and-marginal-structural-models.html#cb13-80" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv<span class="sc">$</span>sw)</span>
<span id="cb13-81"><a href="ip-weighting-and-marginal-structural-models.html#cb13-81" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb13-82"><a href="ip-weighting-and-marginal-structural-models.html#cb13-82" tabindex="-1"></a><span class="do">##   0.331   0.867   0.950   0.999   1.079   4.298</span></span>
<span id="cb13-83"><a href="ip-weighting-and-marginal-structural-models.html#cb13-83" tabindex="-1"></a></span>
<span id="cb13-84"><a href="ip-weighting-and-marginal-structural-models.html#cb13-84" tabindex="-1"></a></span>
<span id="cb13-85"><a href="ip-weighting-and-marginal-structural-models.html#cb13-85" tabindex="-1"></a>msm.sw <span class="ot">&lt;-</span> <span class="fu">geeglm</span>(</span>
<span id="cb13-86"><a href="ip-weighting-and-marginal-structural-models.html#cb13-86" tabindex="-1"></a>  wt82_71 <span class="sc">~</span> qsmk,</span>
<span id="cb13-87"><a href="ip-weighting-and-marginal-structural-models.html#cb13-87" tabindex="-1"></a>  <span class="at">data =</span> nhefs.nmv,</span>
<span id="cb13-88"><a href="ip-weighting-and-marginal-structural-models.html#cb13-88" tabindex="-1"></a>  <span class="at">weights =</span> sw,</span>
<span id="cb13-89"><a href="ip-weighting-and-marginal-structural-models.html#cb13-89" tabindex="-1"></a>  <span class="at">id =</span> seqn,</span>
<span id="cb13-90"><a href="ip-weighting-and-marginal-structural-models.html#cb13-90" tabindex="-1"></a>  <span class="at">corstr =</span> <span class="st">&quot;independence&quot;</span></span>
<span id="cb13-91"><a href="ip-weighting-and-marginal-structural-models.html#cb13-91" tabindex="-1"></a>)</span>
<span id="cb13-92"><a href="ip-weighting-and-marginal-structural-models.html#cb13-92" tabindex="-1"></a><span class="fu">summary</span>(msm.sw)</span>
<span id="cb13-93"><a href="ip-weighting-and-marginal-structural-models.html#cb13-93" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-94"><a href="ip-weighting-and-marginal-structural-models.html#cb13-94" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb13-95"><a href="ip-weighting-and-marginal-structural-models.html#cb13-95" tabindex="-1"></a><span class="do">## geeglm(formula = wt82_71 ~ qsmk, data = nhefs.nmv, weights = sw, </span></span>
<span id="cb13-96"><a href="ip-weighting-and-marginal-structural-models.html#cb13-96" tabindex="-1"></a><span class="do">##     id = seqn, corstr = &quot;independence&quot;)</span></span>
<span id="cb13-97"><a href="ip-weighting-and-marginal-structural-models.html#cb13-97" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-98"><a href="ip-weighting-and-marginal-structural-models.html#cb13-98" tabindex="-1"></a><span class="do">##  Coefficients:</span></span>
<span id="cb13-99"><a href="ip-weighting-and-marginal-structural-models.html#cb13-99" tabindex="-1"></a><span class="do">##             Estimate Std.err Wald Pr(&gt;|W|)    </span></span>
<span id="cb13-100"><a href="ip-weighting-and-marginal-structural-models.html#cb13-100" tabindex="-1"></a><span class="do">## (Intercept)    1.780   0.225 62.7  2.3e-15 ***</span></span>
<span id="cb13-101"><a href="ip-weighting-and-marginal-structural-models.html#cb13-101" tabindex="-1"></a><span class="do">## qsmk           3.441   0.525 42.9  5.9e-11 ***</span></span>
<span id="cb13-102"><a href="ip-weighting-and-marginal-structural-models.html#cb13-102" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb13-103"><a href="ip-weighting-and-marginal-structural-models.html#cb13-103" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb13-104"><a href="ip-weighting-and-marginal-structural-models.html#cb13-104" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-105"><a href="ip-weighting-and-marginal-structural-models.html#cb13-105" tabindex="-1"></a><span class="do">## Correlation structure = independence </span></span>
<span id="cb13-106"><a href="ip-weighting-and-marginal-structural-models.html#cb13-106" tabindex="-1"></a><span class="do">## Estimated Scale Parameters:</span></span>
<span id="cb13-107"><a href="ip-weighting-and-marginal-structural-models.html#cb13-107" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb13-108"><a href="ip-weighting-and-marginal-structural-models.html#cb13-108" tabindex="-1"></a><span class="do">##             Estimate Std.err</span></span>
<span id="cb13-109"><a href="ip-weighting-and-marginal-structural-models.html#cb13-109" tabindex="-1"></a><span class="do">## (Intercept)     60.7    3.71</span></span>
<span id="cb13-110"><a href="ip-weighting-and-marginal-structural-models.html#cb13-110" tabindex="-1"></a><span class="do">## Number of clusters:   1566  Maximum cluster size: 1</span></span>
<span id="cb13-111"><a href="ip-weighting-and-marginal-structural-models.html#cb13-111" tabindex="-1"></a></span>
<span id="cb13-112"><a href="ip-weighting-and-marginal-structural-models.html#cb13-112" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(msm.sw)</span>
<span id="cb13-113"><a href="ip-weighting-and-marginal-structural-models.html#cb13-113" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(msm.sw))[, <span class="dv">2</span>]</span>
<span id="cb13-114"><a href="ip-weighting-and-marginal-structural-models.html#cb13-114" tabindex="-1"></a>lcl <span class="ot">&lt;-</span> beta <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb13-115"><a href="ip-weighting-and-marginal-structural-models.html#cb13-115" tabindex="-1"></a>ucl <span class="ot">&lt;-</span> beta <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb13-116"><a href="ip-weighting-and-marginal-structural-models.html#cb13-116" tabindex="-1"></a><span class="fu">cbind</span>(beta, lcl, ucl)</span>
<span id="cb13-117"><a href="ip-weighting-and-marginal-structural-models.html#cb13-117" tabindex="-1"></a><span class="do">##             beta  lcl  ucl</span></span>
<span id="cb13-118"><a href="ip-weighting-and-marginal-structural-models.html#cb13-118" tabindex="-1"></a><span class="do">## (Intercept) 1.78 1.34 2.22</span></span>
<span id="cb13-119"><a href="ip-weighting-and-marginal-structural-models.html#cb13-119" tabindex="-1"></a><span class="do">## qsmk        3.44 2.41 4.47</span></span>
<span id="cb13-120"><a href="ip-weighting-and-marginal-structural-models.html#cb13-120" tabindex="-1"></a></span>
<span id="cb13-121"><a href="ip-weighting-and-marginal-structural-models.html#cb13-121" tabindex="-1"></a><span class="co"># no association between sex and qsmk in pseudo-population</span></span>
<span id="cb13-122"><a href="ip-weighting-and-marginal-structural-models.html#cb13-122" tabindex="-1"></a><span class="fu">xtabs</span>(nhefs.nmv<span class="sc">$</span>sw <span class="sc">~</span> nhefs.nmv<span class="sc">$</span>sex <span class="sc">+</span> nhefs.nmv<span class="sc">$</span>qsmk)</span>
<span id="cb13-123"><a href="ip-weighting-and-marginal-structural-models.html#cb13-123" tabindex="-1"></a><span class="do">##              nhefs.nmv$qsmk</span></span>
<span id="cb13-124"><a href="ip-weighting-and-marginal-structural-models.html#cb13-124" tabindex="-1"></a><span class="do">## nhefs.nmv$sex   0   1</span></span>
<span id="cb13-125"><a href="ip-weighting-and-marginal-structural-models.html#cb13-125" tabindex="-1"></a><span class="do">##             0 567 197</span></span>
<span id="cb13-126"><a href="ip-weighting-and-marginal-structural-models.html#cb13-126" tabindex="-1"></a><span class="do">##             1 595 205</span></span></code></pre></div>
</div>
<div id="program-12.4" class="section level2 hasAnchor">
<h2>Program 12.4<a href="ip-weighting-and-marginal-structural-models.html#program-12.4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating the parameters of a marginal structural mean model with a continuous treatment Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="ip-weighting-and-marginal-structural-models.html#cb14-1" tabindex="-1"></a><span class="co"># Analysis restricted to subjects reporting &lt;=25 cig/day at baseline</span></span>
<span id="cb14-2"><a href="ip-weighting-and-marginal-structural-models.html#cb14-2" tabindex="-1"></a>nhefs.nmv.s <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhefs.nmv, smokeintensity <span class="sc">&lt;=</span> <span class="dv">25</span>)</span>
<span id="cb14-3"><a href="ip-weighting-and-marginal-structural-models.html#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="ip-weighting-and-marginal-structural-models.html#cb14-4" tabindex="-1"></a><span class="co"># estimation of denominator of ip weights</span></span>
<span id="cb14-5"><a href="ip-weighting-and-marginal-structural-models.html#cb14-5" tabindex="-1"></a>den.fit.obj <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb14-6"><a href="ip-weighting-and-marginal-structural-models.html#cb14-6" tabindex="-1"></a>  smkintensity82_71 <span class="sc">~</span> <span class="fu">as.factor</span>(sex) <span class="sc">+</span></span>
<span id="cb14-7"><a href="ip-weighting-and-marginal-structural-models.html#cb14-7" tabindex="-1"></a>    <span class="fu">as.factor</span>(race) <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="ip-weighting-and-marginal-structural-models.html#cb14-8" tabindex="-1"></a>    <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="ip-weighting-and-marginal-structural-models.html#cb14-9" tabindex="-1"></a>    smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span> wt71 <span class="sc">+</span></span>
<span id="cb14-10"><a href="ip-weighting-and-marginal-structural-models.html#cb14-10" tabindex="-1"></a>    <span class="fu">I</span>(wt71 <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb14-11"><a href="ip-weighting-and-marginal-structural-models.html#cb14-11" tabindex="-1"></a>  <span class="at">data =</span> nhefs.nmv.s</span>
<span id="cb14-12"><a href="ip-weighting-and-marginal-structural-models.html#cb14-12" tabindex="-1"></a>)</span>
<span id="cb14-13"><a href="ip-weighting-and-marginal-structural-models.html#cb14-13" tabindex="-1"></a>p.den <span class="ot">&lt;-</span> <span class="fu">predict</span>(den.fit.obj, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb14-14"><a href="ip-weighting-and-marginal-structural-models.html#cb14-14" tabindex="-1"></a>dens.den <span class="ot">&lt;-</span></span>
<span id="cb14-15"><a href="ip-weighting-and-marginal-structural-models.html#cb14-15" tabindex="-1"></a>  <span class="fu">dnorm</span>(nhefs.nmv.s<span class="sc">$</span>smkintensity82_71,</span>
<span id="cb14-16"><a href="ip-weighting-and-marginal-structural-models.html#cb14-16" tabindex="-1"></a>        p.den,</span>
<span id="cb14-17"><a href="ip-weighting-and-marginal-structural-models.html#cb14-17" tabindex="-1"></a>        <span class="fu">summary</span>(den.fit.obj)<span class="sc">$</span>sigma)</span>
<span id="cb14-18"><a href="ip-weighting-and-marginal-structural-models.html#cb14-18" tabindex="-1"></a></span>
<span id="cb14-19"><a href="ip-weighting-and-marginal-structural-models.html#cb14-19" tabindex="-1"></a><span class="co"># estimation of numerator of ip weights</span></span>
<span id="cb14-20"><a href="ip-weighting-and-marginal-structural-models.html#cb14-20" tabindex="-1"></a>num.fit.obj <span class="ot">&lt;-</span> <span class="fu">lm</span>(smkintensity82_71 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> nhefs.nmv.s)</span>
<span id="cb14-21"><a href="ip-weighting-and-marginal-structural-models.html#cb14-21" tabindex="-1"></a>p.num <span class="ot">&lt;-</span> <span class="fu">predict</span>(num.fit.obj, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb14-22"><a href="ip-weighting-and-marginal-structural-models.html#cb14-22" tabindex="-1"></a>dens.num <span class="ot">&lt;-</span></span>
<span id="cb14-23"><a href="ip-weighting-and-marginal-structural-models.html#cb14-23" tabindex="-1"></a>  <span class="fu">dnorm</span>(nhefs.nmv.s<span class="sc">$</span>smkintensity82_71,</span>
<span id="cb14-24"><a href="ip-weighting-and-marginal-structural-models.html#cb14-24" tabindex="-1"></a>        p.num,</span>
<span id="cb14-25"><a href="ip-weighting-and-marginal-structural-models.html#cb14-25" tabindex="-1"></a>        <span class="fu">summary</span>(num.fit.obj)<span class="sc">$</span>sigma)</span>
<span id="cb14-26"><a href="ip-weighting-and-marginal-structural-models.html#cb14-26" tabindex="-1"></a></span>
<span id="cb14-27"><a href="ip-weighting-and-marginal-structural-models.html#cb14-27" tabindex="-1"></a>nhefs.nmv.s<span class="sc">$</span>sw.a <span class="ot">&lt;-</span> dens.num <span class="sc">/</span> dens.den</span>
<span id="cb14-28"><a href="ip-weighting-and-marginal-structural-models.html#cb14-28" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv.s<span class="sc">$</span>sw.a)</span>
<span id="cb14-29"><a href="ip-weighting-and-marginal-structural-models.html#cb14-29" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb14-30"><a href="ip-weighting-and-marginal-structural-models.html#cb14-30" tabindex="-1"></a><span class="do">##    0.19    0.89    0.97    1.00    1.05    5.10</span></span>
<span id="cb14-31"><a href="ip-weighting-and-marginal-structural-models.html#cb14-31" tabindex="-1"></a></span>
<span id="cb14-32"><a href="ip-weighting-and-marginal-structural-models.html#cb14-32" tabindex="-1"></a>msm.sw.cont <span class="ot">&lt;-</span></span>
<span id="cb14-33"><a href="ip-weighting-and-marginal-structural-models.html#cb14-33" tabindex="-1"></a>  <span class="fu">geeglm</span>(</span>
<span id="cb14-34"><a href="ip-weighting-and-marginal-structural-models.html#cb14-34" tabindex="-1"></a>    wt82_71 <span class="sc">~</span> smkintensity82_71 <span class="sc">+</span> <span class="fu">I</span>(smkintensity82_71 <span class="sc">*</span> smkintensity82_71),</span>
<span id="cb14-35"><a href="ip-weighting-and-marginal-structural-models.html#cb14-35" tabindex="-1"></a>    <span class="at">data =</span> nhefs.nmv.s,</span>
<span id="cb14-36"><a href="ip-weighting-and-marginal-structural-models.html#cb14-36" tabindex="-1"></a>    <span class="at">weights =</span> sw.a,</span>
<span id="cb14-37"><a href="ip-weighting-and-marginal-structural-models.html#cb14-37" tabindex="-1"></a>    <span class="at">id =</span> seqn,</span>
<span id="cb14-38"><a href="ip-weighting-and-marginal-structural-models.html#cb14-38" tabindex="-1"></a>    <span class="at">corstr =</span> <span class="st">&quot;independence&quot;</span></span>
<span id="cb14-39"><a href="ip-weighting-and-marginal-structural-models.html#cb14-39" tabindex="-1"></a>  )</span>
<span id="cb14-40"><a href="ip-weighting-and-marginal-structural-models.html#cb14-40" tabindex="-1"></a><span class="fu">summary</span>(msm.sw.cont)</span>
<span id="cb14-41"><a href="ip-weighting-and-marginal-structural-models.html#cb14-41" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-42"><a href="ip-weighting-and-marginal-structural-models.html#cb14-42" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb14-43"><a href="ip-weighting-and-marginal-structural-models.html#cb14-43" tabindex="-1"></a><span class="do">## geeglm(formula = wt82_71 ~ smkintensity82_71 + I(smkintensity82_71 * </span></span>
<span id="cb14-44"><a href="ip-weighting-and-marginal-structural-models.html#cb14-44" tabindex="-1"></a><span class="do">##     smkintensity82_71), data = nhefs.nmv.s, weights = sw.a, id = seqn, </span></span>
<span id="cb14-45"><a href="ip-weighting-and-marginal-structural-models.html#cb14-45" tabindex="-1"></a><span class="do">##     corstr = &quot;independence&quot;)</span></span>
<span id="cb14-46"><a href="ip-weighting-and-marginal-structural-models.html#cb14-46" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-47"><a href="ip-weighting-and-marginal-structural-models.html#cb14-47" tabindex="-1"></a><span class="do">##  Coefficients:</span></span>
<span id="cb14-48"><a href="ip-weighting-and-marginal-structural-models.html#cb14-48" tabindex="-1"></a><span class="do">##                                          Estimate  Std.err  Wald Pr(&gt;|W|)    </span></span>
<span id="cb14-49"><a href="ip-weighting-and-marginal-structural-models.html#cb14-49" tabindex="-1"></a><span class="do">## (Intercept)                               2.00452  0.29512 46.13  1.1e-11 ***</span></span>
<span id="cb14-50"><a href="ip-weighting-and-marginal-structural-models.html#cb14-50" tabindex="-1"></a><span class="do">## smkintensity82_71                        -0.10899  0.03154 11.94  0.00055 ***</span></span>
<span id="cb14-51"><a href="ip-weighting-and-marginal-structural-models.html#cb14-51" tabindex="-1"></a><span class="do">## I(smkintensity82_71 * smkintensity82_71)  0.00269  0.00242  1.24  0.26489    </span></span>
<span id="cb14-52"><a href="ip-weighting-and-marginal-structural-models.html#cb14-52" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb14-53"><a href="ip-weighting-and-marginal-structural-models.html#cb14-53" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb14-54"><a href="ip-weighting-and-marginal-structural-models.html#cb14-54" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-55"><a href="ip-weighting-and-marginal-structural-models.html#cb14-55" tabindex="-1"></a><span class="do">## Correlation structure = independence </span></span>
<span id="cb14-56"><a href="ip-weighting-and-marginal-structural-models.html#cb14-56" tabindex="-1"></a><span class="do">## Estimated Scale Parameters:</span></span>
<span id="cb14-57"><a href="ip-weighting-and-marginal-structural-models.html#cb14-57" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-58"><a href="ip-weighting-and-marginal-structural-models.html#cb14-58" tabindex="-1"></a><span class="do">##             Estimate Std.err</span></span>
<span id="cb14-59"><a href="ip-weighting-and-marginal-structural-models.html#cb14-59" tabindex="-1"></a><span class="do">## (Intercept)     60.5     4.5</span></span>
<span id="cb14-60"><a href="ip-weighting-and-marginal-structural-models.html#cb14-60" tabindex="-1"></a><span class="do">## Number of clusters:   1162  Maximum cluster size: 1</span></span>
<span id="cb14-61"><a href="ip-weighting-and-marginal-structural-models.html#cb14-61" tabindex="-1"></a></span>
<span id="cb14-62"><a href="ip-weighting-and-marginal-structural-models.html#cb14-62" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(msm.sw.cont)</span>
<span id="cb14-63"><a href="ip-weighting-and-marginal-structural-models.html#cb14-63" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(msm.sw.cont))[, <span class="dv">2</span>]</span>
<span id="cb14-64"><a href="ip-weighting-and-marginal-structural-models.html#cb14-64" tabindex="-1"></a>lcl <span class="ot">&lt;-</span> beta <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb14-65"><a href="ip-weighting-and-marginal-structural-models.html#cb14-65" tabindex="-1"></a>ucl <span class="ot">&lt;-</span> beta <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb14-66"><a href="ip-weighting-and-marginal-structural-models.html#cb14-66" tabindex="-1"></a><span class="fu">cbind</span>(beta, lcl, ucl)</span>
<span id="cb14-67"><a href="ip-weighting-and-marginal-structural-models.html#cb14-67" tabindex="-1"></a><span class="do">##                                              beta      lcl      ucl</span></span>
<span id="cb14-68"><a href="ip-weighting-and-marginal-structural-models.html#cb14-68" tabindex="-1"></a><span class="do">## (Intercept)                               2.00452  1.42610  2.58295</span></span>
<span id="cb14-69"><a href="ip-weighting-and-marginal-structural-models.html#cb14-69" tabindex="-1"></a><span class="do">## smkintensity82_71                        -0.10899 -0.17080 -0.04718</span></span>
<span id="cb14-70"><a href="ip-weighting-and-marginal-structural-models.html#cb14-70" tabindex="-1"></a><span class="do">## I(smkintensity82_71 * smkintensity82_71)  0.00269 -0.00204  0.00743</span></span></code></pre></div>
</div>
<div id="program-12.5" class="section level2 hasAnchor">
<h2>Program 12.5<a href="ip-weighting-and-marginal-structural-models.html#program-12.5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating the parameters of a marginal structural logistic model</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="ip-weighting-and-marginal-structural-models.html#cb15-1" tabindex="-1"></a><span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>qsmk, nhefs.nmv<span class="sc">$</span>death)</span>
<span id="cb15-2"><a href="ip-weighting-and-marginal-structural-models.html#cb15-2" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb15-3"><a href="ip-weighting-and-marginal-structural-models.html#cb15-3" tabindex="-1"></a><span class="do">##       0   1</span></span>
<span id="cb15-4"><a href="ip-weighting-and-marginal-structural-models.html#cb15-4" tabindex="-1"></a><span class="do">##   0 963 200</span></span>
<span id="cb15-5"><a href="ip-weighting-and-marginal-structural-models.html#cb15-5" tabindex="-1"></a><span class="do">##   1 312  91</span></span>
<span id="cb15-6"><a href="ip-weighting-and-marginal-structural-models.html#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="ip-weighting-and-marginal-structural-models.html#cb15-7" tabindex="-1"></a><span class="co"># First, estimation of stabilized weights sw (same as in Program 12.3)</span></span>
<span id="cb15-8"><a href="ip-weighting-and-marginal-structural-models.html#cb15-8" tabindex="-1"></a><span class="co"># Second, fit logistic model below</span></span>
<span id="cb15-9"><a href="ip-weighting-and-marginal-structural-models.html#cb15-9" tabindex="-1"></a>msm.logistic <span class="ot">&lt;-</span> <span class="fu">geeglm</span>(</span>
<span id="cb15-10"><a href="ip-weighting-and-marginal-structural-models.html#cb15-10" tabindex="-1"></a>  death <span class="sc">~</span> qsmk,</span>
<span id="cb15-11"><a href="ip-weighting-and-marginal-structural-models.html#cb15-11" tabindex="-1"></a>  <span class="at">data =</span> nhefs.nmv,</span>
<span id="cb15-12"><a href="ip-weighting-and-marginal-structural-models.html#cb15-12" tabindex="-1"></a>  <span class="at">weights =</span> sw,</span>
<span id="cb15-13"><a href="ip-weighting-and-marginal-structural-models.html#cb15-13" tabindex="-1"></a>  <span class="at">id =</span> seqn,</span>
<span id="cb15-14"><a href="ip-weighting-and-marginal-structural-models.html#cb15-14" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb15-15"><a href="ip-weighting-and-marginal-structural-models.html#cb15-15" tabindex="-1"></a>  <span class="at">corstr =</span> <span class="st">&quot;independence&quot;</span></span>
<span id="cb15-16"><a href="ip-weighting-and-marginal-structural-models.html#cb15-16" tabindex="-1"></a>)</span>
<span id="cb15-17"><a href="ip-weighting-and-marginal-structural-models.html#cb15-17" tabindex="-1"></a><span class="do">## Warning in eval(family$initialize): non-integer #successes in a binomial glm!</span></span>
<span id="cb15-18"><a href="ip-weighting-and-marginal-structural-models.html#cb15-18" tabindex="-1"></a><span class="fu">summary</span>(msm.logistic)</span>
<span id="cb15-19"><a href="ip-weighting-and-marginal-structural-models.html#cb15-19" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-20"><a href="ip-weighting-and-marginal-structural-models.html#cb15-20" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb15-21"><a href="ip-weighting-and-marginal-structural-models.html#cb15-21" tabindex="-1"></a><span class="do">## geeglm(formula = death ~ qsmk, family = binomial(), data = nhefs.nmv, </span></span>
<span id="cb15-22"><a href="ip-weighting-and-marginal-structural-models.html#cb15-22" tabindex="-1"></a><span class="do">##     weights = sw, id = seqn, corstr = &quot;independence&quot;)</span></span>
<span id="cb15-23"><a href="ip-weighting-and-marginal-structural-models.html#cb15-23" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-24"><a href="ip-weighting-and-marginal-structural-models.html#cb15-24" tabindex="-1"></a><span class="do">##  Coefficients:</span></span>
<span id="cb15-25"><a href="ip-weighting-and-marginal-structural-models.html#cb15-25" tabindex="-1"></a><span class="do">##             Estimate Std.err   Wald Pr(&gt;|W|)    </span></span>
<span id="cb15-26"><a href="ip-weighting-and-marginal-structural-models.html#cb15-26" tabindex="-1"></a><span class="do">## (Intercept)  -1.4905  0.0789 356.50   &lt;2e-16 ***</span></span>
<span id="cb15-27"><a href="ip-weighting-and-marginal-structural-models.html#cb15-27" tabindex="-1"></a><span class="do">## qsmk          0.0301  0.1573   0.04     0.85    </span></span>
<span id="cb15-28"><a href="ip-weighting-and-marginal-structural-models.html#cb15-28" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb15-29"><a href="ip-weighting-and-marginal-structural-models.html#cb15-29" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb15-30"><a href="ip-weighting-and-marginal-structural-models.html#cb15-30" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-31"><a href="ip-weighting-and-marginal-structural-models.html#cb15-31" tabindex="-1"></a><span class="do">## Correlation structure = independence </span></span>
<span id="cb15-32"><a href="ip-weighting-and-marginal-structural-models.html#cb15-32" tabindex="-1"></a><span class="do">## Estimated Scale Parameters:</span></span>
<span id="cb15-33"><a href="ip-weighting-and-marginal-structural-models.html#cb15-33" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-34"><a href="ip-weighting-and-marginal-structural-models.html#cb15-34" tabindex="-1"></a><span class="do">##             Estimate Std.err</span></span>
<span id="cb15-35"><a href="ip-weighting-and-marginal-structural-models.html#cb15-35" tabindex="-1"></a><span class="do">## (Intercept)        1  0.0678</span></span>
<span id="cb15-36"><a href="ip-weighting-and-marginal-structural-models.html#cb15-36" tabindex="-1"></a><span class="do">## Number of clusters:   1566  Maximum cluster size: 1</span></span>
<span id="cb15-37"><a href="ip-weighting-and-marginal-structural-models.html#cb15-37" tabindex="-1"></a></span>
<span id="cb15-38"><a href="ip-weighting-and-marginal-structural-models.html#cb15-38" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(msm.logistic)</span>
<span id="cb15-39"><a href="ip-weighting-and-marginal-structural-models.html#cb15-39" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(msm.logistic))[, <span class="dv">2</span>]</span>
<span id="cb15-40"><a href="ip-weighting-and-marginal-structural-models.html#cb15-40" tabindex="-1"></a>lcl <span class="ot">&lt;-</span> beta <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb15-41"><a href="ip-weighting-and-marginal-structural-models.html#cb15-41" tabindex="-1"></a>ucl <span class="ot">&lt;-</span> beta <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb15-42"><a href="ip-weighting-and-marginal-structural-models.html#cb15-42" tabindex="-1"></a><span class="fu">cbind</span>(beta, lcl, ucl)</span>
<span id="cb15-43"><a href="ip-weighting-and-marginal-structural-models.html#cb15-43" tabindex="-1"></a><span class="do">##                beta    lcl    ucl</span></span>
<span id="cb15-44"><a href="ip-weighting-and-marginal-structural-models.html#cb15-44" tabindex="-1"></a><span class="do">## (Intercept) -1.4905 -1.645 -1.336</span></span>
<span id="cb15-45"><a href="ip-weighting-and-marginal-structural-models.html#cb15-45" tabindex="-1"></a><span class="do">## qsmk         0.0301 -0.278  0.338</span></span></code></pre></div>
</div>
<div id="program-12.6" class="section level2 hasAnchor">
<h2>Program 12.6<a href="ip-weighting-and-marginal-structural-models.html#program-12.6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Assessing effect modification by sex using a marginal structural mean model</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="ip-weighting-and-marginal-structural-models.html#cb16-1" tabindex="-1"></a><span class="fu">table</span>(nhefs.nmv<span class="sc">$</span>sex)</span>
<span id="cb16-2"><a href="ip-weighting-and-marginal-structural-models.html#cb16-2" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-3"><a href="ip-weighting-and-marginal-structural-models.html#cb16-3" tabindex="-1"></a><span class="do">##   0   1 </span></span>
<span id="cb16-4"><a href="ip-weighting-and-marginal-structural-models.html#cb16-4" tabindex="-1"></a><span class="do">## 762 804</span></span>
<span id="cb16-5"><a href="ip-weighting-and-marginal-structural-models.html#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="ip-weighting-and-marginal-structural-models.html#cb16-6" tabindex="-1"></a><span class="co"># estimation of denominator of ip weights</span></span>
<span id="cb16-7"><a href="ip-weighting-and-marginal-structural-models.html#cb16-7" tabindex="-1"></a>denom.fit <span class="ot">&lt;-</span></span>
<span id="cb16-8"><a href="ip-weighting-and-marginal-structural-models.html#cb16-8" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb16-9"><a href="ip-weighting-and-marginal-structural-models.html#cb16-9" tabindex="-1"></a>    qsmk <span class="sc">~</span> <span class="fu">as.factor</span>(sex) <span class="sc">+</span> <span class="fu">as.factor</span>(race) <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="ip-weighting-and-marginal-structural-models.html#cb16-10" tabindex="-1"></a>      <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span></span>
<span id="cb16-11"><a href="ip-weighting-and-marginal-structural-models.html#cb16-11" tabindex="-1"></a>      <span class="fu">I</span>(smokeintensity <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-12"><a href="ip-weighting-and-marginal-structural-models.html#cb16-12" tabindex="-1"></a>      <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71 <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb16-13"><a href="ip-weighting-and-marginal-structural-models.html#cb16-13" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb16-14"><a href="ip-weighting-and-marginal-structural-models.html#cb16-14" tabindex="-1"></a>    <span class="at">data =</span> nhefs.nmv</span>
<span id="cb16-15"><a href="ip-weighting-and-marginal-structural-models.html#cb16-15" tabindex="-1"></a>  )</span>
<span id="cb16-16"><a href="ip-weighting-and-marginal-structural-models.html#cb16-16" tabindex="-1"></a><span class="fu">summary</span>(denom.fit)</span>
<span id="cb16-17"><a href="ip-weighting-and-marginal-structural-models.html#cb16-17" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-18"><a href="ip-weighting-and-marginal-structural-models.html#cb16-18" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb16-19"><a href="ip-weighting-and-marginal-structural-models.html#cb16-19" tabindex="-1"></a><span class="do">## glm(formula = qsmk ~ as.factor(sex) + as.factor(race) + age + </span></span>
<span id="cb16-20"><a href="ip-weighting-and-marginal-structural-models.html#cb16-20" tabindex="-1"></a><span class="do">##     I(age^2) + as.factor(education) + smokeintensity + I(smokeintensity^2) + </span></span>
<span id="cb16-21"><a href="ip-weighting-and-marginal-structural-models.html#cb16-21" tabindex="-1"></a><span class="do">##     smokeyrs + I(smokeyrs^2) + as.factor(exercise) + as.factor(active) + </span></span>
<span id="cb16-22"><a href="ip-weighting-and-marginal-structural-models.html#cb16-22" tabindex="-1"></a><span class="do">##     wt71 + I(wt71^2), family = binomial(), data = nhefs.nmv)</span></span>
<span id="cb16-23"><a href="ip-weighting-and-marginal-structural-models.html#cb16-23" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-24"><a href="ip-weighting-and-marginal-structural-models.html#cb16-24" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb16-25"><a href="ip-weighting-and-marginal-structural-models.html#cb16-25" tabindex="-1"></a><span class="do">##                        Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb16-26"><a href="ip-weighting-and-marginal-structural-models.html#cb16-26" tabindex="-1"></a><span class="do">## (Intercept)           -2.242519   1.380836   -1.62  0.10437    </span></span>
<span id="cb16-27"><a href="ip-weighting-and-marginal-structural-models.html#cb16-27" tabindex="-1"></a><span class="do">## as.factor(sex)1       -0.527478   0.154050   -3.42  0.00062 ***</span></span>
<span id="cb16-28"><a href="ip-weighting-and-marginal-structural-models.html#cb16-28" tabindex="-1"></a><span class="do">## as.factor(race)1      -0.839264   0.210067   -4.00  6.5e-05 ***</span></span>
<span id="cb16-29"><a href="ip-weighting-and-marginal-structural-models.html#cb16-29" tabindex="-1"></a><span class="do">## age                    0.121205   0.051266    2.36  0.01807 *  </span></span>
<span id="cb16-30"><a href="ip-weighting-and-marginal-structural-models.html#cb16-30" tabindex="-1"></a><span class="do">## I(age^2)              -0.000825   0.000536   -1.54  0.12404    </span></span>
<span id="cb16-31"><a href="ip-weighting-and-marginal-structural-models.html#cb16-31" tabindex="-1"></a><span class="do">## as.factor(education)2 -0.028776   0.198351   -0.15  0.88465    </span></span>
<span id="cb16-32"><a href="ip-weighting-and-marginal-structural-models.html#cb16-32" tabindex="-1"></a><span class="do">## as.factor(education)3  0.086432   0.178085    0.49  0.62744    </span></span>
<span id="cb16-33"><a href="ip-weighting-and-marginal-structural-models.html#cb16-33" tabindex="-1"></a><span class="do">## as.factor(education)4  0.063601   0.273211    0.23  0.81592    </span></span>
<span id="cb16-34"><a href="ip-weighting-and-marginal-structural-models.html#cb16-34" tabindex="-1"></a><span class="do">## as.factor(education)5  0.475961   0.226224    2.10  0.03538 *  </span></span>
<span id="cb16-35"><a href="ip-weighting-and-marginal-structural-models.html#cb16-35" tabindex="-1"></a><span class="do">## smokeintensity        -0.077270   0.015250   -5.07  4.0e-07 ***</span></span>
<span id="cb16-36"><a href="ip-weighting-and-marginal-structural-models.html#cb16-36" tabindex="-1"></a><span class="do">## I(smokeintensity^2)    0.001045   0.000287    3.65  0.00027 ***</span></span>
<span id="cb16-37"><a href="ip-weighting-and-marginal-structural-models.html#cb16-37" tabindex="-1"></a><span class="do">## smokeyrs              -0.073597   0.027777   -2.65  0.00806 ** </span></span>
<span id="cb16-38"><a href="ip-weighting-and-marginal-structural-models.html#cb16-38" tabindex="-1"></a><span class="do">## I(smokeyrs^2)          0.000844   0.000463    1.82  0.06840 .  </span></span>
<span id="cb16-39"><a href="ip-weighting-and-marginal-structural-models.html#cb16-39" tabindex="-1"></a><span class="do">## as.factor(exercise)1   0.354841   0.180135    1.97  0.04885 *  </span></span>
<span id="cb16-40"><a href="ip-weighting-and-marginal-structural-models.html#cb16-40" tabindex="-1"></a><span class="do">## as.factor(exercise)2   0.395704   0.187240    2.11  0.03457 *  </span></span>
<span id="cb16-41"><a href="ip-weighting-and-marginal-structural-models.html#cb16-41" tabindex="-1"></a><span class="do">## as.factor(active)1     0.031944   0.132937    0.24  0.81010    </span></span>
<span id="cb16-42"><a href="ip-weighting-and-marginal-structural-models.html#cb16-42" tabindex="-1"></a><span class="do">## as.factor(active)2     0.176784   0.214972    0.82  0.41087    </span></span>
<span id="cb16-43"><a href="ip-weighting-and-marginal-structural-models.html#cb16-43" tabindex="-1"></a><span class="do">## wt71                  -0.015236   0.026316   -0.58  0.56262    </span></span>
<span id="cb16-44"><a href="ip-weighting-and-marginal-structural-models.html#cb16-44" tabindex="-1"></a><span class="do">## I(wt71^2)              0.000135   0.000163    0.83  0.40737    </span></span>
<span id="cb16-45"><a href="ip-weighting-and-marginal-structural-models.html#cb16-45" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb16-46"><a href="ip-weighting-and-marginal-structural-models.html#cb16-46" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb16-47"><a href="ip-weighting-and-marginal-structural-models.html#cb16-47" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-48"><a href="ip-weighting-and-marginal-structural-models.html#cb16-48" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb16-49"><a href="ip-weighting-and-marginal-structural-models.html#cb16-49" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-50"><a href="ip-weighting-and-marginal-structural-models.html#cb16-50" tabindex="-1"></a><span class="do">##     Null deviance: 1786.1  on 1565  degrees of freedom</span></span>
<span id="cb16-51"><a href="ip-weighting-and-marginal-structural-models.html#cb16-51" tabindex="-1"></a><span class="do">## Residual deviance: 1676.9  on 1547  degrees of freedom</span></span>
<span id="cb16-52"><a href="ip-weighting-and-marginal-structural-models.html#cb16-52" tabindex="-1"></a><span class="do">## AIC: 1715</span></span>
<span id="cb16-53"><a href="ip-weighting-and-marginal-structural-models.html#cb16-53" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-54"><a href="ip-weighting-and-marginal-structural-models.html#cb16-54" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb16-55"><a href="ip-weighting-and-marginal-structural-models.html#cb16-55" tabindex="-1"></a></span>
<span id="cb16-56"><a href="ip-weighting-and-marginal-structural-models.html#cb16-56" tabindex="-1"></a>pd.qsmk <span class="ot">&lt;-</span> <span class="fu">predict</span>(denom.fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb16-57"><a href="ip-weighting-and-marginal-structural-models.html#cb16-57" tabindex="-1"></a></span>
<span id="cb16-58"><a href="ip-weighting-and-marginal-structural-models.html#cb16-58" tabindex="-1"></a><span class="co"># estimation of numerator of ip weights</span></span>
<span id="cb16-59"><a href="ip-weighting-and-marginal-structural-models.html#cb16-59" tabindex="-1"></a>numer.fit <span class="ot">&lt;-</span></span>
<span id="cb16-60"><a href="ip-weighting-and-marginal-structural-models.html#cb16-60" tabindex="-1"></a>  <span class="fu">glm</span>(qsmk <span class="sc">~</span> <span class="fu">as.factor</span>(sex), <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">data =</span> nhefs.nmv)</span>
<span id="cb16-61"><a href="ip-weighting-and-marginal-structural-models.html#cb16-61" tabindex="-1"></a><span class="fu">summary</span>(numer.fit)</span>
<span id="cb16-62"><a href="ip-weighting-and-marginal-structural-models.html#cb16-62" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-63"><a href="ip-weighting-and-marginal-structural-models.html#cb16-63" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb16-64"><a href="ip-weighting-and-marginal-structural-models.html#cb16-64" tabindex="-1"></a><span class="do">## glm(formula = qsmk ~ as.factor(sex), family = binomial(), data = nhefs.nmv)</span></span>
<span id="cb16-65"><a href="ip-weighting-and-marginal-structural-models.html#cb16-65" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-66"><a href="ip-weighting-and-marginal-structural-models.html#cb16-66" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb16-67"><a href="ip-weighting-and-marginal-structural-models.html#cb16-67" tabindex="-1"></a><span class="do">##                 Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb16-68"><a href="ip-weighting-and-marginal-structural-models.html#cb16-68" tabindex="-1"></a><span class="do">## (Intercept)      -0.9016     0.0799  -11.28   &lt;2e-16 ***</span></span>
<span id="cb16-69"><a href="ip-weighting-and-marginal-structural-models.html#cb16-69" tabindex="-1"></a><span class="do">## as.factor(sex)1  -0.3202     0.1160   -2.76   0.0058 ** </span></span>
<span id="cb16-70"><a href="ip-weighting-and-marginal-structural-models.html#cb16-70" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb16-71"><a href="ip-weighting-and-marginal-structural-models.html#cb16-71" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb16-72"><a href="ip-weighting-and-marginal-structural-models.html#cb16-72" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-73"><a href="ip-weighting-and-marginal-structural-models.html#cb16-73" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb16-74"><a href="ip-weighting-and-marginal-structural-models.html#cb16-74" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-75"><a href="ip-weighting-and-marginal-structural-models.html#cb16-75" tabindex="-1"></a><span class="do">##     Null deviance: 1786.1  on 1565  degrees of freedom</span></span>
<span id="cb16-76"><a href="ip-weighting-and-marginal-structural-models.html#cb16-76" tabindex="-1"></a><span class="do">## Residual deviance: 1778.4  on 1564  degrees of freedom</span></span>
<span id="cb16-77"><a href="ip-weighting-and-marginal-structural-models.html#cb16-77" tabindex="-1"></a><span class="do">## AIC: 1782</span></span>
<span id="cb16-78"><a href="ip-weighting-and-marginal-structural-models.html#cb16-78" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-79"><a href="ip-weighting-and-marginal-structural-models.html#cb16-79" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb16-80"><a href="ip-weighting-and-marginal-structural-models.html#cb16-80" tabindex="-1"></a>pn.qsmk <span class="ot">&lt;-</span> <span class="fu">predict</span>(numer.fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb16-81"><a href="ip-weighting-and-marginal-structural-models.html#cb16-81" tabindex="-1"></a></span>
<span id="cb16-82"><a href="ip-weighting-and-marginal-structural-models.html#cb16-82" tabindex="-1"></a>nhefs.nmv<span class="sc">$</span>sw.a <span class="ot">&lt;-</span></span>
<span id="cb16-83"><a href="ip-weighting-and-marginal-structural-models.html#cb16-83" tabindex="-1"></a>  <span class="fu">ifelse</span>(nhefs.nmv<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">0</span>, ((<span class="dv">1</span> <span class="sc">-</span> pn.qsmk) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> pd.qsmk)),</span>
<span id="cb16-84"><a href="ip-weighting-and-marginal-structural-models.html#cb16-84" tabindex="-1"></a>         (pn.qsmk <span class="sc">/</span> pd.qsmk))</span>
<span id="cb16-85"><a href="ip-weighting-and-marginal-structural-models.html#cb16-85" tabindex="-1"></a></span>
<span id="cb16-86"><a href="ip-weighting-and-marginal-structural-models.html#cb16-86" tabindex="-1"></a><span class="fu">summary</span>(nhefs.nmv<span class="sc">$</span>sw.a)</span>
<span id="cb16-87"><a href="ip-weighting-and-marginal-structural-models.html#cb16-87" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb16-88"><a href="ip-weighting-and-marginal-structural-models.html#cb16-88" tabindex="-1"></a><span class="do">##    0.29    0.88    0.96    1.00    1.08    3.80</span></span>
<span id="cb16-89"><a href="ip-weighting-and-marginal-structural-models.html#cb16-89" tabindex="-1"></a><span class="fu">sd</span>(nhefs.nmv<span class="sc">$</span>sw.a)</span>
<span id="cb16-90"><a href="ip-weighting-and-marginal-structural-models.html#cb16-90" tabindex="-1"></a><span class="do">## [1] 0.271</span></span>
<span id="cb16-91"><a href="ip-weighting-and-marginal-structural-models.html#cb16-91" tabindex="-1"></a></span>
<span id="cb16-92"><a href="ip-weighting-and-marginal-structural-models.html#cb16-92" tabindex="-1"></a><span class="co"># Estimating parameters of a marginal structural mean model</span></span>
<span id="cb16-93"><a href="ip-weighting-and-marginal-structural-models.html#cb16-93" tabindex="-1"></a>msm.emm <span class="ot">&lt;-</span> <span class="fu">geeglm</span>(</span>
<span id="cb16-94"><a href="ip-weighting-and-marginal-structural-models.html#cb16-94" tabindex="-1"></a>  wt82_71 <span class="sc">~</span> <span class="fu">as.factor</span>(qsmk) <span class="sc">+</span> <span class="fu">as.factor</span>(sex)</span>
<span id="cb16-95"><a href="ip-weighting-and-marginal-structural-models.html#cb16-95" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">as.factor</span>(qsmk)<span class="sc">:</span><span class="fu">as.factor</span>(sex),</span>
<span id="cb16-96"><a href="ip-weighting-and-marginal-structural-models.html#cb16-96" tabindex="-1"></a>  <span class="at">data =</span> nhefs.nmv,</span>
<span id="cb16-97"><a href="ip-weighting-and-marginal-structural-models.html#cb16-97" tabindex="-1"></a>  <span class="at">weights =</span> sw.a,</span>
<span id="cb16-98"><a href="ip-weighting-and-marginal-structural-models.html#cb16-98" tabindex="-1"></a>  <span class="at">id =</span> seqn,</span>
<span id="cb16-99"><a href="ip-weighting-and-marginal-structural-models.html#cb16-99" tabindex="-1"></a>  <span class="at">corstr =</span> <span class="st">&quot;independence&quot;</span></span>
<span id="cb16-100"><a href="ip-weighting-and-marginal-structural-models.html#cb16-100" tabindex="-1"></a>)</span>
<span id="cb16-101"><a href="ip-weighting-and-marginal-structural-models.html#cb16-101" tabindex="-1"></a><span class="fu">summary</span>(msm.emm)</span>
<span id="cb16-102"><a href="ip-weighting-and-marginal-structural-models.html#cb16-102" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-103"><a href="ip-weighting-and-marginal-structural-models.html#cb16-103" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb16-104"><a href="ip-weighting-and-marginal-structural-models.html#cb16-104" tabindex="-1"></a><span class="do">## geeglm(formula = wt82_71 ~ as.factor(qsmk) + as.factor(sex) + </span></span>
<span id="cb16-105"><a href="ip-weighting-and-marginal-structural-models.html#cb16-105" tabindex="-1"></a><span class="do">##     as.factor(qsmk):as.factor(sex), data = nhefs.nmv, weights = sw.a, </span></span>
<span id="cb16-106"><a href="ip-weighting-and-marginal-structural-models.html#cb16-106" tabindex="-1"></a><span class="do">##     id = seqn, corstr = &quot;independence&quot;)</span></span>
<span id="cb16-107"><a href="ip-weighting-and-marginal-structural-models.html#cb16-107" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-108"><a href="ip-weighting-and-marginal-structural-models.html#cb16-108" tabindex="-1"></a><span class="do">##  Coefficients:</span></span>
<span id="cb16-109"><a href="ip-weighting-and-marginal-structural-models.html#cb16-109" tabindex="-1"></a><span class="do">##                                  Estimate  Std.err  Wald Pr(&gt;|W|)    </span></span>
<span id="cb16-110"><a href="ip-weighting-and-marginal-structural-models.html#cb16-110" tabindex="-1"></a><span class="do">## (Intercept)                       1.78445  0.30984 33.17  8.5e-09 ***</span></span>
<span id="cb16-111"><a href="ip-weighting-and-marginal-structural-models.html#cb16-111" tabindex="-1"></a><span class="do">## as.factor(qsmk)1                  3.52198  0.65707 28.73  8.3e-08 ***</span></span>
<span id="cb16-112"><a href="ip-weighting-and-marginal-structural-models.html#cb16-112" tabindex="-1"></a><span class="do">## as.factor(sex)1                  -0.00872  0.44882  0.00     0.98    </span></span>
<span id="cb16-113"><a href="ip-weighting-and-marginal-structural-models.html#cb16-113" tabindex="-1"></a><span class="do">## as.factor(qsmk)1:as.factor(sex)1 -0.15948  1.04608  0.02     0.88    </span></span>
<span id="cb16-114"><a href="ip-weighting-and-marginal-structural-models.html#cb16-114" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb16-115"><a href="ip-weighting-and-marginal-structural-models.html#cb16-115" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb16-116"><a href="ip-weighting-and-marginal-structural-models.html#cb16-116" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-117"><a href="ip-weighting-and-marginal-structural-models.html#cb16-117" tabindex="-1"></a><span class="do">## Correlation structure = independence </span></span>
<span id="cb16-118"><a href="ip-weighting-and-marginal-structural-models.html#cb16-118" tabindex="-1"></a><span class="do">## Estimated Scale Parameters:</span></span>
<span id="cb16-119"><a href="ip-weighting-and-marginal-structural-models.html#cb16-119" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb16-120"><a href="ip-weighting-and-marginal-structural-models.html#cb16-120" tabindex="-1"></a><span class="do">##             Estimate Std.err</span></span>
<span id="cb16-121"><a href="ip-weighting-and-marginal-structural-models.html#cb16-121" tabindex="-1"></a><span class="do">## (Intercept)     60.8    3.71</span></span>
<span id="cb16-122"><a href="ip-weighting-and-marginal-structural-models.html#cb16-122" tabindex="-1"></a><span class="do">## Number of clusters:   1566  Maximum cluster size: 1</span></span>
<span id="cb16-123"><a href="ip-weighting-and-marginal-structural-models.html#cb16-123" tabindex="-1"></a></span>
<span id="cb16-124"><a href="ip-weighting-and-marginal-structural-models.html#cb16-124" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(msm.emm)</span>
<span id="cb16-125"><a href="ip-weighting-and-marginal-structural-models.html#cb16-125" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(msm.emm))[, <span class="dv">2</span>]</span>
<span id="cb16-126"><a href="ip-weighting-and-marginal-structural-models.html#cb16-126" tabindex="-1"></a>lcl <span class="ot">&lt;-</span> beta <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb16-127"><a href="ip-weighting-and-marginal-structural-models.html#cb16-127" tabindex="-1"></a>ucl <span class="ot">&lt;-</span> beta <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb16-128"><a href="ip-weighting-and-marginal-structural-models.html#cb16-128" tabindex="-1"></a><span class="fu">cbind</span>(beta, lcl, ucl)</span>
<span id="cb16-129"><a href="ip-weighting-and-marginal-structural-models.html#cb16-129" tabindex="-1"></a><span class="do">##                                      beta    lcl   ucl</span></span>
<span id="cb16-130"><a href="ip-weighting-and-marginal-structural-models.html#cb16-130" tabindex="-1"></a><span class="do">## (Intercept)                       1.78445  1.177 2.392</span></span>
<span id="cb16-131"><a href="ip-weighting-and-marginal-structural-models.html#cb16-131" tabindex="-1"></a><span class="do">## as.factor(qsmk)1                  3.52198  2.234 4.810</span></span>
<span id="cb16-132"><a href="ip-weighting-and-marginal-structural-models.html#cb16-132" tabindex="-1"></a><span class="do">## as.factor(sex)1                  -0.00872 -0.888 0.871</span></span>
<span id="cb16-133"><a href="ip-weighting-and-marginal-structural-models.html#cb16-133" tabindex="-1"></a><span class="do">## as.factor(qsmk)1:as.factor(sex)1 -0.15948 -2.210 1.891</span></span></code></pre></div>
</div>
<div id="program-12.7" class="section level2 hasAnchor">
<h2>Program 12.7<a href="ip-weighting-and-marginal-structural-models.html#program-12.7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating IP weights to adjust for selection bias due to censoring</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="ip-weighting-and-marginal-structural-models.html#cb17-1" tabindex="-1"></a><span class="fu">table</span>(nhefs<span class="sc">$</span>qsmk, nhefs<span class="sc">$</span>cens)</span>
<span id="cb17-2"><a href="ip-weighting-and-marginal-structural-models.html#cb17-2" tabindex="-1"></a><span class="do">##    </span></span>
<span id="cb17-3"><a href="ip-weighting-and-marginal-structural-models.html#cb17-3" tabindex="-1"></a><span class="do">##        0    1</span></span>
<span id="cb17-4"><a href="ip-weighting-and-marginal-structural-models.html#cb17-4" tabindex="-1"></a><span class="do">##   0 1163   38</span></span>
<span id="cb17-5"><a href="ip-weighting-and-marginal-structural-models.html#cb17-5" tabindex="-1"></a><span class="do">##   1  403   25</span></span>
<span id="cb17-6"><a href="ip-weighting-and-marginal-structural-models.html#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="ip-weighting-and-marginal-structural-models.html#cb17-7" tabindex="-1"></a><span class="fu">summary</span>(nhefs[<span class="fu">which</span>(nhefs<span class="sc">$</span>cens <span class="sc">==</span> <span class="dv">0</span>),]<span class="sc">$</span>wt71)</span>
<span id="cb17-8"><a href="ip-weighting-and-marginal-structural-models.html#cb17-8" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb17-9"><a href="ip-weighting-and-marginal-structural-models.html#cb17-9" tabindex="-1"></a><span class="do">##    39.6    59.5    69.2    70.8    79.8   151.7</span></span>
<span id="cb17-10"><a href="ip-weighting-and-marginal-structural-models.html#cb17-10" tabindex="-1"></a><span class="fu">summary</span>(nhefs[<span class="fu">which</span>(nhefs<span class="sc">$</span>cens <span class="sc">==</span> <span class="dv">1</span>),]<span class="sc">$</span>wt71)</span>
<span id="cb17-11"><a href="ip-weighting-and-marginal-structural-models.html#cb17-11" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb17-12"><a href="ip-weighting-and-marginal-structural-models.html#cb17-12" tabindex="-1"></a><span class="do">##    36.2    63.1    72.1    76.6    87.9   169.2</span></span>
<span id="cb17-13"><a href="ip-weighting-and-marginal-structural-models.html#cb17-13" tabindex="-1"></a></span>
<span id="cb17-14"><a href="ip-weighting-and-marginal-structural-models.html#cb17-14" tabindex="-1"></a><span class="co"># estimation of denominator of ip weights for A</span></span>
<span id="cb17-15"><a href="ip-weighting-and-marginal-structural-models.html#cb17-15" tabindex="-1"></a>denom.fit <span class="ot">&lt;-</span></span>
<span id="cb17-16"><a href="ip-weighting-and-marginal-structural-models.html#cb17-16" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb17-17"><a href="ip-weighting-and-marginal-structural-models.html#cb17-17" tabindex="-1"></a>    qsmk <span class="sc">~</span> <span class="fu">as.factor</span>(sex) <span class="sc">+</span> <span class="fu">as.factor</span>(race) <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-18"><a href="ip-weighting-and-marginal-structural-models.html#cb17-18" tabindex="-1"></a>      <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span></span>
<span id="cb17-19"><a href="ip-weighting-and-marginal-structural-models.html#cb17-19" tabindex="-1"></a>      <span class="fu">I</span>(smokeintensity <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-20"><a href="ip-weighting-and-marginal-structural-models.html#cb17-20" tabindex="-1"></a>      <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71 <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb17-21"><a href="ip-weighting-and-marginal-structural-models.html#cb17-21" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb17-22"><a href="ip-weighting-and-marginal-structural-models.html#cb17-22" tabindex="-1"></a>    <span class="at">data =</span> nhefs</span>
<span id="cb17-23"><a href="ip-weighting-and-marginal-structural-models.html#cb17-23" tabindex="-1"></a>  )</span>
<span id="cb17-24"><a href="ip-weighting-and-marginal-structural-models.html#cb17-24" tabindex="-1"></a><span class="fu">summary</span>(denom.fit)</span>
<span id="cb17-25"><a href="ip-weighting-and-marginal-structural-models.html#cb17-25" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-26"><a href="ip-weighting-and-marginal-structural-models.html#cb17-26" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb17-27"><a href="ip-weighting-and-marginal-structural-models.html#cb17-27" tabindex="-1"></a><span class="do">## glm(formula = qsmk ~ as.factor(sex) + as.factor(race) + age + </span></span>
<span id="cb17-28"><a href="ip-weighting-and-marginal-structural-models.html#cb17-28" tabindex="-1"></a><span class="do">##     I(age^2) + as.factor(education) + smokeintensity + I(smokeintensity^2) + </span></span>
<span id="cb17-29"><a href="ip-weighting-and-marginal-structural-models.html#cb17-29" tabindex="-1"></a><span class="do">##     smokeyrs + I(smokeyrs^2) + as.factor(exercise) + as.factor(active) + </span></span>
<span id="cb17-30"><a href="ip-weighting-and-marginal-structural-models.html#cb17-30" tabindex="-1"></a><span class="do">##     wt71 + I(wt71^2), family = binomial(), data = nhefs)</span></span>
<span id="cb17-31"><a href="ip-weighting-and-marginal-structural-models.html#cb17-31" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-32"><a href="ip-weighting-and-marginal-structural-models.html#cb17-32" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb17-33"><a href="ip-weighting-and-marginal-structural-models.html#cb17-33" tabindex="-1"></a><span class="do">##                        Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb17-34"><a href="ip-weighting-and-marginal-structural-models.html#cb17-34" tabindex="-1"></a><span class="do">## (Intercept)           -1.988902   1.241279   -1.60  0.10909    </span></span>
<span id="cb17-35"><a href="ip-weighting-and-marginal-structural-models.html#cb17-35" tabindex="-1"></a><span class="do">## as.factor(sex)1       -0.507522   0.148232   -3.42  0.00062 ***</span></span>
<span id="cb17-36"><a href="ip-weighting-and-marginal-structural-models.html#cb17-36" tabindex="-1"></a><span class="do">## as.factor(race)1      -0.850231   0.205872   -4.13  3.6e-05 ***</span></span>
<span id="cb17-37"><a href="ip-weighting-and-marginal-structural-models.html#cb17-37" tabindex="-1"></a><span class="do">## age                    0.103013   0.048900    2.11  0.03515 *  </span></span>
<span id="cb17-38"><a href="ip-weighting-and-marginal-structural-models.html#cb17-38" tabindex="-1"></a><span class="do">## I(age^2)              -0.000605   0.000507   -1.19  0.23297    </span></span>
<span id="cb17-39"><a href="ip-weighting-and-marginal-structural-models.html#cb17-39" tabindex="-1"></a><span class="do">## as.factor(education)2 -0.098320   0.190655   -0.52  0.60607    </span></span>
<span id="cb17-40"><a href="ip-weighting-and-marginal-structural-models.html#cb17-40" tabindex="-1"></a><span class="do">## as.factor(education)3  0.015699   0.170714    0.09  0.92673    </span></span>
<span id="cb17-41"><a href="ip-weighting-and-marginal-structural-models.html#cb17-41" tabindex="-1"></a><span class="do">## as.factor(education)4 -0.042526   0.264276   -0.16  0.87216    </span></span>
<span id="cb17-42"><a href="ip-weighting-and-marginal-structural-models.html#cb17-42" tabindex="-1"></a><span class="do">## as.factor(education)5  0.379663   0.220395    1.72  0.08495 .  </span></span>
<span id="cb17-43"><a href="ip-weighting-and-marginal-structural-models.html#cb17-43" tabindex="-1"></a><span class="do">## smokeintensity        -0.065156   0.014759   -4.41  1.0e-05 ***</span></span>
<span id="cb17-44"><a href="ip-weighting-and-marginal-structural-models.html#cb17-44" tabindex="-1"></a><span class="do">## I(smokeintensity^2)    0.000846   0.000276    3.07  0.00216 ** </span></span>
<span id="cb17-45"><a href="ip-weighting-and-marginal-structural-models.html#cb17-45" tabindex="-1"></a><span class="do">## smokeyrs              -0.073371   0.026996   -2.72  0.00657 ** </span></span>
<span id="cb17-46"><a href="ip-weighting-and-marginal-structural-models.html#cb17-46" tabindex="-1"></a><span class="do">## I(smokeyrs^2)          0.000838   0.000443    1.89  0.05867 .  </span></span>
<span id="cb17-47"><a href="ip-weighting-and-marginal-structural-models.html#cb17-47" tabindex="-1"></a><span class="do">## as.factor(exercise)1   0.291412   0.173554    1.68  0.09314 .  </span></span>
<span id="cb17-48"><a href="ip-weighting-and-marginal-structural-models.html#cb17-48" tabindex="-1"></a><span class="do">## as.factor(exercise)2   0.355052   0.179929    1.97  0.04846 *  </span></span>
<span id="cb17-49"><a href="ip-weighting-and-marginal-structural-models.html#cb17-49" tabindex="-1"></a><span class="do">## as.factor(active)1     0.010875   0.129832    0.08  0.93324    </span></span>
<span id="cb17-50"><a href="ip-weighting-and-marginal-structural-models.html#cb17-50" tabindex="-1"></a><span class="do">## as.factor(active)2     0.068312   0.208727    0.33  0.74346    </span></span>
<span id="cb17-51"><a href="ip-weighting-and-marginal-structural-models.html#cb17-51" tabindex="-1"></a><span class="do">## wt71                  -0.012848   0.022283   -0.58  0.56423    </span></span>
<span id="cb17-52"><a href="ip-weighting-and-marginal-structural-models.html#cb17-52" tabindex="-1"></a><span class="do">## I(wt71^2)              0.000121   0.000135    0.89  0.37096    </span></span>
<span id="cb17-53"><a href="ip-weighting-and-marginal-structural-models.html#cb17-53" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb17-54"><a href="ip-weighting-and-marginal-structural-models.html#cb17-54" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb17-55"><a href="ip-weighting-and-marginal-structural-models.html#cb17-55" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-56"><a href="ip-weighting-and-marginal-structural-models.html#cb17-56" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb17-57"><a href="ip-weighting-and-marginal-structural-models.html#cb17-57" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-58"><a href="ip-weighting-and-marginal-structural-models.html#cb17-58" tabindex="-1"></a><span class="do">##     Null deviance: 1876.3  on 1628  degrees of freedom</span></span>
<span id="cb17-59"><a href="ip-weighting-and-marginal-structural-models.html#cb17-59" tabindex="-1"></a><span class="do">## Residual deviance: 1766.7  on 1610  degrees of freedom</span></span>
<span id="cb17-60"><a href="ip-weighting-and-marginal-structural-models.html#cb17-60" tabindex="-1"></a><span class="do">## AIC: 1805</span></span>
<span id="cb17-61"><a href="ip-weighting-and-marginal-structural-models.html#cb17-61" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-62"><a href="ip-weighting-and-marginal-structural-models.html#cb17-62" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb17-63"><a href="ip-weighting-and-marginal-structural-models.html#cb17-63" tabindex="-1"></a></span>
<span id="cb17-64"><a href="ip-weighting-and-marginal-structural-models.html#cb17-64" tabindex="-1"></a>pd.qsmk <span class="ot">&lt;-</span> <span class="fu">predict</span>(denom.fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb17-65"><a href="ip-weighting-and-marginal-structural-models.html#cb17-65" tabindex="-1"></a></span>
<span id="cb17-66"><a href="ip-weighting-and-marginal-structural-models.html#cb17-66" tabindex="-1"></a><span class="co"># estimation of numerator of ip weights for A</span></span>
<span id="cb17-67"><a href="ip-weighting-and-marginal-structural-models.html#cb17-67" tabindex="-1"></a>numer.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(qsmk <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">data =</span> nhefs)</span>
<span id="cb17-68"><a href="ip-weighting-and-marginal-structural-models.html#cb17-68" tabindex="-1"></a><span class="fu">summary</span>(numer.fit)</span>
<span id="cb17-69"><a href="ip-weighting-and-marginal-structural-models.html#cb17-69" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-70"><a href="ip-weighting-and-marginal-structural-models.html#cb17-70" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb17-71"><a href="ip-weighting-and-marginal-structural-models.html#cb17-71" tabindex="-1"></a><span class="do">## glm(formula = qsmk ~ 1, family = binomial(), data = nhefs)</span></span>
<span id="cb17-72"><a href="ip-weighting-and-marginal-structural-models.html#cb17-72" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-73"><a href="ip-weighting-and-marginal-structural-models.html#cb17-73" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb17-74"><a href="ip-weighting-and-marginal-structural-models.html#cb17-74" tabindex="-1"></a><span class="do">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb17-75"><a href="ip-weighting-and-marginal-structural-models.html#cb17-75" tabindex="-1"></a><span class="do">## (Intercept)  -1.0318     0.0563   -18.3   &lt;2e-16 ***</span></span>
<span id="cb17-76"><a href="ip-weighting-and-marginal-structural-models.html#cb17-76" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb17-77"><a href="ip-weighting-and-marginal-structural-models.html#cb17-77" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb17-78"><a href="ip-weighting-and-marginal-structural-models.html#cb17-78" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-79"><a href="ip-weighting-and-marginal-structural-models.html#cb17-79" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb17-80"><a href="ip-weighting-and-marginal-structural-models.html#cb17-80" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-81"><a href="ip-weighting-and-marginal-structural-models.html#cb17-81" tabindex="-1"></a><span class="do">##     Null deviance: 1876.3  on 1628  degrees of freedom</span></span>
<span id="cb17-82"><a href="ip-weighting-and-marginal-structural-models.html#cb17-82" tabindex="-1"></a><span class="do">## Residual deviance: 1876.3  on 1628  degrees of freedom</span></span>
<span id="cb17-83"><a href="ip-weighting-and-marginal-structural-models.html#cb17-83" tabindex="-1"></a><span class="do">## AIC: 1878</span></span>
<span id="cb17-84"><a href="ip-weighting-and-marginal-structural-models.html#cb17-84" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-85"><a href="ip-weighting-and-marginal-structural-models.html#cb17-85" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 4</span></span>
<span id="cb17-86"><a href="ip-weighting-and-marginal-structural-models.html#cb17-86" tabindex="-1"></a>pn.qsmk <span class="ot">&lt;-</span> <span class="fu">predict</span>(numer.fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb17-87"><a href="ip-weighting-and-marginal-structural-models.html#cb17-87" tabindex="-1"></a></span>
<span id="cb17-88"><a href="ip-weighting-and-marginal-structural-models.html#cb17-88" tabindex="-1"></a><span class="co"># estimation of denominator of ip weights for C</span></span>
<span id="cb17-89"><a href="ip-weighting-and-marginal-structural-models.html#cb17-89" tabindex="-1"></a>denom.cens <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb17-90"><a href="ip-weighting-and-marginal-structural-models.html#cb17-90" tabindex="-1"></a>  cens <span class="sc">~</span> <span class="fu">as.factor</span>(qsmk) <span class="sc">+</span> <span class="fu">as.factor</span>(sex) <span class="sc">+</span></span>
<span id="cb17-91"><a href="ip-weighting-and-marginal-structural-models.html#cb17-91" tabindex="-1"></a>    <span class="fu">as.factor</span>(race) <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-92"><a href="ip-weighting-and-marginal-structural-models.html#cb17-92" tabindex="-1"></a>    <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span></span>
<span id="cb17-93"><a href="ip-weighting-and-marginal-structural-models.html#cb17-93" tabindex="-1"></a>    <span class="fu">I</span>(smokeintensity <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span> smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-94"><a href="ip-weighting-and-marginal-structural-models.html#cb17-94" tabindex="-1"></a>    <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71 <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb17-95"><a href="ip-weighting-and-marginal-structural-models.html#cb17-95" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb17-96"><a href="ip-weighting-and-marginal-structural-models.html#cb17-96" tabindex="-1"></a>  <span class="at">data =</span> nhefs</span>
<span id="cb17-97"><a href="ip-weighting-and-marginal-structural-models.html#cb17-97" tabindex="-1"></a>)</span>
<span id="cb17-98"><a href="ip-weighting-and-marginal-structural-models.html#cb17-98" tabindex="-1"></a><span class="fu">summary</span>(denom.cens)</span>
<span id="cb17-99"><a href="ip-weighting-and-marginal-structural-models.html#cb17-99" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-100"><a href="ip-weighting-and-marginal-structural-models.html#cb17-100" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb17-101"><a href="ip-weighting-and-marginal-structural-models.html#cb17-101" tabindex="-1"></a><span class="do">## glm(formula = cens ~ as.factor(qsmk) + as.factor(sex) + as.factor(race) + </span></span>
<span id="cb17-102"><a href="ip-weighting-and-marginal-structural-models.html#cb17-102" tabindex="-1"></a><span class="do">##     age + I(age^2) + as.factor(education) + smokeintensity + </span></span>
<span id="cb17-103"><a href="ip-weighting-and-marginal-structural-models.html#cb17-103" tabindex="-1"></a><span class="do">##     I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + as.factor(exercise) + </span></span>
<span id="cb17-104"><a href="ip-weighting-and-marginal-structural-models.html#cb17-104" tabindex="-1"></a><span class="do">##     as.factor(active) + wt71 + I(wt71^2), family = binomial(), </span></span>
<span id="cb17-105"><a href="ip-weighting-and-marginal-structural-models.html#cb17-105" tabindex="-1"></a><span class="do">##     data = nhefs)</span></span>
<span id="cb17-106"><a href="ip-weighting-and-marginal-structural-models.html#cb17-106" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-107"><a href="ip-weighting-and-marginal-structural-models.html#cb17-107" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb17-108"><a href="ip-weighting-and-marginal-structural-models.html#cb17-108" tabindex="-1"></a><span class="do">##                        Estimate Std. Error z value Pr(&gt;|z|)   </span></span>
<span id="cb17-109"><a href="ip-weighting-and-marginal-structural-models.html#cb17-109" tabindex="-1"></a><span class="do">## (Intercept)            4.014466   2.576106    1.56   0.1192   </span></span>
<span id="cb17-110"><a href="ip-weighting-and-marginal-structural-models.html#cb17-110" tabindex="-1"></a><span class="do">## as.factor(qsmk)1       0.516867   0.287716    1.80   0.0724 . </span></span>
<span id="cb17-111"><a href="ip-weighting-and-marginal-structural-models.html#cb17-111" tabindex="-1"></a><span class="do">## as.factor(sex)1        0.057313   0.330278    0.17   0.8622   </span></span>
<span id="cb17-112"><a href="ip-weighting-and-marginal-structural-models.html#cb17-112" tabindex="-1"></a><span class="do">## as.factor(race)1      -0.012271   0.452489   -0.03   0.9784   </span></span>
<span id="cb17-113"><a href="ip-weighting-and-marginal-structural-models.html#cb17-113" tabindex="-1"></a><span class="do">## age                   -0.269729   0.117465   -2.30   0.0217 * </span></span>
<span id="cb17-114"><a href="ip-weighting-and-marginal-structural-models.html#cb17-114" tabindex="-1"></a><span class="do">## I(age^2)               0.002884   0.001114    2.59   0.0096 **</span></span>
<span id="cb17-115"><a href="ip-weighting-and-marginal-structural-models.html#cb17-115" tabindex="-1"></a><span class="do">## as.factor(education)2 -0.440788   0.419399   -1.05   0.2933   </span></span>
<span id="cb17-116"><a href="ip-weighting-and-marginal-structural-models.html#cb17-116" tabindex="-1"></a><span class="do">## as.factor(education)3 -0.164688   0.370547   -0.44   0.6567   </span></span>
<span id="cb17-117"><a href="ip-weighting-and-marginal-structural-models.html#cb17-117" tabindex="-1"></a><span class="do">## as.factor(education)4  0.138447   0.569797    0.24   0.8080   </span></span>
<span id="cb17-118"><a href="ip-weighting-and-marginal-structural-models.html#cb17-118" tabindex="-1"></a><span class="do">## as.factor(education)5 -0.382382   0.560181   -0.68   0.4949   </span></span>
<span id="cb17-119"><a href="ip-weighting-and-marginal-structural-models.html#cb17-119" tabindex="-1"></a><span class="do">## smokeintensity         0.015712   0.034732    0.45   0.6510   </span></span>
<span id="cb17-120"><a href="ip-weighting-and-marginal-structural-models.html#cb17-120" tabindex="-1"></a><span class="do">## I(smokeintensity^2)   -0.000113   0.000606   -0.19   0.8517   </span></span>
<span id="cb17-121"><a href="ip-weighting-and-marginal-structural-models.html#cb17-121" tabindex="-1"></a><span class="do">## smokeyrs               0.078597   0.074958    1.05   0.2944   </span></span>
<span id="cb17-122"><a href="ip-weighting-and-marginal-structural-models.html#cb17-122" tabindex="-1"></a><span class="do">## I(smokeyrs^2)         -0.000557   0.001032   -0.54   0.5894   </span></span>
<span id="cb17-123"><a href="ip-weighting-and-marginal-structural-models.html#cb17-123" tabindex="-1"></a><span class="do">## as.factor(exercise)1  -0.971471   0.387810   -2.51   0.0122 * </span></span>
<span id="cb17-124"><a href="ip-weighting-and-marginal-structural-models.html#cb17-124" tabindex="-1"></a><span class="do">## as.factor(exercise)2  -0.583989   0.372313   -1.57   0.1168   </span></span>
<span id="cb17-125"><a href="ip-weighting-and-marginal-structural-models.html#cb17-125" tabindex="-1"></a><span class="do">## as.factor(active)1    -0.247479   0.325455   -0.76   0.4470   </span></span>
<span id="cb17-126"><a href="ip-weighting-and-marginal-structural-models.html#cb17-126" tabindex="-1"></a><span class="do">## as.factor(active)2     0.706583   0.396458    1.78   0.0747 . </span></span>
<span id="cb17-127"><a href="ip-weighting-and-marginal-structural-models.html#cb17-127" tabindex="-1"></a><span class="do">## wt71                  -0.087887   0.040012   -2.20   0.0281 * </span></span>
<span id="cb17-128"><a href="ip-weighting-and-marginal-structural-models.html#cb17-128" tabindex="-1"></a><span class="do">## I(wt71^2)              0.000635   0.000226    2.81   0.0049 **</span></span>
<span id="cb17-129"><a href="ip-weighting-and-marginal-structural-models.html#cb17-129" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb17-130"><a href="ip-weighting-and-marginal-structural-models.html#cb17-130" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb17-131"><a href="ip-weighting-and-marginal-structural-models.html#cb17-131" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-132"><a href="ip-weighting-and-marginal-structural-models.html#cb17-132" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb17-133"><a href="ip-weighting-and-marginal-structural-models.html#cb17-133" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-134"><a href="ip-weighting-and-marginal-structural-models.html#cb17-134" tabindex="-1"></a><span class="do">##     Null deviance: 533.36  on 1628  degrees of freedom</span></span>
<span id="cb17-135"><a href="ip-weighting-and-marginal-structural-models.html#cb17-135" tabindex="-1"></a><span class="do">## Residual deviance: 465.36  on 1609  degrees of freedom</span></span>
<span id="cb17-136"><a href="ip-weighting-and-marginal-structural-models.html#cb17-136" tabindex="-1"></a><span class="do">## AIC: 505.4</span></span>
<span id="cb17-137"><a href="ip-weighting-and-marginal-structural-models.html#cb17-137" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-138"><a href="ip-weighting-and-marginal-structural-models.html#cb17-138" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 7</span></span>
<span id="cb17-139"><a href="ip-weighting-and-marginal-structural-models.html#cb17-139" tabindex="-1"></a></span>
<span id="cb17-140"><a href="ip-weighting-and-marginal-structural-models.html#cb17-140" tabindex="-1"></a>pd.cens <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">predict</span>(denom.cens, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb17-141"><a href="ip-weighting-and-marginal-structural-models.html#cb17-141" tabindex="-1"></a></span>
<span id="cb17-142"><a href="ip-weighting-and-marginal-structural-models.html#cb17-142" tabindex="-1"></a><span class="co"># estimation of numerator of ip weights for C</span></span>
<span id="cb17-143"><a href="ip-weighting-and-marginal-structural-models.html#cb17-143" tabindex="-1"></a>numer.cens <span class="ot">&lt;-</span></span>
<span id="cb17-144"><a href="ip-weighting-and-marginal-structural-models.html#cb17-144" tabindex="-1"></a>  <span class="fu">glm</span>(cens <span class="sc">~</span> <span class="fu">as.factor</span>(qsmk), <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="at">data =</span> nhefs)</span>
<span id="cb17-145"><a href="ip-weighting-and-marginal-structural-models.html#cb17-145" tabindex="-1"></a><span class="fu">summary</span>(numer.cens)</span>
<span id="cb17-146"><a href="ip-weighting-and-marginal-structural-models.html#cb17-146" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-147"><a href="ip-weighting-and-marginal-structural-models.html#cb17-147" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb17-148"><a href="ip-weighting-and-marginal-structural-models.html#cb17-148" tabindex="-1"></a><span class="do">## glm(formula = cens ~ as.factor(qsmk), family = binomial(), data = nhefs)</span></span>
<span id="cb17-149"><a href="ip-weighting-and-marginal-structural-models.html#cb17-149" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-150"><a href="ip-weighting-and-marginal-structural-models.html#cb17-150" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb17-151"><a href="ip-weighting-and-marginal-structural-models.html#cb17-151" tabindex="-1"></a><span class="do">##                  Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb17-152"><a href="ip-weighting-and-marginal-structural-models.html#cb17-152" tabindex="-1"></a><span class="do">## (Intercept)        -3.421      0.165  -20.75   &lt;2e-16 ***</span></span>
<span id="cb17-153"><a href="ip-weighting-and-marginal-structural-models.html#cb17-153" tabindex="-1"></a><span class="do">## as.factor(qsmk)1    0.641      0.264    2.43    0.015 *  </span></span>
<span id="cb17-154"><a href="ip-weighting-and-marginal-structural-models.html#cb17-154" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb17-155"><a href="ip-weighting-and-marginal-structural-models.html#cb17-155" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb17-156"><a href="ip-weighting-and-marginal-structural-models.html#cb17-156" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-157"><a href="ip-weighting-and-marginal-structural-models.html#cb17-157" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb17-158"><a href="ip-weighting-and-marginal-structural-models.html#cb17-158" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-159"><a href="ip-weighting-and-marginal-structural-models.html#cb17-159" tabindex="-1"></a><span class="do">##     Null deviance: 533.36  on 1628  degrees of freedom</span></span>
<span id="cb17-160"><a href="ip-weighting-and-marginal-structural-models.html#cb17-160" tabindex="-1"></a><span class="do">## Residual deviance: 527.76  on 1627  degrees of freedom</span></span>
<span id="cb17-161"><a href="ip-weighting-and-marginal-structural-models.html#cb17-161" tabindex="-1"></a><span class="do">## AIC: 531.8</span></span>
<span id="cb17-162"><a href="ip-weighting-and-marginal-structural-models.html#cb17-162" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-163"><a href="ip-weighting-and-marginal-structural-models.html#cb17-163" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 6</span></span>
<span id="cb17-164"><a href="ip-weighting-and-marginal-structural-models.html#cb17-164" tabindex="-1"></a>pn.cens <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">predict</span>(numer.cens, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb17-165"><a href="ip-weighting-and-marginal-structural-models.html#cb17-165" tabindex="-1"></a></span>
<span id="cb17-166"><a href="ip-weighting-and-marginal-structural-models.html#cb17-166" tabindex="-1"></a>nhefs<span class="sc">$</span>sw.a <span class="ot">&lt;-</span></span>
<span id="cb17-167"><a href="ip-weighting-and-marginal-structural-models.html#cb17-167" tabindex="-1"></a>  <span class="fu">ifelse</span>(nhefs<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">0</span>, ((<span class="dv">1</span> <span class="sc">-</span> pn.qsmk) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> pd.qsmk)),</span>
<span id="cb17-168"><a href="ip-weighting-and-marginal-structural-models.html#cb17-168" tabindex="-1"></a>         (pn.qsmk <span class="sc">/</span> pd.qsmk))</span>
<span id="cb17-169"><a href="ip-weighting-and-marginal-structural-models.html#cb17-169" tabindex="-1"></a>nhefs<span class="sc">$</span>sw.c <span class="ot">&lt;-</span> pn.cens <span class="sc">/</span> pd.cens</span>
<span id="cb17-170"><a href="ip-weighting-and-marginal-structural-models.html#cb17-170" tabindex="-1"></a>nhefs<span class="sc">$</span>sw <span class="ot">&lt;-</span> nhefs<span class="sc">$</span>sw.c <span class="sc">*</span> nhefs<span class="sc">$</span>sw.a</span>
<span id="cb17-171"><a href="ip-weighting-and-marginal-structural-models.html#cb17-171" tabindex="-1"></a></span>
<span id="cb17-172"><a href="ip-weighting-and-marginal-structural-models.html#cb17-172" tabindex="-1"></a><span class="fu">summary</span>(nhefs<span class="sc">$</span>sw.a)</span>
<span id="cb17-173"><a href="ip-weighting-and-marginal-structural-models.html#cb17-173" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb17-174"><a href="ip-weighting-and-marginal-structural-models.html#cb17-174" tabindex="-1"></a><span class="do">##    0.33    0.86    0.95    1.00    1.08    4.21</span></span>
<span id="cb17-175"><a href="ip-weighting-and-marginal-structural-models.html#cb17-175" tabindex="-1"></a><span class="fu">sd</span>(nhefs<span class="sc">$</span>sw.a)</span>
<span id="cb17-176"><a href="ip-weighting-and-marginal-structural-models.html#cb17-176" tabindex="-1"></a><span class="do">## [1] 0.284</span></span>
<span id="cb17-177"><a href="ip-weighting-and-marginal-structural-models.html#cb17-177" tabindex="-1"></a><span class="fu">summary</span>(nhefs<span class="sc">$</span>sw.c)</span>
<span id="cb17-178"><a href="ip-weighting-and-marginal-structural-models.html#cb17-178" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb17-179"><a href="ip-weighting-and-marginal-structural-models.html#cb17-179" tabindex="-1"></a><span class="do">##    0.94    0.98    0.99    1.01    1.01    7.58</span></span>
<span id="cb17-180"><a href="ip-weighting-and-marginal-structural-models.html#cb17-180" tabindex="-1"></a><span class="fu">sd</span>(nhefs<span class="sc">$</span>sw.c)</span>
<span id="cb17-181"><a href="ip-weighting-and-marginal-structural-models.html#cb17-181" tabindex="-1"></a><span class="do">## [1] 0.178</span></span>
<span id="cb17-182"><a href="ip-weighting-and-marginal-structural-models.html#cb17-182" tabindex="-1"></a><span class="fu">summary</span>(nhefs<span class="sc">$</span>sw)</span>
<span id="cb17-183"><a href="ip-weighting-and-marginal-structural-models.html#cb17-183" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb17-184"><a href="ip-weighting-and-marginal-structural-models.html#cb17-184" tabindex="-1"></a><span class="do">##    0.35    0.86    0.94    1.01    1.08   12.86</span></span>
<span id="cb17-185"><a href="ip-weighting-and-marginal-structural-models.html#cb17-185" tabindex="-1"></a><span class="fu">sd</span>(nhefs<span class="sc">$</span>sw)</span>
<span id="cb17-186"><a href="ip-weighting-and-marginal-structural-models.html#cb17-186" tabindex="-1"></a><span class="do">## [1] 0.411</span></span>
<span id="cb17-187"><a href="ip-weighting-and-marginal-structural-models.html#cb17-187" tabindex="-1"></a></span>
<span id="cb17-188"><a href="ip-weighting-and-marginal-structural-models.html#cb17-188" tabindex="-1"></a>msm.sw <span class="ot">&lt;-</span> <span class="fu">geeglm</span>(</span>
<span id="cb17-189"><a href="ip-weighting-and-marginal-structural-models.html#cb17-189" tabindex="-1"></a>  wt82_71 <span class="sc">~</span> qsmk,</span>
<span id="cb17-190"><a href="ip-weighting-and-marginal-structural-models.html#cb17-190" tabindex="-1"></a>  <span class="at">data =</span> nhefs,</span>
<span id="cb17-191"><a href="ip-weighting-and-marginal-structural-models.html#cb17-191" tabindex="-1"></a>  <span class="at">weights =</span> sw,</span>
<span id="cb17-192"><a href="ip-weighting-and-marginal-structural-models.html#cb17-192" tabindex="-1"></a>  <span class="at">id =</span> seqn,</span>
<span id="cb17-193"><a href="ip-weighting-and-marginal-structural-models.html#cb17-193" tabindex="-1"></a>  <span class="at">corstr =</span> <span class="st">&quot;independence&quot;</span></span>
<span id="cb17-194"><a href="ip-weighting-and-marginal-structural-models.html#cb17-194" tabindex="-1"></a>)</span>
<span id="cb17-195"><a href="ip-weighting-and-marginal-structural-models.html#cb17-195" tabindex="-1"></a><span class="fu">summary</span>(msm.sw)</span>
<span id="cb17-196"><a href="ip-weighting-and-marginal-structural-models.html#cb17-196" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-197"><a href="ip-weighting-and-marginal-structural-models.html#cb17-197" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb17-198"><a href="ip-weighting-and-marginal-structural-models.html#cb17-198" tabindex="-1"></a><span class="do">## geeglm(formula = wt82_71 ~ qsmk, data = nhefs, weights = sw, </span></span>
<span id="cb17-199"><a href="ip-weighting-and-marginal-structural-models.html#cb17-199" tabindex="-1"></a><span class="do">##     id = seqn, corstr = &quot;independence&quot;)</span></span>
<span id="cb17-200"><a href="ip-weighting-and-marginal-structural-models.html#cb17-200" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-201"><a href="ip-weighting-and-marginal-structural-models.html#cb17-201" tabindex="-1"></a><span class="do">##  Coefficients:</span></span>
<span id="cb17-202"><a href="ip-weighting-and-marginal-structural-models.html#cb17-202" tabindex="-1"></a><span class="do">##             Estimate Std.err Wald Pr(&gt;|W|)    </span></span>
<span id="cb17-203"><a href="ip-weighting-and-marginal-structural-models.html#cb17-203" tabindex="-1"></a><span class="do">## (Intercept)    1.662   0.233 51.0  9.3e-13 ***</span></span>
<span id="cb17-204"><a href="ip-weighting-and-marginal-structural-models.html#cb17-204" tabindex="-1"></a><span class="do">## qsmk           3.496   0.526 44.2  2.9e-11 ***</span></span>
<span id="cb17-205"><a href="ip-weighting-and-marginal-structural-models.html#cb17-205" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb17-206"><a href="ip-weighting-and-marginal-structural-models.html#cb17-206" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb17-207"><a href="ip-weighting-and-marginal-structural-models.html#cb17-207" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-208"><a href="ip-weighting-and-marginal-structural-models.html#cb17-208" tabindex="-1"></a><span class="do">## Correlation structure = independence </span></span>
<span id="cb17-209"><a href="ip-weighting-and-marginal-structural-models.html#cb17-209" tabindex="-1"></a><span class="do">## Estimated Scale Parameters:</span></span>
<span id="cb17-210"><a href="ip-weighting-and-marginal-structural-models.html#cb17-210" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-211"><a href="ip-weighting-and-marginal-structural-models.html#cb17-211" tabindex="-1"></a><span class="do">##             Estimate Std.err</span></span>
<span id="cb17-212"><a href="ip-weighting-and-marginal-structural-models.html#cb17-212" tabindex="-1"></a><span class="do">## (Intercept)     61.8    3.83</span></span>
<span id="cb17-213"><a href="ip-weighting-and-marginal-structural-models.html#cb17-213" tabindex="-1"></a><span class="do">## Number of clusters:   1566  Maximum cluster size: 1</span></span>
<span id="cb17-214"><a href="ip-weighting-and-marginal-structural-models.html#cb17-214" tabindex="-1"></a></span>
<span id="cb17-215"><a href="ip-weighting-and-marginal-structural-models.html#cb17-215" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">coef</span>(msm.sw)</span>
<span id="cb17-216"><a href="ip-weighting-and-marginal-structural-models.html#cb17-216" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(msm.sw))[, <span class="dv">2</span>]</span>
<span id="cb17-217"><a href="ip-weighting-and-marginal-structural-models.html#cb17-217" tabindex="-1"></a>lcl <span class="ot">&lt;-</span> beta <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb17-218"><a href="ip-weighting-and-marginal-structural-models.html#cb17-218" tabindex="-1"></a>ucl <span class="ot">&lt;-</span> beta <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> SE</span>
<span id="cb17-219"><a href="ip-weighting-and-marginal-structural-models.html#cb17-219" tabindex="-1"></a><span class="fu">cbind</span>(beta, lcl, ucl)</span>
<span id="cb17-220"><a href="ip-weighting-and-marginal-structural-models.html#cb17-220" tabindex="-1"></a><span class="do">##             beta  lcl  ucl</span></span>
<span id="cb17-221"><a href="ip-weighting-and-marginal-structural-models.html#cb17-221" tabindex="-1"></a><span class="do">## (Intercept) 1.66 1.21 2.12</span></span>
<span id="cb17-222"><a href="ip-weighting-and-marginal-structural-models.html#cb17-222" tabindex="-1"></a><span class="do">## qsmk        3.50 2.47 4.53</span></span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="why-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="standardization-and-the-parametric-g-formula.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/remlapmot/cibookex-r/edit/master/12-ipw-msm-r.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/remlapmot/cibookex-r/blob/master/12-ipw-msm-r.Rmd",
"text": null
},
"download": ["cibookex-r.pdf", "cibookex-r.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
