<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>15. Outcome regression and propensity scores | Causal Inference: What If. R and Stata code for Exercises</title>
  <meta name="description" content="Code examples from Causal Inference: What If by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="15. Outcome regression and propensity scores | Causal Inference: What If. R and Stata code for Exercises" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Code examples from Causal Inference: What If by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="15. Outcome regression and propensity scores | Causal Inference: What If. R and Stata code for Exercises" />
  
  <meta name="twitter:description" content="Code examples from Causal Inference: What If by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

<meta name="author" content="Book by M. A. Hern치n and J. M. Robins" />
<meta name="author" content="R code by Joy Shi and Sean McGrath" />
<meta name="author" content="Stata code by Eleanor Murray and Roger Logan" />
<meta name="author" content="R Markdown code by Tom Palmer" />


<meta name="date" content="2024-11-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="g-estimation-of-structural-nested-models.html"/>
<link rel="next" href="instrumental-variables-estimation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Table of Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#downloading-the-code"><i class="fa fa-check"></i>Downloading the code</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installing-dependency-packages"><i class="fa fa-check"></i>Installing dependency packages</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#downloading-the-datasets"><i class="fa fa-check"></i>Downloading the datasets</a></li>
</ul></li>
<li class="part"><span><b>R code</b></span></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html"><i class="fa fa-check"></i>11. Why model?</a>
<ul>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.2"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.3"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.2"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.3"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.4"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.5"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.6"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.7"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula</a>
<ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.2"><i class="fa fa-check"></i>Program 13.2</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.3"><i class="fa fa-check"></i>Program 13.3</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.4"><i class="fa fa-check"></i>Program 13.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.1"><i class="fa fa-check"></i>Program 14.1</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.2"><i class="fa fa-check"></i>Program 14.2</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-one-possible-value-of-psi"><i class="fa fa-check"></i>G-estimation: Checking one possible value of psi</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-multiple-possible-values-of-psi"><i class="fa fa-check"></i>G-estimation: Checking multiple possible values of psi</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.3"><i class="fa fa-check"></i>Program 14.3</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-linear-mean-models"><i class="fa fa-check"></i>G-estimation: Closed form estimator linear mean models</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-for-2-parameter-model"><i class="fa fa-check"></i>G-estimation: Closed form estimator for 2-parameter model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores</a>
<ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.1"><i class="fa fa-check"></i>Program 15.1</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.2"><i class="fa fa-check"></i>Program 15.2</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.3"><i class="fa fa-check"></i>Program 15.3</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.4"><i class="fa fa-check"></i>Program 15.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html"><i class="fa fa-check"></i>16. Instrumental variables estimation</a>
<ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.1"><i class="fa fa-check"></i>Program 16.1</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.2"><i class="fa fa-check"></i>Program 16.2</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.3"><i class="fa fa-check"></i>Program 16.3</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.4"><i class="fa fa-check"></i>Program 16.4</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.5"><i class="fa fa-check"></i>Program 16.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html"><i class="fa fa-check"></i>17. Causal survival analysis</a>
<ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.1"><i class="fa fa-check"></i>Program 17.1</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.2"><i class="fa fa-check"></i>Program 17.2</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.3"><i class="fa fa-check"></i>Program 17.3</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.4"><i class="fa fa-check"></i>Program 17.4</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.5"><i class="fa fa-check"></i>Program 17.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-information-r.html"><a href="session-information-r.html"><i class="fa fa-check"></i>Session information: R</a></li>
<li class="part"><span><b>Stata code</b></span></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html"><i class="fa fa-check"></i>11. Why model: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.1-1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.2-1"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.3-1"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.1-1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.2-1"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.3-1"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.4-1"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.5-1"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.6-1"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.7-1"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.1-1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.2-1"><i class="fa fa-check"></i>Program 13.2</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.3-1"><i class="fa fa-check"></i>Program 13.3</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.4-1"><i class="fa fa-check"></i>Program 13.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.1-1"><i class="fa fa-check"></i>Program 14.1</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.2-1"><i class="fa fa-check"></i>Program 14.2</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.3-1"><i class="fa fa-check"></i>Program 14.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.1-1"><i class="fa fa-check"></i>Program 15.1</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#prorgam-15.2"><i class="fa fa-check"></i>Prorgam 15.2</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.3-1"><i class="fa fa-check"></i>Program 15.3</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.4-1"><i class="fa fa-check"></i>Program 15.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html"><i class="fa fa-check"></i>16. Instrumental variables estimation: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.1-1"><i class="fa fa-check"></i>Program 16.1</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.2-1"><i class="fa fa-check"></i>Program 16.2</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.3-1"><i class="fa fa-check"></i>Program 16.3</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.4-1"><i class="fa fa-check"></i>Program 16.4</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.5-1"><i class="fa fa-check"></i>Program 16.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html"><i class="fa fa-check"></i>17. Causal survival analysis: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.1-1"><i class="fa fa-check"></i>Program 17.1</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.2-1"><i class="fa fa-check"></i>Program 17.2</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.3-1"><i class="fa fa-check"></i>Program 17.3</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.4-1"><i class="fa fa-check"></i>Program 17.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-information-stata.html"><a href="session-information-stata.html"><i class="fa fa-check"></i>Session information: Stata</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Causal Inference: What If. R and Stata code for Exercises</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="outcome-regression-and-propensity-scores" class="section level1 unnumbered hasAnchor">
<h1>15. Outcome regression and propensity scores<a href="outcome-regression-and-propensity-scores.html#outcome-regression-and-propensity-scores" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="program-15.1" class="section level2 hasAnchor">
<h2>Program 15.1<a href="outcome-regression-and-propensity-scores.html#program-15.1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating the average causal effect within levels of confounders under the assumption of effect-measure modification by smoking intensity ONLY</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="outcome-regression-and-propensity-scores.html#cb29-1" tabindex="-1"></a><span class="fu">library</span>(here)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="outcome-regression-and-propensity-scores.html#cb30-1" tabindex="-1"></a><span class="co">#install.packages(&quot;readxl&quot;) # install package if required</span></span>
<span id="cb30-2"><a href="outcome-regression-and-propensity-scores.html#cb30-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;readxl&quot;</span>)</span>
<span id="cb30-3"><a href="outcome-regression-and-propensity-scores.html#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="outcome-regression-and-propensity-scores.html#cb30-4" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;NHEFS.xls&quot;</span>))</span>
<span id="cb30-5"><a href="outcome-regression-and-propensity-scores.html#cb30-5" tabindex="-1"></a>nhefs<span class="sc">$</span>cens <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(nhefs<span class="sc">$</span>wt82), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb30-6"><a href="outcome-regression-and-propensity-scores.html#cb30-6" tabindex="-1"></a></span>
<span id="cb30-7"><a href="outcome-regression-and-propensity-scores.html#cb30-7" tabindex="-1"></a><span class="co"># regression on covariates, allowing for some effect modification</span></span>
<span id="cb30-8"><a href="outcome-regression-and-propensity-scores.html#cb30-8" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">*</span>age) <span class="sc">+</span> <span class="fu">as.factor</span>(education)</span>
<span id="cb30-9"><a href="outcome-regression-and-propensity-scores.html#cb30-9" tabindex="-1"></a>           <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">*</span>smokeintensity) <span class="sc">+</span> smokeyrs</span>
<span id="cb30-10"><a href="outcome-regression-and-propensity-scores.html#cb30-10" tabindex="-1"></a>           <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">*</span>smokeyrs) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active)</span>
<span id="cb30-11"><a href="outcome-regression-and-propensity-scores.html#cb30-11" tabindex="-1"></a>           <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">*</span>wt71) <span class="sc">+</span> <span class="fu">I</span>(qsmk<span class="sc">*</span>smokeintensity), <span class="at">data=</span>nhefs)</span>
<span id="cb30-12"><a href="outcome-regression-and-propensity-scores.html#cb30-12" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb30-13"><a href="outcome-regression-and-propensity-scores.html#cb30-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-14"><a href="outcome-regression-and-propensity-scores.html#cb30-14" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb30-15"><a href="outcome-regression-and-propensity-scores.html#cb30-15" tabindex="-1"></a><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age * age) + </span></span>
<span id="cb30-16"><a href="outcome-regression-and-propensity-scores.html#cb30-16" tabindex="-1"></a><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity * </span></span>
<span id="cb30-17"><a href="outcome-regression-and-propensity-scores.html#cb30-17" tabindex="-1"></a><span class="co">#&gt;     smokeintensity) + smokeyrs + I(smokeyrs * smokeyrs) + as.factor(exercise) + </span></span>
<span id="cb30-18"><a href="outcome-regression-and-propensity-scores.html#cb30-18" tabindex="-1"></a><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71 * wt71) + I(qsmk * smokeintensity), </span></span>
<span id="cb30-19"><a href="outcome-regression-and-propensity-scores.html#cb30-19" tabindex="-1"></a><span class="co">#&gt;     data = nhefs)</span></span>
<span id="cb30-20"><a href="outcome-regression-and-propensity-scores.html#cb30-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-21"><a href="outcome-regression-and-propensity-scores.html#cb30-21" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb30-22"><a href="outcome-regression-and-propensity-scores.html#cb30-22" tabindex="-1"></a><span class="co">#&gt;                                      Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb30-23"><a href="outcome-regression-and-propensity-scores.html#cb30-23" tabindex="-1"></a><span class="co">#&gt; (Intercept)                        -1.5881657  4.3130359  -0.368 0.712756    </span></span>
<span id="cb30-24"><a href="outcome-regression-and-propensity-scores.html#cb30-24" tabindex="-1"></a><span class="co">#&gt; qsmk                                2.5595941  0.8091486   3.163 0.001590 ** </span></span>
<span id="cb30-25"><a href="outcome-regression-and-propensity-scores.html#cb30-25" tabindex="-1"></a><span class="co">#&gt; sex                                -1.4302717  0.4689576  -3.050 0.002328 ** </span></span>
<span id="cb30-26"><a href="outcome-regression-and-propensity-scores.html#cb30-26" tabindex="-1"></a><span class="co">#&gt; race                                0.5601096  0.5818888   0.963 0.335913    </span></span>
<span id="cb30-27"><a href="outcome-regression-and-propensity-scores.html#cb30-27" tabindex="-1"></a><span class="co">#&gt; age                                 0.3596353  0.1633188   2.202 0.027809 *  </span></span>
<span id="cb30-28"><a href="outcome-regression-and-propensity-scores.html#cb30-28" tabindex="-1"></a><span class="co">#&gt; I(age * age)                       -0.0061010  0.0017261  -3.534 0.000421 ***</span></span>
<span id="cb30-29"><a href="outcome-regression-and-propensity-scores.html#cb30-29" tabindex="-1"></a><span class="co">#&gt; as.factor(education)2               0.7904440  0.6070005   1.302 0.193038    </span></span>
<span id="cb30-30"><a href="outcome-regression-and-propensity-scores.html#cb30-30" tabindex="-1"></a><span class="co">#&gt; as.factor(education)3               0.5563124  0.5561016   1.000 0.317284    </span></span>
<span id="cb30-31"><a href="outcome-regression-and-propensity-scores.html#cb30-31" tabindex="-1"></a><span class="co">#&gt; as.factor(education)4               1.4915695  0.8322704   1.792 0.073301 .  </span></span>
<span id="cb30-32"><a href="outcome-regression-and-propensity-scores.html#cb30-32" tabindex="-1"></a><span class="co">#&gt; as.factor(education)5              -0.1949770  0.7413692  -0.263 0.792589    </span></span>
<span id="cb30-33"><a href="outcome-regression-and-propensity-scores.html#cb30-33" tabindex="-1"></a><span class="co">#&gt; smokeintensity                      0.0491365  0.0517254   0.950 0.342287    </span></span>
<span id="cb30-34"><a href="outcome-regression-and-propensity-scores.html#cb30-34" tabindex="-1"></a><span class="co">#&gt; I(smokeintensity * smokeintensity) -0.0009907  0.0009380  -1.056 0.291097    </span></span>
<span id="cb30-35"><a href="outcome-regression-and-propensity-scores.html#cb30-35" tabindex="-1"></a><span class="co">#&gt; smokeyrs                            0.1343686  0.0917122   1.465 0.143094    </span></span>
<span id="cb30-36"><a href="outcome-regression-and-propensity-scores.html#cb30-36" tabindex="-1"></a><span class="co">#&gt; I(smokeyrs * smokeyrs)             -0.0018664  0.0015437  -1.209 0.226830    </span></span>
<span id="cb30-37"><a href="outcome-regression-and-propensity-scores.html#cb30-37" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)1                0.2959754  0.5351533   0.553 0.580298    </span></span>
<span id="cb30-38"><a href="outcome-regression-and-propensity-scores.html#cb30-38" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)2                0.3539128  0.5588587   0.633 0.526646    </span></span>
<span id="cb30-39"><a href="outcome-regression-and-propensity-scores.html#cb30-39" tabindex="-1"></a><span class="co">#&gt; as.factor(active)1                 -0.9475695  0.4099344  -2.312 0.020935 *  </span></span>
<span id="cb30-40"><a href="outcome-regression-and-propensity-scores.html#cb30-40" tabindex="-1"></a><span class="co">#&gt; as.factor(active)2                 -0.2613779  0.6845577  -0.382 0.702647    </span></span>
<span id="cb30-41"><a href="outcome-regression-and-propensity-scores.html#cb30-41" tabindex="-1"></a><span class="co">#&gt; wt71                                0.0455018  0.0833709   0.546 0.585299    </span></span>
<span id="cb30-42"><a href="outcome-regression-and-propensity-scores.html#cb30-42" tabindex="-1"></a><span class="co">#&gt; I(wt71 * wt71)                     -0.0009653  0.0005247  -1.840 0.066001 .  </span></span>
<span id="cb30-43"><a href="outcome-regression-and-propensity-scores.html#cb30-43" tabindex="-1"></a><span class="co">#&gt; I(qsmk * smokeintensity)            0.0466628  0.0351448   1.328 0.184463    </span></span>
<span id="cb30-44"><a href="outcome-regression-and-propensity-scores.html#cb30-44" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb30-45"><a href="outcome-regression-and-propensity-scores.html#cb30-45" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb30-46"><a href="outcome-regression-and-propensity-scores.html#cb30-46" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-47"><a href="outcome-regression-and-propensity-scores.html#cb30-47" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 53.5683)</span></span>
<span id="cb30-48"><a href="outcome-regression-and-propensity-scores.html#cb30-48" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-49"><a href="outcome-regression-and-propensity-scores.html#cb30-49" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span id="cb30-50"><a href="outcome-regression-and-propensity-scores.html#cb30-50" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 82763  on 1545  degrees of freedom</span></span>
<span id="cb30-51"><a href="outcome-regression-and-propensity-scores.html#cb30-51" tabindex="-1"></a><span class="co">#&gt;   (63 observations deleted due to missingness)</span></span>
<span id="cb30-52"><a href="outcome-regression-and-propensity-scores.html#cb30-52" tabindex="-1"></a><span class="co">#&gt; AIC: 10701</span></span>
<span id="cb30-53"><a href="outcome-regression-and-propensity-scores.html#cb30-53" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-54"><a href="outcome-regression-and-propensity-scores.html#cb30-54" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span>
<span id="cb30-55"><a href="outcome-regression-and-propensity-scores.html#cb30-55" tabindex="-1"></a></span>
<span id="cb30-56"><a href="outcome-regression-and-propensity-scores.html#cb30-56" tabindex="-1"></a><span class="co"># (step 1) build the contrast matrix with all zeros</span></span>
<span id="cb30-57"><a href="outcome-regression-and-propensity-scores.html#cb30-57" tabindex="-1"></a><span class="co"># this function builds the blank matrix</span></span>
<span id="cb30-58"><a href="outcome-regression-and-propensity-scores.html#cb30-58" tabindex="-1"></a><span class="co"># install.packages(&quot;multcomp&quot;) # install packages if necessary</span></span>
<span id="cb30-59"><a href="outcome-regression-and-propensity-scores.html#cb30-59" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;multcomp&quot;</span>)</span>
<span id="cb30-60"><a href="outcome-regression-and-propensity-scores.html#cb30-60" tabindex="-1"></a><span class="co">#&gt; Loading required package: mvtnorm</span></span>
<span id="cb30-61"><a href="outcome-regression-and-propensity-scores.html#cb30-61" tabindex="-1"></a><span class="co">#&gt; Loading required package: survival</span></span>
<span id="cb30-62"><a href="outcome-regression-and-propensity-scores.html#cb30-62" tabindex="-1"></a><span class="co">#&gt; Loading required package: TH.data</span></span>
<span id="cb30-63"><a href="outcome-regression-and-propensity-scores.html#cb30-63" tabindex="-1"></a><span class="co">#&gt; Loading required package: MASS</span></span>
<span id="cb30-64"><a href="outcome-regression-and-propensity-scores.html#cb30-64" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-65"><a href="outcome-regression-and-propensity-scores.html#cb30-65" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;TH.data&#39;</span></span>
<span id="cb30-66"><a href="outcome-regression-and-propensity-scores.html#cb30-66" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:MASS&#39;:</span></span>
<span id="cb30-67"><a href="outcome-regression-and-propensity-scores.html#cb30-67" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-68"><a href="outcome-regression-and-propensity-scores.html#cb30-68" tabindex="-1"></a><span class="co">#&gt;     geyser</span></span>
<span id="cb30-69"><a href="outcome-regression-and-propensity-scores.html#cb30-69" tabindex="-1"></a>makeContrastMatrix <span class="ot">&lt;-</span> <span class="cf">function</span>(model, nrow, names) {</span>
<span id="cb30-70"><a href="outcome-regression-and-propensity-scores.html#cb30-70" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nrow, <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">coef</span>(model)))</span>
<span id="cb30-71"><a href="outcome-regression-and-propensity-scores.html#cb30-71" tabindex="-1"></a>  <span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">coef</span>(model))</span>
<span id="cb30-72"><a href="outcome-regression-and-propensity-scores.html#cb30-72" tabindex="-1"></a>  <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> names</span>
<span id="cb30-73"><a href="outcome-regression-and-propensity-scores.html#cb30-73" tabindex="-1"></a>  <span class="fu">return</span>(m)</span>
<span id="cb30-74"><a href="outcome-regression-and-propensity-scores.html#cb30-74" tabindex="-1"></a>}</span>
<span id="cb30-75"><a href="outcome-regression-and-propensity-scores.html#cb30-75" tabindex="-1"></a>K1 <span class="ot">&lt;-</span></span>
<span id="cb30-76"><a href="outcome-regression-and-propensity-scores.html#cb30-76" tabindex="-1"></a>  <span class="fu">makeContrastMatrix</span>(</span>
<span id="cb30-77"><a href="outcome-regression-and-propensity-scores.html#cb30-77" tabindex="-1"></a>    fit,</span>
<span id="cb30-78"><a href="outcome-regression-and-propensity-scores.html#cb30-78" tabindex="-1"></a>    <span class="dv">2</span>,</span>
<span id="cb30-79"><a href="outcome-regression-and-propensity-scores.html#cb30-79" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb30-80"><a href="outcome-regression-and-propensity-scores.html#cb30-80" tabindex="-1"></a>      <span class="st">&#39;Effect of Quitting Smoking at Smokeintensity of 5&#39;</span>,</span>
<span id="cb30-81"><a href="outcome-regression-and-propensity-scores.html#cb30-81" tabindex="-1"></a>      <span class="st">&#39;Effect of Quitting Smoking at Smokeintensity of 40&#39;</span></span>
<span id="cb30-82"><a href="outcome-regression-and-propensity-scores.html#cb30-82" tabindex="-1"></a>    )</span>
<span id="cb30-83"><a href="outcome-regression-and-propensity-scores.html#cb30-83" tabindex="-1"></a>  )</span>
<span id="cb30-84"><a href="outcome-regression-and-propensity-scores.html#cb30-84" tabindex="-1"></a><span class="co"># (step 2) fill in the relevant non-zero elements</span></span>
<span id="cb30-85"><a href="outcome-regression-and-propensity-scores.html#cb30-85" tabindex="-1"></a>K1[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&#39;qsmk&#39;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb30-86"><a href="outcome-regression-and-propensity-scores.html#cb30-86" tabindex="-1"></a>K1[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&#39;I(qsmk * smokeintensity)&#39;</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">40</span>)</span>
<span id="cb30-87"><a href="outcome-regression-and-propensity-scores.html#cb30-87" tabindex="-1"></a></span>
<span id="cb30-88"><a href="outcome-regression-and-propensity-scores.html#cb30-88" tabindex="-1"></a><span class="co"># (step 3) check the contrast matrix</span></span>
<span id="cb30-89"><a href="outcome-regression-and-propensity-scores.html#cb30-89" tabindex="-1"></a>K1</span>
<span id="cb30-90"><a href="outcome-regression-and-propensity-scores.html#cb30-90" tabindex="-1"></a><span class="co">#&gt;                                                    (Intercept) qsmk sex race</span></span>
<span id="cb30-91"><a href="outcome-regression-and-propensity-scores.html#cb30-91" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5            0    1   0    0</span></span>
<span id="cb30-92"><a href="outcome-regression-and-propensity-scores.html#cb30-92" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40           0    1   0    0</span></span>
<span id="cb30-93"><a href="outcome-regression-and-propensity-scores.html#cb30-93" tabindex="-1"></a><span class="co">#&gt;                                                    age I(age * age)</span></span>
<span id="cb30-94"><a href="outcome-regression-and-propensity-scores.html#cb30-94" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5    0            0</span></span>
<span id="cb30-95"><a href="outcome-regression-and-propensity-scores.html#cb30-95" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40   0            0</span></span>
<span id="cb30-96"><a href="outcome-regression-and-propensity-scores.html#cb30-96" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(education)2</span></span>
<span id="cb30-97"><a href="outcome-regression-and-propensity-scores.html#cb30-97" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                      0</span></span>
<span id="cb30-98"><a href="outcome-regression-and-propensity-scores.html#cb30-98" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                     0</span></span>
<span id="cb30-99"><a href="outcome-regression-and-propensity-scores.html#cb30-99" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(education)3</span></span>
<span id="cb30-100"><a href="outcome-regression-and-propensity-scores.html#cb30-100" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                      0</span></span>
<span id="cb30-101"><a href="outcome-regression-and-propensity-scores.html#cb30-101" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                     0</span></span>
<span id="cb30-102"><a href="outcome-regression-and-propensity-scores.html#cb30-102" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(education)4</span></span>
<span id="cb30-103"><a href="outcome-regression-and-propensity-scores.html#cb30-103" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                      0</span></span>
<span id="cb30-104"><a href="outcome-regression-and-propensity-scores.html#cb30-104" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                     0</span></span>
<span id="cb30-105"><a href="outcome-regression-and-propensity-scores.html#cb30-105" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(education)5</span></span>
<span id="cb30-106"><a href="outcome-regression-and-propensity-scores.html#cb30-106" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                      0</span></span>
<span id="cb30-107"><a href="outcome-regression-and-propensity-scores.html#cb30-107" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                     0</span></span>
<span id="cb30-108"><a href="outcome-regression-and-propensity-scores.html#cb30-108" tabindex="-1"></a><span class="co">#&gt;                                                    smokeintensity</span></span>
<span id="cb30-109"><a href="outcome-regression-and-propensity-scores.html#cb30-109" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5               0</span></span>
<span id="cb30-110"><a href="outcome-regression-and-propensity-scores.html#cb30-110" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40              0</span></span>
<span id="cb30-111"><a href="outcome-regression-and-propensity-scores.html#cb30-111" tabindex="-1"></a><span class="co">#&gt;                                                    I(smokeintensity * smokeintensity)</span></span>
<span id="cb30-112"><a href="outcome-regression-and-propensity-scores.html#cb30-112" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                                   0</span></span>
<span id="cb30-113"><a href="outcome-regression-and-propensity-scores.html#cb30-113" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                                  0</span></span>
<span id="cb30-114"><a href="outcome-regression-and-propensity-scores.html#cb30-114" tabindex="-1"></a><span class="co">#&gt;                                                    smokeyrs</span></span>
<span id="cb30-115"><a href="outcome-regression-and-propensity-scores.html#cb30-115" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5         0</span></span>
<span id="cb30-116"><a href="outcome-regression-and-propensity-scores.html#cb30-116" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40        0</span></span>
<span id="cb30-117"><a href="outcome-regression-and-propensity-scores.html#cb30-117" tabindex="-1"></a><span class="co">#&gt;                                                    I(smokeyrs * smokeyrs)</span></span>
<span id="cb30-118"><a href="outcome-regression-and-propensity-scores.html#cb30-118" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                       0</span></span>
<span id="cb30-119"><a href="outcome-regression-and-propensity-scores.html#cb30-119" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                      0</span></span>
<span id="cb30-120"><a href="outcome-regression-and-propensity-scores.html#cb30-120" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(exercise)1</span></span>
<span id="cb30-121"><a href="outcome-regression-and-propensity-scores.html#cb30-121" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                     0</span></span>
<span id="cb30-122"><a href="outcome-regression-and-propensity-scores.html#cb30-122" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                    0</span></span>
<span id="cb30-123"><a href="outcome-regression-and-propensity-scores.html#cb30-123" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(exercise)2</span></span>
<span id="cb30-124"><a href="outcome-regression-and-propensity-scores.html#cb30-124" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                     0</span></span>
<span id="cb30-125"><a href="outcome-regression-and-propensity-scores.html#cb30-125" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                    0</span></span>
<span id="cb30-126"><a href="outcome-regression-and-propensity-scores.html#cb30-126" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(active)1</span></span>
<span id="cb30-127"><a href="outcome-regression-and-propensity-scores.html#cb30-127" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                   0</span></span>
<span id="cb30-128"><a href="outcome-regression-and-propensity-scores.html#cb30-128" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                  0</span></span>
<span id="cb30-129"><a href="outcome-regression-and-propensity-scores.html#cb30-129" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(active)2 wt71</span></span>
<span id="cb30-130"><a href="outcome-regression-and-propensity-scores.html#cb30-130" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                   0    0</span></span>
<span id="cb30-131"><a href="outcome-regression-and-propensity-scores.html#cb30-131" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                  0    0</span></span>
<span id="cb30-132"><a href="outcome-regression-and-propensity-scores.html#cb30-132" tabindex="-1"></a><span class="co">#&gt;                                                    I(wt71 * wt71)</span></span>
<span id="cb30-133"><a href="outcome-regression-and-propensity-scores.html#cb30-133" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5               0</span></span>
<span id="cb30-134"><a href="outcome-regression-and-propensity-scores.html#cb30-134" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40              0</span></span>
<span id="cb30-135"><a href="outcome-regression-and-propensity-scores.html#cb30-135" tabindex="-1"></a><span class="co">#&gt;                                                    I(qsmk * smokeintensity)</span></span>
<span id="cb30-136"><a href="outcome-regression-and-propensity-scores.html#cb30-136" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                         5</span></span>
<span id="cb30-137"><a href="outcome-regression-and-propensity-scores.html#cb30-137" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                       40</span></span>
<span id="cb30-138"><a href="outcome-regression-and-propensity-scores.html#cb30-138" tabindex="-1"></a></span>
<span id="cb30-139"><a href="outcome-regression-and-propensity-scores.html#cb30-139" tabindex="-1"></a><span class="co"># (step 4) estimate the contrasts, get tests and confidence intervals for them</span></span>
<span id="cb30-140"><a href="outcome-regression-and-propensity-scores.html#cb30-140" tabindex="-1"></a>estimates1 <span class="ot">&lt;-</span> <span class="fu">glht</span>(fit, K1)</span>
<span id="cb30-141"><a href="outcome-regression-and-propensity-scores.html#cb30-141" tabindex="-1"></a>  <span class="fu">summary</span>(estimates1)</span>
<span id="cb30-142"><a href="outcome-regression-and-propensity-scores.html#cb30-142" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-143"><a href="outcome-regression-and-propensity-scores.html#cb30-143" tabindex="-1"></a><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span id="cb30-144"><a href="outcome-regression-and-propensity-scores.html#cb30-144" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-145"><a href="outcome-regression-and-propensity-scores.html#cb30-145" tabindex="-1"></a><span class="co">#&gt; Fit: glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age * age) + </span></span>
<span id="cb30-146"><a href="outcome-regression-and-propensity-scores.html#cb30-146" tabindex="-1"></a><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity * </span></span>
<span id="cb30-147"><a href="outcome-regression-and-propensity-scores.html#cb30-147" tabindex="-1"></a><span class="co">#&gt;     smokeintensity) + smokeyrs + I(smokeyrs * smokeyrs) + as.factor(exercise) + </span></span>
<span id="cb30-148"><a href="outcome-regression-and-propensity-scores.html#cb30-148" tabindex="-1"></a><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71 * wt71) + I(qsmk * smokeintensity), </span></span>
<span id="cb30-149"><a href="outcome-regression-and-propensity-scores.html#cb30-149" tabindex="-1"></a><span class="co">#&gt;     data = nhefs)</span></span>
<span id="cb30-150"><a href="outcome-regression-and-propensity-scores.html#cb30-150" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-151"><a href="outcome-regression-and-propensity-scores.html#cb30-151" tabindex="-1"></a><span class="co">#&gt; Linear Hypotheses:</span></span>
<span id="cb30-152"><a href="outcome-regression-and-propensity-scores.html#cb30-152" tabindex="-1"></a><span class="co">#&gt;                                                         Estimate Std. Error</span></span>
<span id="cb30-153"><a href="outcome-regression-and-propensity-scores.html#cb30-153" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5 == 0    2.7929     0.6683</span></span>
<span id="cb30-154"><a href="outcome-regression-and-propensity-scores.html#cb30-154" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40 == 0   4.4261     0.8478</span></span>
<span id="cb30-155"><a href="outcome-regression-and-propensity-scores.html#cb30-155" tabindex="-1"></a><span class="co">#&gt;                                                         z value Pr(&gt;|z|)    </span></span>
<span id="cb30-156"><a href="outcome-regression-and-propensity-scores.html#cb30-156" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5 == 0    4.179 5.84e-05 ***</span></span>
<span id="cb30-157"><a href="outcome-regression-and-propensity-scores.html#cb30-157" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40 == 0   5.221 3.56e-07 ***</span></span>
<span id="cb30-158"><a href="outcome-regression-and-propensity-scores.html#cb30-158" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb30-159"><a href="outcome-regression-and-propensity-scores.html#cb30-159" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb30-160"><a href="outcome-regression-and-propensity-scores.html#cb30-160" tabindex="-1"></a><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span>
<span id="cb30-161"><a href="outcome-regression-and-propensity-scores.html#cb30-161" tabindex="-1"></a>  <span class="fu">confint</span>(estimates1)</span>
<span id="cb30-162"><a href="outcome-regression-and-propensity-scores.html#cb30-162" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-163"><a href="outcome-regression-and-propensity-scores.html#cb30-163" tabindex="-1"></a><span class="co">#&gt;   Simultaneous Confidence Intervals</span></span>
<span id="cb30-164"><a href="outcome-regression-and-propensity-scores.html#cb30-164" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-165"><a href="outcome-regression-and-propensity-scores.html#cb30-165" tabindex="-1"></a><span class="co">#&gt; Fit: glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age * age) + </span></span>
<span id="cb30-166"><a href="outcome-regression-and-propensity-scores.html#cb30-166" tabindex="-1"></a><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity * </span></span>
<span id="cb30-167"><a href="outcome-regression-and-propensity-scores.html#cb30-167" tabindex="-1"></a><span class="co">#&gt;     smokeintensity) + smokeyrs + I(smokeyrs * smokeyrs) + as.factor(exercise) + </span></span>
<span id="cb30-168"><a href="outcome-regression-and-propensity-scores.html#cb30-168" tabindex="-1"></a><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71 * wt71) + I(qsmk * smokeintensity), </span></span>
<span id="cb30-169"><a href="outcome-regression-and-propensity-scores.html#cb30-169" tabindex="-1"></a><span class="co">#&gt;     data = nhefs)</span></span>
<span id="cb30-170"><a href="outcome-regression-and-propensity-scores.html#cb30-170" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-171"><a href="outcome-regression-and-propensity-scores.html#cb30-171" tabindex="-1"></a><span class="co">#&gt; Quantile = 2.2281</span></span>
<span id="cb30-172"><a href="outcome-regression-and-propensity-scores.html#cb30-172" tabindex="-1"></a><span class="co">#&gt; 95% family-wise confidence level</span></span>
<span id="cb30-173"><a href="outcome-regression-and-propensity-scores.html#cb30-173" tabindex="-1"></a><span class="co">#&gt;  </span></span>
<span id="cb30-174"><a href="outcome-regression-and-propensity-scores.html#cb30-174" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-175"><a href="outcome-regression-and-propensity-scores.html#cb30-175" tabindex="-1"></a><span class="co">#&gt; Linear Hypotheses:</span></span>
<span id="cb30-176"><a href="outcome-regression-and-propensity-scores.html#cb30-176" tabindex="-1"></a><span class="co">#&gt;                                                         Estimate lwr    upr   </span></span>
<span id="cb30-177"><a href="outcome-regression-and-propensity-scores.html#cb30-177" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5 == 0  2.7929   1.3039 4.2819</span></span>
<span id="cb30-178"><a href="outcome-regression-and-propensity-scores.html#cb30-178" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40 == 0 4.4261   2.5372 6.3151</span></span>
<span id="cb30-179"><a href="outcome-regression-and-propensity-scores.html#cb30-179" tabindex="-1"></a></span>
<span id="cb30-180"><a href="outcome-regression-and-propensity-scores.html#cb30-180" tabindex="-1"></a><span class="co"># regression on covariates, not allowing for effect modification</span></span>
<span id="cb30-181"><a href="outcome-regression-and-propensity-scores.html#cb30-181" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">*</span>age) <span class="sc">+</span> <span class="fu">as.factor</span>(education)</span>
<span id="cb30-182"><a href="outcome-regression-and-propensity-scores.html#cb30-182" tabindex="-1"></a>           <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">*</span>smokeintensity) <span class="sc">+</span> smokeyrs</span>
<span id="cb30-183"><a href="outcome-regression-and-propensity-scores.html#cb30-183" tabindex="-1"></a>           <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">*</span>smokeyrs) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active)</span>
<span id="cb30-184"><a href="outcome-regression-and-propensity-scores.html#cb30-184" tabindex="-1"></a>           <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">*</span>wt71), <span class="at">data=</span>nhefs)</span>
<span id="cb30-185"><a href="outcome-regression-and-propensity-scores.html#cb30-185" tabindex="-1"></a></span>
<span id="cb30-186"><a href="outcome-regression-and-propensity-scores.html#cb30-186" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span>
<span id="cb30-187"><a href="outcome-regression-and-propensity-scores.html#cb30-187" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-188"><a href="outcome-regression-and-propensity-scores.html#cb30-188" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb30-189"><a href="outcome-regression-and-propensity-scores.html#cb30-189" tabindex="-1"></a><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age * age) + </span></span>
<span id="cb30-190"><a href="outcome-regression-and-propensity-scores.html#cb30-190" tabindex="-1"></a><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity * </span></span>
<span id="cb30-191"><a href="outcome-regression-and-propensity-scores.html#cb30-191" tabindex="-1"></a><span class="co">#&gt;     smokeintensity) + smokeyrs + I(smokeyrs * smokeyrs) + as.factor(exercise) + </span></span>
<span id="cb30-192"><a href="outcome-regression-and-propensity-scores.html#cb30-192" tabindex="-1"></a><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71 * wt71), data = nhefs)</span></span>
<span id="cb30-193"><a href="outcome-regression-and-propensity-scores.html#cb30-193" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-194"><a href="outcome-regression-and-propensity-scores.html#cb30-194" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb30-195"><a href="outcome-regression-and-propensity-scores.html#cb30-195" tabindex="-1"></a><span class="co">#&gt;                                      Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb30-196"><a href="outcome-regression-and-propensity-scores.html#cb30-196" tabindex="-1"></a><span class="co">#&gt; (Intercept)                        -1.6586176  4.3137734  -0.384 0.700666    </span></span>
<span id="cb30-197"><a href="outcome-regression-and-propensity-scores.html#cb30-197" tabindex="-1"></a><span class="co">#&gt; qsmk                                3.4626218  0.4384543   7.897 5.36e-15 ***</span></span>
<span id="cb30-198"><a href="outcome-regression-and-propensity-scores.html#cb30-198" tabindex="-1"></a><span class="co">#&gt; sex                                -1.4650496  0.4683410  -3.128 0.001792 ** </span></span>
<span id="cb30-199"><a href="outcome-regression-and-propensity-scores.html#cb30-199" tabindex="-1"></a><span class="co">#&gt; race                                0.5864117  0.5816949   1.008 0.313560    </span></span>
<span id="cb30-200"><a href="outcome-regression-and-propensity-scores.html#cb30-200" tabindex="-1"></a><span class="co">#&gt; age                                 0.3626624  0.1633431   2.220 0.026546 *  </span></span>
<span id="cb30-201"><a href="outcome-regression-and-propensity-scores.html#cb30-201" tabindex="-1"></a><span class="co">#&gt; I(age * age)                       -0.0061377  0.0017263  -3.555 0.000389 ***</span></span>
<span id="cb30-202"><a href="outcome-regression-and-propensity-scores.html#cb30-202" tabindex="-1"></a><span class="co">#&gt; as.factor(education)2               0.8185263  0.6067815   1.349 0.177546    </span></span>
<span id="cb30-203"><a href="outcome-regression-and-propensity-scores.html#cb30-203" tabindex="-1"></a><span class="co">#&gt; as.factor(education)3               0.5715004  0.5561211   1.028 0.304273    </span></span>
<span id="cb30-204"><a href="outcome-regression-and-propensity-scores.html#cb30-204" tabindex="-1"></a><span class="co">#&gt; as.factor(education)4               1.5085173  0.8323778   1.812 0.070134 .  </span></span>
<span id="cb30-205"><a href="outcome-regression-and-propensity-scores.html#cb30-205" tabindex="-1"></a><span class="co">#&gt; as.factor(education)5              -0.1708264  0.7413289  -0.230 0.817786    </span></span>
<span id="cb30-206"><a href="outcome-regression-and-propensity-scores.html#cb30-206" tabindex="-1"></a><span class="co">#&gt; smokeintensity                      0.0651533  0.0503115   1.295 0.195514    </span></span>
<span id="cb30-207"><a href="outcome-regression-and-propensity-scores.html#cb30-207" tabindex="-1"></a><span class="co">#&gt; I(smokeintensity * smokeintensity) -0.0010468  0.0009373  -1.117 0.264261    </span></span>
<span id="cb30-208"><a href="outcome-regression-and-propensity-scores.html#cb30-208" tabindex="-1"></a><span class="co">#&gt; smokeyrs                            0.1333931  0.0917319   1.454 0.146104    </span></span>
<span id="cb30-209"><a href="outcome-regression-and-propensity-scores.html#cb30-209" tabindex="-1"></a><span class="co">#&gt; I(smokeyrs * smokeyrs)             -0.0018270  0.0015438  -1.183 0.236818    </span></span>
<span id="cb30-210"><a href="outcome-regression-and-propensity-scores.html#cb30-210" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)1                0.3206824  0.5349616   0.599 0.548961    </span></span>
<span id="cb30-211"><a href="outcome-regression-and-propensity-scores.html#cb30-211" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)2                0.3628786  0.5589557   0.649 0.516300    </span></span>
<span id="cb30-212"><a href="outcome-regression-and-propensity-scores.html#cb30-212" tabindex="-1"></a><span class="co">#&gt; as.factor(active)1                 -0.9429574  0.4100208  -2.300 0.021593 *  </span></span>
<span id="cb30-213"><a href="outcome-regression-and-propensity-scores.html#cb30-213" tabindex="-1"></a><span class="co">#&gt; as.factor(active)2                 -0.2580374  0.6847219  -0.377 0.706337    </span></span>
<span id="cb30-214"><a href="outcome-regression-and-propensity-scores.html#cb30-214" tabindex="-1"></a><span class="co">#&gt; wt71                                0.0373642  0.0831658   0.449 0.653297    </span></span>
<span id="cb30-215"><a href="outcome-regression-and-propensity-scores.html#cb30-215" tabindex="-1"></a><span class="co">#&gt; I(wt71 * wt71)                     -0.0009158  0.0005235  -1.749 0.080426 .  </span></span>
<span id="cb30-216"><a href="outcome-regression-and-propensity-scores.html#cb30-216" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb30-217"><a href="outcome-regression-and-propensity-scores.html#cb30-217" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb30-218"><a href="outcome-regression-and-propensity-scores.html#cb30-218" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-219"><a href="outcome-regression-and-propensity-scores.html#cb30-219" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 53.59474)</span></span>
<span id="cb30-220"><a href="outcome-regression-and-propensity-scores.html#cb30-220" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-221"><a href="outcome-regression-and-propensity-scores.html#cb30-221" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span id="cb30-222"><a href="outcome-regression-and-propensity-scores.html#cb30-222" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 82857  on 1546  degrees of freedom</span></span>
<span id="cb30-223"><a href="outcome-regression-and-propensity-scores.html#cb30-223" tabindex="-1"></a><span class="co">#&gt;   (63 observations deleted due to missingness)</span></span>
<span id="cb30-224"><a href="outcome-regression-and-propensity-scores.html#cb30-224" tabindex="-1"></a><span class="co">#&gt; AIC: 10701</span></span>
<span id="cb30-225"><a href="outcome-regression-and-propensity-scores.html#cb30-225" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-226"><a href="outcome-regression-and-propensity-scores.html#cb30-226" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
</div>
<div id="program-15.2" class="section level2 hasAnchor">
<h2>Program 15.2<a href="outcome-regression-and-propensity-scores.html#program-15.2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating and plotting the propensity score</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="outcome-regression-and-propensity-scores.html#cb31-1" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">*</span>age) <span class="sc">+</span> <span class="fu">as.factor</span>(education)</span>
<span id="cb31-2"><a href="outcome-regression-and-propensity-scores.html#cb31-2" tabindex="-1"></a>            <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">*</span>smokeintensity) <span class="sc">+</span> smokeyrs</span>
<span id="cb31-3"><a href="outcome-regression-and-propensity-scores.html#cb31-3" tabindex="-1"></a>            <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">*</span>smokeyrs) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active)</span>
<span id="cb31-4"><a href="outcome-regression-and-propensity-scores.html#cb31-4" tabindex="-1"></a>            <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">*</span>wt71), <span class="at">data=</span>nhefs, <span class="at">family=</span><span class="fu">binomial</span>())</span>
<span id="cb31-5"><a href="outcome-regression-and-propensity-scores.html#cb31-5" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span>
<span id="cb31-6"><a href="outcome-regression-and-propensity-scores.html#cb31-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-7"><a href="outcome-regression-and-propensity-scores.html#cb31-7" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb31-8"><a href="outcome-regression-and-propensity-scores.html#cb31-8" tabindex="-1"></a><span class="co">#&gt; glm(formula = qsmk ~ sex + race + age + I(age * age) + as.factor(education) + </span></span>
<span id="cb31-9"><a href="outcome-regression-and-propensity-scores.html#cb31-9" tabindex="-1"></a><span class="co">#&gt;     smokeintensity + I(smokeintensity * smokeintensity) + smokeyrs + </span></span>
<span id="cb31-10"><a href="outcome-regression-and-propensity-scores.html#cb31-10" tabindex="-1"></a><span class="co">#&gt;     I(smokeyrs * smokeyrs) + as.factor(exercise) + as.factor(active) + </span></span>
<span id="cb31-11"><a href="outcome-regression-and-propensity-scores.html#cb31-11" tabindex="-1"></a><span class="co">#&gt;     wt71 + I(wt71 * wt71), family = binomial(), data = nhefs)</span></span>
<span id="cb31-12"><a href="outcome-regression-and-propensity-scores.html#cb31-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-13"><a href="outcome-regression-and-propensity-scores.html#cb31-13" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb31-14"><a href="outcome-regression-and-propensity-scores.html#cb31-14" tabindex="-1"></a><span class="co">#&gt;                                      Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb31-15"><a href="outcome-regression-and-propensity-scores.html#cb31-15" tabindex="-1"></a><span class="co">#&gt; (Intercept)                        -1.9889022  1.2412792  -1.602 0.109089    </span></span>
<span id="cb31-16"><a href="outcome-regression-and-propensity-scores.html#cb31-16" tabindex="-1"></a><span class="co">#&gt; sex                                -0.5075218  0.1482316  -3.424 0.000617 ***</span></span>
<span id="cb31-17"><a href="outcome-regression-and-propensity-scores.html#cb31-17" tabindex="-1"></a><span class="co">#&gt; race                               -0.8502312  0.2058720  -4.130 3.63e-05 ***</span></span>
<span id="cb31-18"><a href="outcome-regression-and-propensity-scores.html#cb31-18" tabindex="-1"></a><span class="co">#&gt; age                                 0.1030132  0.0488996   2.107 0.035150 *  </span></span>
<span id="cb31-19"><a href="outcome-regression-and-propensity-scores.html#cb31-19" tabindex="-1"></a><span class="co">#&gt; I(age * age)                       -0.0006052  0.0005074  -1.193 0.232973    </span></span>
<span id="cb31-20"><a href="outcome-regression-and-propensity-scores.html#cb31-20" tabindex="-1"></a><span class="co">#&gt; as.factor(education)2              -0.0983203  0.1906553  -0.516 0.606066    </span></span>
<span id="cb31-21"><a href="outcome-regression-and-propensity-scores.html#cb31-21" tabindex="-1"></a><span class="co">#&gt; as.factor(education)3               0.0156987  0.1707139   0.092 0.926730    </span></span>
<span id="cb31-22"><a href="outcome-regression-and-propensity-scores.html#cb31-22" tabindex="-1"></a><span class="co">#&gt; as.factor(education)4              -0.0425260  0.2642761  -0.161 0.872160    </span></span>
<span id="cb31-23"><a href="outcome-regression-and-propensity-scores.html#cb31-23" tabindex="-1"></a><span class="co">#&gt; as.factor(education)5               0.3796632  0.2203947   1.723 0.084952 .  </span></span>
<span id="cb31-24"><a href="outcome-regression-and-propensity-scores.html#cb31-24" tabindex="-1"></a><span class="co">#&gt; smokeintensity                     -0.0651561  0.0147589  -4.415 1.01e-05 ***</span></span>
<span id="cb31-25"><a href="outcome-regression-and-propensity-scores.html#cb31-25" tabindex="-1"></a><span class="co">#&gt; I(smokeintensity * smokeintensity)  0.0008461  0.0002758   3.067 0.002160 ** </span></span>
<span id="cb31-26"><a href="outcome-regression-and-propensity-scores.html#cb31-26" tabindex="-1"></a><span class="co">#&gt; smokeyrs                           -0.0733708  0.0269958  -2.718 0.006571 ** </span></span>
<span id="cb31-27"><a href="outcome-regression-and-propensity-scores.html#cb31-27" tabindex="-1"></a><span class="co">#&gt; I(smokeyrs * smokeyrs)              0.0008384  0.0004435   1.891 0.058669 .  </span></span>
<span id="cb31-28"><a href="outcome-regression-and-propensity-scores.html#cb31-28" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)1                0.2914117  0.1735543   1.679 0.093136 .  </span></span>
<span id="cb31-29"><a href="outcome-regression-and-propensity-scores.html#cb31-29" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)2                0.3550517  0.1799293   1.973 0.048463 *  </span></span>
<span id="cb31-30"><a href="outcome-regression-and-propensity-scores.html#cb31-30" tabindex="-1"></a><span class="co">#&gt; as.factor(active)1                  0.0108754  0.1298320   0.084 0.933243    </span></span>
<span id="cb31-31"><a href="outcome-regression-and-propensity-scores.html#cb31-31" tabindex="-1"></a><span class="co">#&gt; as.factor(active)2                  0.0683123  0.2087269   0.327 0.743455    </span></span>
<span id="cb31-32"><a href="outcome-regression-and-propensity-scores.html#cb31-32" tabindex="-1"></a><span class="co">#&gt; wt71                               -0.0128478  0.0222829  -0.577 0.564226    </span></span>
<span id="cb31-33"><a href="outcome-regression-and-propensity-scores.html#cb31-33" tabindex="-1"></a><span class="co">#&gt; I(wt71 * wt71)                      0.0001209  0.0001352   0.895 0.370957    </span></span>
<span id="cb31-34"><a href="outcome-regression-and-propensity-scores.html#cb31-34" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb31-35"><a href="outcome-regression-and-propensity-scores.html#cb31-35" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb31-36"><a href="outcome-regression-and-propensity-scores.html#cb31-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-37"><a href="outcome-regression-and-propensity-scores.html#cb31-37" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb31-38"><a href="outcome-regression-and-propensity-scores.html#cb31-38" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-39"><a href="outcome-regression-and-propensity-scores.html#cb31-39" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 1876.3  on 1628  degrees of freedom</span></span>
<span id="cb31-40"><a href="outcome-regression-and-propensity-scores.html#cb31-40" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 1766.7  on 1610  degrees of freedom</span></span>
<span id="cb31-41"><a href="outcome-regression-and-propensity-scores.html#cb31-41" tabindex="-1"></a><span class="co">#&gt; AIC: 1804.7</span></span>
<span id="cb31-42"><a href="outcome-regression-and-propensity-scores.html#cb31-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-43"><a href="outcome-regression-and-propensity-scores.html#cb31-43" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span>
<span id="cb31-44"><a href="outcome-regression-and-propensity-scores.html#cb31-44" tabindex="-1"></a>nhefs<span class="sc">$</span>ps <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit3, nhefs, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb31-45"><a href="outcome-regression-and-propensity-scores.html#cb31-45" tabindex="-1"></a></span>
<span id="cb31-46"><a href="outcome-regression-and-propensity-scores.html#cb31-46" tabindex="-1"></a><span class="fu">summary</span>(nhefs<span class="sc">$</span>ps[nhefs<span class="sc">$</span>qsmk<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb31-47"><a href="outcome-regression-and-propensity-scores.html#cb31-47" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb31-48"><a href="outcome-regression-and-propensity-scores.html#cb31-48" tabindex="-1"></a><span class="co">#&gt; 0.05298 0.16949 0.22747 0.24504 0.30441 0.65788</span></span>
<span id="cb31-49"><a href="outcome-regression-and-propensity-scores.html#cb31-49" tabindex="-1"></a><span class="fu">summary</span>(nhefs<span class="sc">$</span>ps[nhefs<span class="sc">$</span>qsmk<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb31-50"><a href="outcome-regression-and-propensity-scores.html#cb31-50" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb31-51"><a href="outcome-regression-and-propensity-scores.html#cb31-51" tabindex="-1"></a><span class="co">#&gt; 0.06248 0.22046 0.28897 0.31240 0.38122 0.79320</span></span>
<span id="cb31-52"><a href="outcome-regression-and-propensity-scores.html#cb31-52" tabindex="-1"></a></span>
<span id="cb31-53"><a href="outcome-regression-and-propensity-scores.html#cb31-53" tabindex="-1"></a><span class="co"># # plotting the estimated propensity score</span></span>
<span id="cb31-54"><a href="outcome-regression-and-propensity-scores.html#cb31-54" tabindex="-1"></a><span class="co"># install.packages(&quot;ggplot2&quot;) # install packages if necessary</span></span>
<span id="cb31-55"><a href="outcome-regression-and-propensity-scores.html#cb31-55" tabindex="-1"></a><span class="co"># install.packages(&quot;dplyr&quot;)</span></span>
<span id="cb31-56"><a href="outcome-regression-and-propensity-scores.html#cb31-56" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb31-57"><a href="outcome-regression-and-propensity-scores.html#cb31-57" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb31-58"><a href="outcome-regression-and-propensity-scores.html#cb31-58" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-59"><a href="outcome-regression-and-propensity-scores.html#cb31-59" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span></span>
<span id="cb31-60"><a href="outcome-regression-and-propensity-scores.html#cb31-60" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:MASS&#39;:</span></span>
<span id="cb31-61"><a href="outcome-regression-and-propensity-scores.html#cb31-61" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-62"><a href="outcome-regression-and-propensity-scores.html#cb31-62" tabindex="-1"></a><span class="co">#&gt;     select</span></span>
<span id="cb31-63"><a href="outcome-regression-and-propensity-scores.html#cb31-63" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb31-64"><a href="outcome-regression-and-propensity-scores.html#cb31-64" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-65"><a href="outcome-regression-and-propensity-scores.html#cb31-65" tabindex="-1"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb31-66"><a href="outcome-regression-and-propensity-scores.html#cb31-66" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb31-67"><a href="outcome-regression-and-propensity-scores.html#cb31-67" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-68"><a href="outcome-regression-and-propensity-scores.html#cb31-68" tabindex="-1"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span id="cb31-69"><a href="outcome-regression-and-propensity-scores.html#cb31-69" tabindex="-1"></a></span>
<span id="cb31-70"><a href="outcome-regression-and-propensity-scores.html#cb31-70" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> nhefs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">qsmklabel =</span> <span class="fu">ifelse</span>(qsmk <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb31-71"><a href="outcome-regression-and-propensity-scores.html#cb31-71" tabindex="-1"></a>                       <span class="at">yes =</span> <span class="st">&#39;Quit Smoking 1971-1982&#39;</span>,</span>
<span id="cb31-72"><a href="outcome-regression-and-propensity-scores.html#cb31-72" tabindex="-1"></a>                       <span class="at">no =</span> <span class="st">&#39;Did Not Quit Smoking 1971-1982&#39;</span>))</span>
<span id="cb31-73"><a href="outcome-regression-and-propensity-scores.html#cb31-73" tabindex="-1"></a></span>
<span id="cb31-74"><a href="outcome-regression-and-propensity-scores.html#cb31-74" tabindex="-1"></a><span class="fu">ggplot</span>(nhefs, <span class="fu">aes</span>(<span class="at">x =</span> ps, <span class="at">fill =</span> qsmklabel, <span class="at">color =</span> qsmklabel)) <span class="sc">+</span> </span>
<span id="cb31-75"><a href="outcome-regression-and-propensity-scores.html#cb31-75" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb31-76"><a href="outcome-regression-and-propensity-scores.html#cb31-76" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Probability of Quitting Smoking During Follow-up&#39;</span>) <span class="sc">+</span></span>
<span id="cb31-77"><a href="outcome-regression-and-propensity-scores.html#cb31-77" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Propensity Score Distribution by Treatment Group&#39;</span>) <span class="sc">+</span></span>
<span id="cb31-78"><a href="outcome-regression-and-propensity-scores.html#cb31-78" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>, <span class="at">legend.direction =</span> <span class="st">&#39;vertical&#39;</span>,</span>
<span id="cb31-79"><a href="outcome-regression-and-propensity-scores.html#cb31-79" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="15-prop-scores-r_files/figure-html/unnamed-chunk-3-1.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="outcome-regression-and-propensity-scores.html#cb32-1" tabindex="-1"></a></span>
<span id="cb32-2"><a href="outcome-regression-and-propensity-scores.html#cb32-2" tabindex="-1"></a><span class="co"># alternative plot with histograms</span></span>
<span id="cb32-3"><a href="outcome-regression-and-propensity-scores.html#cb32-3" tabindex="-1"></a><span class="fu">ggplot</span>(nhefs, <span class="fu">aes</span>(<span class="at">x =</span> ps, <span class="at">fill =</span> <span class="fu">as.factor</span>(qsmk), <span class="at">color =</span> <span class="fu">as.factor</span>(qsmk))) <span class="sc">+</span></span>
<span id="cb32-4"><a href="outcome-regression-and-propensity-scores.html#cb32-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">position =</span> <span class="st">&#39;identity&#39;</span>, <span class="at">bins=</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb32-5"><a href="outcome-regression-and-propensity-scores.html#cb32-5" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">as.factor</span>(qsmk) <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb32-6"><a href="outcome-regression-and-propensity-scores.html#cb32-6" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Probability of Quitting Smoking During Follow-up&#39;</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="outcome-regression-and-propensity-scores.html#cb32-7" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Propensity Score Distribution by Treatment Group&#39;</span>) <span class="sc">+</span></span>
<span id="cb32-8"><a href="outcome-regression-and-propensity-scores.html#cb32-8" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="st">&#39;&#39;</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="outcome-regression-and-propensity-scores.html#cb32-9" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">&#39;&#39;</span>) <span class="sc">+</span></span>
<span id="cb32-10"><a href="outcome-regression-and-propensity-scores.html#cb32-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>, <span class="at">legend.direction =</span> <span class="st">&#39;vertical&#39;</span>)</span></code></pre></div>
<p><img src="15-prop-scores-r_files/figure-html/unnamed-chunk-3-2.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="outcome-regression-and-propensity-scores.html#cb33-1" tabindex="-1"></a><span class="co"># attempt to reproduce plot from the book</span></span>
<span id="cb33-2"><a href="outcome-regression-and-propensity-scores.html#cb33-2" tabindex="-1"></a>nhefs <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="outcome-regression-and-propensity-scores.html#cb33-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ps.grp =</span> <span class="fu">round</span>(ps<span class="sc">/</span><span class="fl">0.05</span>) <span class="sc">*</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="outcome-regression-and-propensity-scores.html#cb33-4" tabindex="-1"></a>  <span class="fu">group_by</span>(qsmk, ps.grp) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="outcome-regression-and-propensity-scores.html#cb33-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="outcome-regression-and-propensity-scores.html#cb33-6" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="outcome-regression-and-propensity-scores.html#cb33-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n2 =</span> <span class="fu">ifelse</span>(qsmk <span class="sc">==</span> <span class="dv">0</span>, <span class="at">yes =</span> n, <span class="at">no =</span>  <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>n)) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="outcome-regression-and-propensity-scores.html#cb33-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ps.grp, <span class="at">y =</span> n2, <span class="at">fill =</span> <span class="fu">as.factor</span>(qsmk))) <span class="sc">+</span></span>
<span id="cb33-9"><a href="outcome-regression-and-propensity-scores.html#cb33-9" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>, <span class="at">position =</span> <span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-10"><a href="outcome-regression-and-propensity-scores.html#cb33-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n, <span class="at">x =</span> ps.grp, <span class="at">y =</span> n2 <span class="sc">+</span> <span class="fu">ifelse</span>(qsmk <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">8</span>, <span class="sc">-</span><span class="dv">8</span>))) <span class="sc">+</span></span>
<span id="cb33-11"><a href="outcome-regression-and-propensity-scores.html#cb33-11" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Probability of Quitting Smoking During Follow-up&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="outcome-regression-and-propensity-scores.html#cb33-12" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;N&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-13"><a href="outcome-regression-and-propensity-scores.html#cb33-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Propensity Score Distribution by Treatment Group&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-14"><a href="outcome-regression-and-propensity-scores.html#cb33-14" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="st">&#39;&#39;</span>) <span class="sc">+</span></span>
<span id="cb33-15"><a href="outcome-regression-and-propensity-scores.html#cb33-15" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb33-16"><a href="outcome-regression-and-propensity-scores.html#cb33-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>, <span class="at">legend.direction =</span> <span class="st">&#39;vertical&#39;</span>,</span>
<span id="cb33-17"><a href="outcome-regression-and-propensity-scores.html#cb33-17" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb33-18"><a href="outcome-regression-and-propensity-scores.html#cb33-18" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
</div>
<div id="program-15.3" class="section level2 hasAnchor">
<h2>Program 15.3<a href="outcome-regression-and-propensity-scores.html#program-15.3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Stratification on the propensity score</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="outcome-regression-and-propensity-scores.html#cb34-1" tabindex="-1"></a><span class="co"># calculation of deciles</span></span>
<span id="cb34-2"><a href="outcome-regression-and-propensity-scores.html#cb34-2" tabindex="-1"></a>nhefs<span class="sc">$</span>ps.dec <span class="ot">&lt;-</span> <span class="fu">cut</span>(nhefs<span class="sc">$</span>ps,</span>
<span id="cb34-3"><a href="outcome-regression-and-propensity-scores.html#cb34-3" tabindex="-1"></a>                    <span class="at">breaks=</span><span class="fu">c</span>(<span class="fu">quantile</span>(nhefs<span class="sc">$</span>ps, <span class="at">probs=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>))),</span>
<span id="cb34-4"><a href="outcome-regression-and-propensity-scores.html#cb34-4" tabindex="-1"></a>                    <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb34-5"><a href="outcome-regression-and-propensity-scores.html#cb34-5" tabindex="-1"></a>                    <span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span>
<span id="cb34-6"><a href="outcome-regression-and-propensity-scores.html#cb34-6" tabindex="-1"></a></span>
<span id="cb34-7"><a href="outcome-regression-and-propensity-scores.html#cb34-7" tabindex="-1"></a><span class="co">#install.packages(&quot;psych&quot;) # install package if required</span></span>
<span id="cb34-8"><a href="outcome-regression-and-propensity-scores.html#cb34-8" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;psych&quot;</span>)</span>
<span id="cb34-9"><a href="outcome-regression-and-propensity-scores.html#cb34-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-10"><a href="outcome-regression-and-propensity-scores.html#cb34-10" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;psych&#39;</span></span>
<span id="cb34-11"><a href="outcome-regression-and-propensity-scores.html#cb34-11" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:ggplot2&#39;:</span></span>
<span id="cb34-12"><a href="outcome-regression-and-propensity-scores.html#cb34-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-13"><a href="outcome-regression-and-propensity-scores.html#cb34-13" tabindex="-1"></a><span class="co">#&gt;     %+%, alpha</span></span>
<span id="cb34-14"><a href="outcome-regression-and-propensity-scores.html#cb34-14" tabindex="-1"></a><span class="fu">describeBy</span>(nhefs<span class="sc">$</span>ps, <span class="fu">list</span>(nhefs<span class="sc">$</span>ps.dec, nhefs<span class="sc">$</span>qsmk))</span>
<span id="cb34-15"><a href="outcome-regression-and-propensity-scores.html#cb34-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-16"><a href="outcome-regression-and-propensity-scores.html#cb34-16" tabindex="-1"></a><span class="co">#&gt;  Descriptive statistics by group </span></span>
<span id="cb34-17"><a href="outcome-regression-and-propensity-scores.html#cb34-17" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-18"><a href="outcome-regression-and-propensity-scores.html#cb34-18" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-19"><a href="outcome-regression-and-propensity-scores.html#cb34-19" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb34-20"><a href="outcome-regression-and-propensity-scores.html#cb34-20" tabindex="-1"></a><span class="co">#&gt; X1    1 151  0.1 0.02   0.11     0.1 0.02 0.05 0.13  0.08 -0.55    -0.53  0</span></span>
<span id="cb34-21"><a href="outcome-regression-and-propensity-scores.html#cb34-21" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-22"><a href="outcome-regression-and-propensity-scores.html#cb34-22" tabindex="-1"></a><span class="co">#&gt; : 2</span></span>
<span id="cb34-23"><a href="outcome-regression-and-propensity-scores.html#cb34-23" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-24"><a href="outcome-regression-and-propensity-scores.html#cb34-24" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb34-25"><a href="outcome-regression-and-propensity-scores.html#cb34-25" tabindex="-1"></a><span class="co">#&gt; X1    1 136 0.15 0.01   0.15    0.15 0.01 0.13 0.17  0.04 -0.04    -1.23  0</span></span>
<span id="cb34-26"><a href="outcome-regression-and-propensity-scores.html#cb34-26" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-27"><a href="outcome-regression-and-propensity-scores.html#cb34-27" tabindex="-1"></a><span class="co">#&gt; : 3</span></span>
<span id="cb34-28"><a href="outcome-regression-and-propensity-scores.html#cb34-28" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-29"><a href="outcome-regression-and-propensity-scores.html#cb34-29" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb34-30"><a href="outcome-regression-and-propensity-scores.html#cb34-30" tabindex="-1"></a><span class="co">#&gt; X1    1 134 0.18 0.01   0.18    0.18 0.01 0.17 0.19  0.03 -0.08    -1.34  0</span></span>
<span id="cb34-31"><a href="outcome-regression-and-propensity-scores.html#cb34-31" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-32"><a href="outcome-regression-and-propensity-scores.html#cb34-32" tabindex="-1"></a><span class="co">#&gt; : 4</span></span>
<span id="cb34-33"><a href="outcome-regression-and-propensity-scores.html#cb34-33" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-34"><a href="outcome-regression-and-propensity-scores.html#cb34-34" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb34-35"><a href="outcome-regression-and-propensity-scores.html#cb34-35" tabindex="-1"></a><span class="co">#&gt; X1    1 129 0.21 0.01   0.21    0.21 0.01 0.19 0.22  0.02 -0.04    -1.13  0</span></span>
<span id="cb34-36"><a href="outcome-regression-and-propensity-scores.html#cb34-36" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-37"><a href="outcome-regression-and-propensity-scores.html#cb34-37" tabindex="-1"></a><span class="co">#&gt; : 5</span></span>
<span id="cb34-38"><a href="outcome-regression-and-propensity-scores.html#cb34-38" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-39"><a href="outcome-regression-and-propensity-scores.html#cb34-39" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb34-40"><a href="outcome-regression-and-propensity-scores.html#cb34-40" tabindex="-1"></a><span class="co">#&gt; X1    1 120 0.23 0.01   0.23    0.23 0.01 0.22 0.25  0.03 0.24    -1.22  0</span></span>
<span id="cb34-41"><a href="outcome-regression-and-propensity-scores.html#cb34-41" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-42"><a href="outcome-regression-and-propensity-scores.html#cb34-42" tabindex="-1"></a><span class="co">#&gt; : 6</span></span>
<span id="cb34-43"><a href="outcome-regression-and-propensity-scores.html#cb34-43" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-44"><a href="outcome-regression-and-propensity-scores.html#cb34-44" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb34-45"><a href="outcome-regression-and-propensity-scores.html#cb34-45" tabindex="-1"></a><span class="co">#&gt; X1    1 117 0.26 0.01   0.26    0.26 0.01 0.25 0.27  0.03 -0.11    -1.29  0</span></span>
<span id="cb34-46"><a href="outcome-regression-and-propensity-scores.html#cb34-46" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-47"><a href="outcome-regression-and-propensity-scores.html#cb34-47" tabindex="-1"></a><span class="co">#&gt; : 7</span></span>
<span id="cb34-48"><a href="outcome-regression-and-propensity-scores.html#cb34-48" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-49"><a href="outcome-regression-and-propensity-scores.html#cb34-49" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb34-50"><a href="outcome-regression-and-propensity-scores.html#cb34-50" tabindex="-1"></a><span class="co">#&gt; X1    1 120 0.29 0.01   0.29    0.29 0.01 0.27 0.31  0.03 -0.23    -1.19  0</span></span>
<span id="cb34-51"><a href="outcome-regression-and-propensity-scores.html#cb34-51" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-52"><a href="outcome-regression-and-propensity-scores.html#cb34-52" tabindex="-1"></a><span class="co">#&gt; : 8</span></span>
<span id="cb34-53"><a href="outcome-regression-and-propensity-scores.html#cb34-53" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-54"><a href="outcome-regression-and-propensity-scores.html#cb34-54" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb34-55"><a href="outcome-regression-and-propensity-scores.html#cb34-55" tabindex="-1"></a><span class="co">#&gt; X1    1 112 0.33 0.01   0.33    0.33 0.02 0.31 0.35  0.04 0.15     -1.1  0</span></span>
<span id="cb34-56"><a href="outcome-regression-and-propensity-scores.html#cb34-56" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-57"><a href="outcome-regression-and-propensity-scores.html#cb34-57" tabindex="-1"></a><span class="co">#&gt; : 9</span></span>
<span id="cb34-58"><a href="outcome-regression-and-propensity-scores.html#cb34-58" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-59"><a href="outcome-regression-and-propensity-scores.html#cb34-59" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb34-60"><a href="outcome-regression-and-propensity-scores.html#cb34-60" tabindex="-1"></a><span class="co">#&gt; X1    1 96 0.38 0.02   0.38    0.38 0.02 0.35 0.42  0.06 0.13    -1.15  0</span></span>
<span id="cb34-61"><a href="outcome-regression-and-propensity-scores.html#cb34-61" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-62"><a href="outcome-regression-and-propensity-scores.html#cb34-62" tabindex="-1"></a><span class="co">#&gt; : 10</span></span>
<span id="cb34-63"><a href="outcome-regression-and-propensity-scores.html#cb34-63" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb34-64"><a href="outcome-regression-and-propensity-scores.html#cb34-64" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis   se</span></span>
<span id="cb34-65"><a href="outcome-regression-and-propensity-scores.html#cb34-65" tabindex="-1"></a><span class="co">#&gt; X1    1 86 0.49 0.06   0.47    0.48 0.05 0.42 0.66  0.24  1.1     0.47 0.01</span></span>
<span id="cb34-66"><a href="outcome-regression-and-propensity-scores.html#cb34-66" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-67"><a href="outcome-regression-and-propensity-scores.html#cb34-67" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-68"><a href="outcome-regression-and-propensity-scores.html#cb34-68" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-69"><a href="outcome-regression-and-propensity-scores.html#cb34-69" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis   se</span></span>
<span id="cb34-70"><a href="outcome-regression-and-propensity-scores.html#cb34-70" tabindex="-1"></a><span class="co">#&gt; X1    1 12  0.1 0.02   0.11     0.1 0.03 0.06 0.13  0.07 -0.5    -1.36 0.01</span></span>
<span id="cb34-71"><a href="outcome-regression-and-propensity-scores.html#cb34-71" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-72"><a href="outcome-regression-and-propensity-scores.html#cb34-72" tabindex="-1"></a><span class="co">#&gt; : 2</span></span>
<span id="cb34-73"><a href="outcome-regression-and-propensity-scores.html#cb34-73" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-74"><a href="outcome-regression-and-propensity-scores.html#cb34-74" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb34-75"><a href="outcome-regression-and-propensity-scores.html#cb34-75" tabindex="-1"></a><span class="co">#&gt; X1    1 27 0.15 0.01   0.15    0.15 0.01 0.13 0.17  0.03 -0.03    -1.34  0</span></span>
<span id="cb34-76"><a href="outcome-regression-and-propensity-scores.html#cb34-76" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-77"><a href="outcome-regression-and-propensity-scores.html#cb34-77" tabindex="-1"></a><span class="co">#&gt; : 3</span></span>
<span id="cb34-78"><a href="outcome-regression-and-propensity-scores.html#cb34-78" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-79"><a href="outcome-regression-and-propensity-scores.html#cb34-79" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb34-80"><a href="outcome-regression-and-propensity-scores.html#cb34-80" tabindex="-1"></a><span class="co">#&gt; X1    1 29 0.18 0.01   0.18    0.18 0.01 0.17 0.19  0.03 0.01    -1.34  0</span></span>
<span id="cb34-81"><a href="outcome-regression-and-propensity-scores.html#cb34-81" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-82"><a href="outcome-regression-and-propensity-scores.html#cb34-82" tabindex="-1"></a><span class="co">#&gt; : 4</span></span>
<span id="cb34-83"><a href="outcome-regression-and-propensity-scores.html#cb34-83" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-84"><a href="outcome-regression-and-propensity-scores.html#cb34-84" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb34-85"><a href="outcome-regression-and-propensity-scores.html#cb34-85" tabindex="-1"></a><span class="co">#&gt; X1    1 34 0.21 0.01   0.21    0.21 0.01 0.19 0.22  0.02 -0.31    -1.23  0</span></span>
<span id="cb34-86"><a href="outcome-regression-and-propensity-scores.html#cb34-86" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-87"><a href="outcome-regression-and-propensity-scores.html#cb34-87" tabindex="-1"></a><span class="co">#&gt; : 5</span></span>
<span id="cb34-88"><a href="outcome-regression-and-propensity-scores.html#cb34-88" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-89"><a href="outcome-regression-and-propensity-scores.html#cb34-89" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb34-90"><a href="outcome-regression-and-propensity-scores.html#cb34-90" tabindex="-1"></a><span class="co">#&gt; X1    1 43 0.23 0.01   0.23    0.23 0.01 0.22 0.25  0.03 0.11    -1.23  0</span></span>
<span id="cb34-91"><a href="outcome-regression-and-propensity-scores.html#cb34-91" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-92"><a href="outcome-regression-and-propensity-scores.html#cb34-92" tabindex="-1"></a><span class="co">#&gt; : 6</span></span>
<span id="cb34-93"><a href="outcome-regression-and-propensity-scores.html#cb34-93" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-94"><a href="outcome-regression-and-propensity-scores.html#cb34-94" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb34-95"><a href="outcome-regression-and-propensity-scores.html#cb34-95" tabindex="-1"></a><span class="co">#&gt; X1    1 45 0.26 0.01   0.26    0.26 0.01 0.25 0.27  0.03  0.2    -1.12  0</span></span>
<span id="cb34-96"><a href="outcome-regression-and-propensity-scores.html#cb34-96" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-97"><a href="outcome-regression-and-propensity-scores.html#cb34-97" tabindex="-1"></a><span class="co">#&gt; : 7</span></span>
<span id="cb34-98"><a href="outcome-regression-and-propensity-scores.html#cb34-98" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-99"><a href="outcome-regression-and-propensity-scores.html#cb34-99" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb34-100"><a href="outcome-regression-and-propensity-scores.html#cb34-100" tabindex="-1"></a><span class="co">#&gt; X1    1 43 0.29 0.01   0.29    0.29 0.01 0.27 0.31  0.03 0.16    -1.25  0</span></span>
<span id="cb34-101"><a href="outcome-regression-and-propensity-scores.html#cb34-101" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-102"><a href="outcome-regression-and-propensity-scores.html#cb34-102" tabindex="-1"></a><span class="co">#&gt; : 8</span></span>
<span id="cb34-103"><a href="outcome-regression-and-propensity-scores.html#cb34-103" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-104"><a href="outcome-regression-and-propensity-scores.html#cb34-104" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb34-105"><a href="outcome-regression-and-propensity-scores.html#cb34-105" tabindex="-1"></a><span class="co">#&gt; X1    1 51 0.33 0.01   0.33    0.33 0.02 0.31 0.35  0.04 0.11    -1.19  0</span></span>
<span id="cb34-106"><a href="outcome-regression-and-propensity-scores.html#cb34-106" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-107"><a href="outcome-regression-and-propensity-scores.html#cb34-107" tabindex="-1"></a><span class="co">#&gt; : 9</span></span>
<span id="cb34-108"><a href="outcome-regression-and-propensity-scores.html#cb34-108" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-109"><a href="outcome-regression-and-propensity-scores.html#cb34-109" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb34-110"><a href="outcome-regression-and-propensity-scores.html#cb34-110" tabindex="-1"></a><span class="co">#&gt; X1    1 67 0.38 0.02   0.38    0.38 0.03 0.35 0.42  0.06 0.19    -1.27  0</span></span>
<span id="cb34-111"><a href="outcome-regression-and-propensity-scores.html#cb34-111" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb34-112"><a href="outcome-regression-and-propensity-scores.html#cb34-112" tabindex="-1"></a><span class="co">#&gt; : 10</span></span>
<span id="cb34-113"><a href="outcome-regression-and-propensity-scores.html#cb34-113" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb34-114"><a href="outcome-regression-and-propensity-scores.html#cb34-114" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis   se</span></span>
<span id="cb34-115"><a href="outcome-regression-and-propensity-scores.html#cb34-115" tabindex="-1"></a><span class="co">#&gt; X1    1 77 0.52 0.08   0.51    0.51 0.08 0.42 0.79  0.38 0.88     0.81 0.01</span></span>
<span id="cb34-116"><a href="outcome-regression-and-propensity-scores.html#cb34-116" tabindex="-1"></a></span>
<span id="cb34-117"><a href="outcome-regression-and-propensity-scores.html#cb34-117" tabindex="-1"></a><span class="co"># function to create deciles easily</span></span>
<span id="cb34-118"><a href="outcome-regression-and-propensity-scores.html#cb34-118" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-119"><a href="outcome-regression-and-propensity-scores.html#cb34-119" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">factor</span>(<span class="fu">quantcut</span>(x, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">labels =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb34-120"><a href="outcome-regression-and-propensity-scores.html#cb34-120" tabindex="-1"></a>}</span>
<span id="cb34-121"><a href="outcome-regression-and-propensity-scores.html#cb34-121" tabindex="-1"></a></span>
<span id="cb34-122"><a href="outcome-regression-and-propensity-scores.html#cb34-122" tabindex="-1"></a><span class="co"># regression on PS deciles, allowing for effect modification</span></span>
<span id="cb34-123"><a href="outcome-regression-and-propensity-scores.html#cb34-123" tabindex="-1"></a><span class="cf">for</span> (deciles <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) {</span>
<span id="cb34-124"><a href="outcome-regression-and-propensity-scores.html#cb34-124" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">t.test</span>(wt82_71<span class="sc">~</span>qsmk, <span class="at">data=</span>nhefs[<span class="fu">which</span>(nhefs<span class="sc">$</span>ps.dec<span class="sc">==</span>deciles),]))</span>
<span id="cb34-125"><a href="outcome-regression-and-propensity-scores.html#cb34-125" tabindex="-1"></a>}</span>
<span id="cb34-126"><a href="outcome-regression-and-propensity-scores.html#cb34-126" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-127"><a href="outcome-regression-and-propensity-scores.html#cb34-127" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-128"><a href="outcome-regression-and-propensity-scores.html#cb34-128" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-129"><a href="outcome-regression-and-propensity-scores.html#cb34-129" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-130"><a href="outcome-regression-and-propensity-scores.html#cb34-130" tabindex="-1"></a><span class="co">#&gt; t = 0.0060506, df = 11.571, p-value = 0.9953</span></span>
<span id="cb34-131"><a href="outcome-regression-and-propensity-scores.html#cb34-131" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-132"><a href="outcome-regression-and-propensity-scores.html#cb34-132" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-133"><a href="outcome-regression-and-propensity-scores.html#cb34-133" tabindex="-1"></a><span class="co">#&gt;  -5.283903  5.313210</span></span>
<span id="cb34-134"><a href="outcome-regression-and-propensity-scores.html#cb34-134" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-135"><a href="outcome-regression-and-propensity-scores.html#cb34-135" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-136"><a href="outcome-regression-and-propensity-scores.html#cb34-136" tabindex="-1"></a><span class="co">#&gt;        3.995205        3.980551 </span></span>
<span id="cb34-137"><a href="outcome-regression-and-propensity-scores.html#cb34-137" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-138"><a href="outcome-regression-and-propensity-scores.html#cb34-138" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-139"><a href="outcome-regression-and-propensity-scores.html#cb34-139" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-140"><a href="outcome-regression-and-propensity-scores.html#cb34-140" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-141"><a href="outcome-regression-and-propensity-scores.html#cb34-141" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-142"><a href="outcome-regression-and-propensity-scores.html#cb34-142" tabindex="-1"></a><span class="co">#&gt; t = -3.1117, df = 37.365, p-value = 0.003556</span></span>
<span id="cb34-143"><a href="outcome-regression-and-propensity-scores.html#cb34-143" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-144"><a href="outcome-regression-and-propensity-scores.html#cb34-144" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-145"><a href="outcome-regression-and-propensity-scores.html#cb34-145" tabindex="-1"></a><span class="co">#&gt;  -6.849335 -1.448161</span></span>
<span id="cb34-146"><a href="outcome-regression-and-propensity-scores.html#cb34-146" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-147"><a href="outcome-regression-and-propensity-scores.html#cb34-147" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-148"><a href="outcome-regression-and-propensity-scores.html#cb34-148" tabindex="-1"></a><span class="co">#&gt;        2.904679        7.053426 </span></span>
<span id="cb34-149"><a href="outcome-regression-and-propensity-scores.html#cb34-149" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-150"><a href="outcome-regression-and-propensity-scores.html#cb34-150" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-151"><a href="outcome-regression-and-propensity-scores.html#cb34-151" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-152"><a href="outcome-regression-and-propensity-scores.html#cb34-152" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-153"><a href="outcome-regression-and-propensity-scores.html#cb34-153" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-154"><a href="outcome-regression-and-propensity-scores.html#cb34-154" tabindex="-1"></a><span class="co">#&gt; t = -4.5301, df = 35.79, p-value = 6.317e-05</span></span>
<span id="cb34-155"><a href="outcome-regression-and-propensity-scores.html#cb34-155" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-156"><a href="outcome-regression-and-propensity-scores.html#cb34-156" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-157"><a href="outcome-regression-and-propensity-scores.html#cb34-157" tabindex="-1"></a><span class="co">#&gt;  -9.474961 -3.613990</span></span>
<span id="cb34-158"><a href="outcome-regression-and-propensity-scores.html#cb34-158" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-159"><a href="outcome-regression-and-propensity-scores.html#cb34-159" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-160"><a href="outcome-regression-and-propensity-scores.html#cb34-160" tabindex="-1"></a><span class="co">#&gt;        2.612094        9.156570 </span></span>
<span id="cb34-161"><a href="outcome-regression-and-propensity-scores.html#cb34-161" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-162"><a href="outcome-regression-and-propensity-scores.html#cb34-162" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-163"><a href="outcome-regression-and-propensity-scores.html#cb34-163" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-164"><a href="outcome-regression-and-propensity-scores.html#cb34-164" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-165"><a href="outcome-regression-and-propensity-scores.html#cb34-165" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-166"><a href="outcome-regression-and-propensity-scores.html#cb34-166" tabindex="-1"></a><span class="co">#&gt; t = -1.4117, df = 45.444, p-value = 0.1648</span></span>
<span id="cb34-167"><a href="outcome-regression-and-propensity-scores.html#cb34-167" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-168"><a href="outcome-regression-and-propensity-scores.html#cb34-168" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-169"><a href="outcome-regression-and-propensity-scores.html#cb34-169" tabindex="-1"></a><span class="co">#&gt;  -5.6831731  0.9985715</span></span>
<span id="cb34-170"><a href="outcome-regression-and-propensity-scores.html#cb34-170" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-171"><a href="outcome-regression-and-propensity-scores.html#cb34-171" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-172"><a href="outcome-regression-and-propensity-scores.html#cb34-172" tabindex="-1"></a><span class="co">#&gt;        3.474679        5.816979 </span></span>
<span id="cb34-173"><a href="outcome-regression-and-propensity-scores.html#cb34-173" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-174"><a href="outcome-regression-and-propensity-scores.html#cb34-174" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-175"><a href="outcome-regression-and-propensity-scores.html#cb34-175" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-176"><a href="outcome-regression-and-propensity-scores.html#cb34-176" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-177"><a href="outcome-regression-and-propensity-scores.html#cb34-177" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-178"><a href="outcome-regression-and-propensity-scores.html#cb34-178" tabindex="-1"></a><span class="co">#&gt; t = -3.1371, df = 74.249, p-value = 0.002446</span></span>
<span id="cb34-179"><a href="outcome-regression-and-propensity-scores.html#cb34-179" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-180"><a href="outcome-regression-and-propensity-scores.html#cb34-180" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-181"><a href="outcome-regression-and-propensity-scores.html#cb34-181" tabindex="-1"></a><span class="co">#&gt;  -6.753621 -1.507087</span></span>
<span id="cb34-182"><a href="outcome-regression-and-propensity-scores.html#cb34-182" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-183"><a href="outcome-regression-and-propensity-scores.html#cb34-183" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-184"><a href="outcome-regression-and-propensity-scores.html#cb34-184" tabindex="-1"></a><span class="co">#&gt;        2.098800        6.229154 </span></span>
<span id="cb34-185"><a href="outcome-regression-and-propensity-scores.html#cb34-185" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-186"><a href="outcome-regression-and-propensity-scores.html#cb34-186" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-187"><a href="outcome-regression-and-propensity-scores.html#cb34-187" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-188"><a href="outcome-regression-and-propensity-scores.html#cb34-188" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-189"><a href="outcome-regression-and-propensity-scores.html#cb34-189" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-190"><a href="outcome-regression-and-propensity-scores.html#cb34-190" tabindex="-1"></a><span class="co">#&gt; t = -2.1677, df = 50.665, p-value = 0.0349</span></span>
<span id="cb34-191"><a href="outcome-regression-and-propensity-scores.html#cb34-191" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-192"><a href="outcome-regression-and-propensity-scores.html#cb34-192" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-193"><a href="outcome-regression-and-propensity-scores.html#cb34-193" tabindex="-1"></a><span class="co">#&gt;  -8.7516605 -0.3350127</span></span>
<span id="cb34-194"><a href="outcome-regression-and-propensity-scores.html#cb34-194" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-195"><a href="outcome-regression-and-propensity-scores.html#cb34-195" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-196"><a href="outcome-regression-and-propensity-scores.html#cb34-196" tabindex="-1"></a><span class="co">#&gt;        1.847004        6.390340 </span></span>
<span id="cb34-197"><a href="outcome-regression-and-propensity-scores.html#cb34-197" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-198"><a href="outcome-regression-and-propensity-scores.html#cb34-198" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-199"><a href="outcome-regression-and-propensity-scores.html#cb34-199" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-200"><a href="outcome-regression-and-propensity-scores.html#cb34-200" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-201"><a href="outcome-regression-and-propensity-scores.html#cb34-201" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-202"><a href="outcome-regression-and-propensity-scores.html#cb34-202" tabindex="-1"></a><span class="co">#&gt; t = -3.3155, df = 84.724, p-value = 0.001348</span></span>
<span id="cb34-203"><a href="outcome-regression-and-propensity-scores.html#cb34-203" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-204"><a href="outcome-regression-and-propensity-scores.html#cb34-204" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-205"><a href="outcome-regression-and-propensity-scores.html#cb34-205" tabindex="-1"></a><span class="co">#&gt;  -6.904207 -1.727590</span></span>
<span id="cb34-206"><a href="outcome-regression-and-propensity-scores.html#cb34-206" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-207"><a href="outcome-regression-and-propensity-scores.html#cb34-207" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-208"><a href="outcome-regression-and-propensity-scores.html#cb34-208" tabindex="-1"></a><span class="co">#&gt;        1.560048        5.875946 </span></span>
<span id="cb34-209"><a href="outcome-regression-and-propensity-scores.html#cb34-209" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-210"><a href="outcome-regression-and-propensity-scores.html#cb34-210" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-211"><a href="outcome-regression-and-propensity-scores.html#cb34-211" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-212"><a href="outcome-regression-and-propensity-scores.html#cb34-212" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-213"><a href="outcome-regression-and-propensity-scores.html#cb34-213" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-214"><a href="outcome-regression-and-propensity-scores.html#cb34-214" tabindex="-1"></a><span class="co">#&gt; t = -2.664, df = 75.306, p-value = 0.009441</span></span>
<span id="cb34-215"><a href="outcome-regression-and-propensity-scores.html#cb34-215" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-216"><a href="outcome-regression-and-propensity-scores.html#cb34-216" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-217"><a href="outcome-regression-and-propensity-scores.html#cb34-217" tabindex="-1"></a><span class="co">#&gt;  -6.2396014 -0.9005605</span></span>
<span id="cb34-218"><a href="outcome-regression-and-propensity-scores.html#cb34-218" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-219"><a href="outcome-regression-and-propensity-scores.html#cb34-219" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-220"><a href="outcome-regression-and-propensity-scores.html#cb34-220" tabindex="-1"></a><span class="co">#&gt;       0.2846851       3.8547661 </span></span>
<span id="cb34-221"><a href="outcome-regression-and-propensity-scores.html#cb34-221" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-222"><a href="outcome-regression-and-propensity-scores.html#cb34-222" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-223"><a href="outcome-regression-and-propensity-scores.html#cb34-223" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-224"><a href="outcome-regression-and-propensity-scores.html#cb34-224" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-225"><a href="outcome-regression-and-propensity-scores.html#cb34-225" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-226"><a href="outcome-regression-and-propensity-scores.html#cb34-226" tabindex="-1"></a><span class="co">#&gt; t = -1.9122, df = 129.12, p-value = 0.05806</span></span>
<span id="cb34-227"><a href="outcome-regression-and-propensity-scores.html#cb34-227" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-228"><a href="outcome-regression-and-propensity-scores.html#cb34-228" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-229"><a href="outcome-regression-and-propensity-scores.html#cb34-229" tabindex="-1"></a><span class="co">#&gt;  -4.68143608  0.07973698</span></span>
<span id="cb34-230"><a href="outcome-regression-and-propensity-scores.html#cb34-230" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-231"><a href="outcome-regression-and-propensity-scores.html#cb34-231" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-232"><a href="outcome-regression-and-propensity-scores.html#cb34-232" tabindex="-1"></a><span class="co">#&gt;      -0.8954482       1.4054014 </span></span>
<span id="cb34-233"><a href="outcome-regression-and-propensity-scores.html#cb34-233" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-234"><a href="outcome-regression-and-propensity-scores.html#cb34-234" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-235"><a href="outcome-regression-and-propensity-scores.html#cb34-235" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb34-236"><a href="outcome-regression-and-propensity-scores.html#cb34-236" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-237"><a href="outcome-regression-and-propensity-scores.html#cb34-237" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb34-238"><a href="outcome-regression-and-propensity-scores.html#cb34-238" tabindex="-1"></a><span class="co">#&gt; t = -1.5925, df = 142.72, p-value = 0.1135</span></span>
<span id="cb34-239"><a href="outcome-regression-and-propensity-scores.html#cb34-239" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb34-240"><a href="outcome-regression-and-propensity-scores.html#cb34-240" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb34-241"><a href="outcome-regression-and-propensity-scores.html#cb34-241" tabindex="-1"></a><span class="co">#&gt;  -5.0209284  0.5404697</span></span>
<span id="cb34-242"><a href="outcome-regression-and-propensity-scores.html#cb34-242" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb34-243"><a href="outcome-regression-and-propensity-scores.html#cb34-243" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb34-244"><a href="outcome-regression-and-propensity-scores.html#cb34-244" tabindex="-1"></a><span class="co">#&gt;      -0.5043766       1.7358528</span></span>
<span id="cb34-245"><a href="outcome-regression-and-propensity-scores.html#cb34-245" tabindex="-1"></a></span>
<span id="cb34-246"><a href="outcome-regression-and-propensity-scores.html#cb34-246" tabindex="-1"></a><span class="co"># regression on PS deciles, not allowing for effect modification</span></span>
<span id="cb34-247"><a href="outcome-regression-and-propensity-scores.html#cb34-247" tabindex="-1"></a>fit.psdec <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> <span class="fu">as.factor</span>(ps.dec), <span class="at">data =</span> nhefs)</span>
<span id="cb34-248"><a href="outcome-regression-and-propensity-scores.html#cb34-248" tabindex="-1"></a><span class="fu">summary</span>(fit.psdec)</span>
<span id="cb34-249"><a href="outcome-regression-and-propensity-scores.html#cb34-249" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-250"><a href="outcome-regression-and-propensity-scores.html#cb34-250" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb34-251"><a href="outcome-regression-and-propensity-scores.html#cb34-251" tabindex="-1"></a><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + as.factor(ps.dec), data = nhefs)</span></span>
<span id="cb34-252"><a href="outcome-regression-and-propensity-scores.html#cb34-252" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-253"><a href="outcome-regression-and-propensity-scores.html#cb34-253" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb34-254"><a href="outcome-regression-and-propensity-scores.html#cb34-254" tabindex="-1"></a><span class="co">#&gt;                     Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb34-255"><a href="outcome-regression-and-propensity-scores.html#cb34-255" tabindex="-1"></a><span class="co">#&gt; (Intercept)           3.7505     0.6089   6.159 9.29e-10 ***</span></span>
<span id="cb34-256"><a href="outcome-regression-and-propensity-scores.html#cb34-256" tabindex="-1"></a><span class="co">#&gt; qsmk                  3.5005     0.4571   7.659 3.28e-14 ***</span></span>
<span id="cb34-257"><a href="outcome-regression-and-propensity-scores.html#cb34-257" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)2   -0.7391     0.8611  -0.858   0.3908    </span></span>
<span id="cb34-258"><a href="outcome-regression-and-propensity-scores.html#cb34-258" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)3   -0.6182     0.8612  -0.718   0.4730    </span></span>
<span id="cb34-259"><a href="outcome-regression-and-propensity-scores.html#cb34-259" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)4   -0.5204     0.8584  -0.606   0.5444    </span></span>
<span id="cb34-260"><a href="outcome-regression-and-propensity-scores.html#cb34-260" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)5   -1.4884     0.8590  -1.733   0.0834 .  </span></span>
<span id="cb34-261"><a href="outcome-regression-and-propensity-scores.html#cb34-261" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)6   -1.6227     0.8675  -1.871   0.0616 .  </span></span>
<span id="cb34-262"><a href="outcome-regression-and-propensity-scores.html#cb34-262" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)7   -1.9853     0.8681  -2.287   0.0223 *  </span></span>
<span id="cb34-263"><a href="outcome-regression-and-propensity-scores.html#cb34-263" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)8   -3.4447     0.8749  -3.937 8.61e-05 ***</span></span>
<span id="cb34-264"><a href="outcome-regression-and-propensity-scores.html#cb34-264" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)9   -5.1544     0.8848  -5.825 6.91e-09 ***</span></span>
<span id="cb34-265"><a href="outcome-regression-and-propensity-scores.html#cb34-265" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)10  -4.8403     0.8828  -5.483 4.87e-08 ***</span></span>
<span id="cb34-266"><a href="outcome-regression-and-propensity-scores.html#cb34-266" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb34-267"><a href="outcome-regression-and-propensity-scores.html#cb34-267" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb34-268"><a href="outcome-regression-and-propensity-scores.html#cb34-268" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-269"><a href="outcome-regression-and-propensity-scores.html#cb34-269" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 58.42297)</span></span>
<span id="cb34-270"><a href="outcome-regression-and-propensity-scores.html#cb34-270" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-271"><a href="outcome-regression-and-propensity-scores.html#cb34-271" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span id="cb34-272"><a href="outcome-regression-and-propensity-scores.html#cb34-272" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 90848  on 1555  degrees of freedom</span></span>
<span id="cb34-273"><a href="outcome-regression-and-propensity-scores.html#cb34-273" tabindex="-1"></a><span class="co">#&gt;   (63 observations deleted due to missingness)</span></span>
<span id="cb34-274"><a href="outcome-regression-and-propensity-scores.html#cb34-274" tabindex="-1"></a><span class="co">#&gt; AIC: 10827</span></span>
<span id="cb34-275"><a href="outcome-regression-and-propensity-scores.html#cb34-275" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb34-276"><a href="outcome-regression-and-propensity-scores.html#cb34-276" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span>
<span id="cb34-277"><a href="outcome-regression-and-propensity-scores.html#cb34-277" tabindex="-1"></a><span class="fu">confint.lm</span>(fit.psdec)</span>
<span id="cb34-278"><a href="outcome-regression-and-propensity-scores.html#cb34-278" tabindex="-1"></a><span class="co">#&gt;                         2.5 %      97.5 %</span></span>
<span id="cb34-279"><a href="outcome-regression-and-propensity-scores.html#cb34-279" tabindex="-1"></a><span class="co">#&gt; (Intercept)          2.556098  4.94486263</span></span>
<span id="cb34-280"><a href="outcome-regression-and-propensity-scores.html#cb34-280" tabindex="-1"></a><span class="co">#&gt; qsmk                 2.603953  4.39700504</span></span>
<span id="cb34-281"><a href="outcome-regression-and-propensity-scores.html#cb34-281" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)2  -2.428074  0.94982494</span></span>
<span id="cb34-282"><a href="outcome-regression-and-propensity-scores.html#cb34-282" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)3  -2.307454  1.07103569</span></span>
<span id="cb34-283"><a href="outcome-regression-and-propensity-scores.html#cb34-283" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)4  -2.204103  1.16333143</span></span>
<span id="cb34-284"><a href="outcome-regression-and-propensity-scores.html#cb34-284" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)5  -3.173337  0.19657938</span></span>
<span id="cb34-285"><a href="outcome-regression-and-propensity-scores.html#cb34-285" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)6  -3.324345  0.07893027</span></span>
<span id="cb34-286"><a href="outcome-regression-and-propensity-scores.html#cb34-286" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)7  -3.688043 -0.28248110</span></span>
<span id="cb34-287"><a href="outcome-regression-and-propensity-scores.html#cb34-287" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)8  -5.160862 -1.72860113</span></span>
<span id="cb34-288"><a href="outcome-regression-and-propensity-scores.html#cb34-288" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)9  -6.889923 -3.41883853</span></span>
<span id="cb34-289"><a href="outcome-regression-and-propensity-scores.html#cb34-289" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)10 -6.571789 -3.10873731</span></span></code></pre></div>
</div>
<div id="program-15.4" class="section level2 hasAnchor">
<h2>Program 15.4<a href="outcome-regression-and-propensity-scores.html#program-15.4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Standardization using the propensity score</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="outcome-regression-and-propensity-scores.html#cb35-1" tabindex="-1"></a><span class="co">#install.packages(&quot;boot&quot;) # install package if required</span></span>
<span id="cb35-2"><a href="outcome-regression-and-propensity-scores.html#cb35-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;boot&quot;</span>)</span>
<span id="cb35-3"><a href="outcome-regression-and-propensity-scores.html#cb35-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-4"><a href="outcome-regression-and-propensity-scores.html#cb35-4" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;boot&#39;</span></span>
<span id="cb35-5"><a href="outcome-regression-and-propensity-scores.html#cb35-5" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:psych&#39;:</span></span>
<span id="cb35-6"><a href="outcome-regression-and-propensity-scores.html#cb35-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-7"><a href="outcome-regression-and-propensity-scores.html#cb35-7" tabindex="-1"></a><span class="co">#&gt;     logit</span></span>
<span id="cb35-8"><a href="outcome-regression-and-propensity-scores.html#cb35-8" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:survival&#39;:</span></span>
<span id="cb35-9"><a href="outcome-regression-and-propensity-scores.html#cb35-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-10"><a href="outcome-regression-and-propensity-scores.html#cb35-10" tabindex="-1"></a><span class="co">#&gt;     aml</span></span>
<span id="cb35-11"><a href="outcome-regression-and-propensity-scores.html#cb35-11" tabindex="-1"></a></span>
<span id="cb35-12"><a href="outcome-regression-and-propensity-scores.html#cb35-12" tabindex="-1"></a><span class="co"># standardization by propensity score, agnostic regarding effect modification</span></span>
<span id="cb35-13"><a href="outcome-regression-and-propensity-scores.html#cb35-13" tabindex="-1"></a>std.ps <span class="ot">&lt;-</span> <span class="cf">function</span>(data, indices) {</span>
<span id="cb35-14"><a href="outcome-regression-and-propensity-scores.html#cb35-14" tabindex="-1"></a>  d <span class="ot">&lt;-</span> data[indices,] <span class="co"># 1st copy: equal to original one`</span></span>
<span id="cb35-15"><a href="outcome-regression-and-propensity-scores.html#cb35-15" tabindex="-1"></a>  <span class="co"># calculating propensity scores</span></span>
<span id="cb35-16"><a href="outcome-regression-and-propensity-scores.html#cb35-16" tabindex="-1"></a>  ps.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">*</span>age)</span>
<span id="cb35-17"><a href="outcome-regression-and-propensity-scores.html#cb35-17" tabindex="-1"></a>                <span class="sc">+</span> <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity</span>
<span id="cb35-18"><a href="outcome-regression-and-propensity-scores.html#cb35-18" tabindex="-1"></a>                <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">*</span>smokeintensity) <span class="sc">+</span> smokeyrs</span>
<span id="cb35-19"><a href="outcome-regression-and-propensity-scores.html#cb35-19" tabindex="-1"></a>                <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">*</span>smokeyrs) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise)</span>
<span id="cb35-20"><a href="outcome-regression-and-propensity-scores.html#cb35-20" tabindex="-1"></a>                <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">*</span>wt71),</span>
<span id="cb35-21"><a href="outcome-regression-and-propensity-scores.html#cb35-21" tabindex="-1"></a>                <span class="at">data=</span>d, <span class="at">family=</span><span class="fu">binomial</span>())</span>
<span id="cb35-22"><a href="outcome-regression-and-propensity-scores.html#cb35-22" tabindex="-1"></a>  d<span class="sc">$</span>pscore <span class="ot">&lt;-</span> <span class="fu">predict</span>(ps.fit, d, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb35-23"><a href="outcome-regression-and-propensity-scores.html#cb35-23" tabindex="-1"></a></span>
<span id="cb35-24"><a href="outcome-regression-and-propensity-scores.html#cb35-24" tabindex="-1"></a>  <span class="co"># create a dataset with 3 copies of each subject</span></span>
<span id="cb35-25"><a href="outcome-regression-and-propensity-scores.html#cb35-25" tabindex="-1"></a>  d<span class="sc">$</span>interv <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="co"># 1st copy: equal to original one`</span></span>
<span id="cb35-26"><a href="outcome-regression-and-propensity-scores.html#cb35-26" tabindex="-1"></a>  d0 <span class="ot">&lt;-</span> d <span class="co"># 2nd copy: treatment set to 0, outcome to missing</span></span>
<span id="cb35-27"><a href="outcome-regression-and-propensity-scores.html#cb35-27" tabindex="-1"></a>  d0<span class="sc">$</span>interv <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-28"><a href="outcome-regression-and-propensity-scores.html#cb35-28" tabindex="-1"></a>  d0<span class="sc">$</span>qsmk <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-29"><a href="outcome-regression-and-propensity-scores.html#cb35-29" tabindex="-1"></a>  d0<span class="sc">$</span>wt82_71 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb35-30"><a href="outcome-regression-and-propensity-scores.html#cb35-30" tabindex="-1"></a>  d1 <span class="ot">&lt;-</span> d <span class="co"># 3rd copy: treatment set to 1, outcome to missing</span></span>
<span id="cb35-31"><a href="outcome-regression-and-propensity-scores.html#cb35-31" tabindex="-1"></a>  d1<span class="sc">$</span>interv <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb35-32"><a href="outcome-regression-and-propensity-scores.html#cb35-32" tabindex="-1"></a>  d1<span class="sc">$</span>qsmk <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb35-33"><a href="outcome-regression-and-propensity-scores.html#cb35-33" tabindex="-1"></a>  d1<span class="sc">$</span>wt82_71 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb35-34"><a href="outcome-regression-and-propensity-scores.html#cb35-34" tabindex="-1"></a>  d.onesample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d, d0, d1) <span class="co"># combining datasets</span></span>
<span id="cb35-35"><a href="outcome-regression-and-propensity-scores.html#cb35-35" tabindex="-1"></a></span>
<span id="cb35-36"><a href="outcome-regression-and-propensity-scores.html#cb35-36" tabindex="-1"></a>  std.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> pscore <span class="sc">+</span> <span class="fu">I</span>(qsmk<span class="sc">*</span>pscore), <span class="at">data=</span>d.onesample)</span>
<span id="cb35-37"><a href="outcome-regression-and-propensity-scores.html#cb35-37" tabindex="-1"></a>  d.onesample<span class="sc">$</span>predicted_meanY <span class="ot">&lt;-</span> <span class="fu">predict</span>(std.fit, d.onesample)</span>
<span id="cb35-38"><a href="outcome-regression-and-propensity-scores.html#cb35-38" tabindex="-1"></a></span>
<span id="cb35-39"><a href="outcome-regression-and-propensity-scores.html#cb35-39" tabindex="-1"></a>  <span class="co"># estimate mean outcome in each of the groups interv=-1, interv=0, and interv=1</span></span>
<span id="cb35-40"><a href="outcome-regression-and-propensity-scores.html#cb35-40" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==-</span><span class="dv">1</span>]),</span>
<span id="cb35-41"><a href="outcome-regression-and-propensity-scores.html#cb35-41" tabindex="-1"></a>           <span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==</span><span class="dv">0</span>]),</span>
<span id="cb35-42"><a href="outcome-regression-and-propensity-scores.html#cb35-42" tabindex="-1"></a>           <span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==</span><span class="dv">1</span>]),</span>
<span id="cb35-43"><a href="outcome-regression-and-propensity-scores.html#cb35-43" tabindex="-1"></a>           <span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==</span><span class="dv">1</span>])<span class="sc">-</span></span>
<span id="cb35-44"><a href="outcome-regression-and-propensity-scores.html#cb35-44" tabindex="-1"></a>             <span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==</span><span class="dv">0</span>])))</span>
<span id="cb35-45"><a href="outcome-regression-and-propensity-scores.html#cb35-45" tabindex="-1"></a>}</span>
<span id="cb35-46"><a href="outcome-regression-and-propensity-scores.html#cb35-46" tabindex="-1"></a></span>
<span id="cb35-47"><a href="outcome-regression-and-propensity-scores.html#cb35-47" tabindex="-1"></a><span class="co"># bootstrap</span></span>
<span id="cb35-48"><a href="outcome-regression-and-propensity-scores.html#cb35-48" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data=</span>nhefs, <span class="at">statistic=</span>std.ps, <span class="at">R=</span><span class="dv">5</span>)</span>
<span id="cb35-49"><a href="outcome-regression-and-propensity-scores.html#cb35-49" tabindex="-1"></a></span>
<span id="cb35-50"><a href="outcome-regression-and-propensity-scores.html#cb35-50" tabindex="-1"></a><span class="co"># generating confidence intervals</span></span>
<span id="cb35-51"><a href="outcome-regression-and-propensity-scores.html#cb35-51" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sd</span>(results<span class="sc">$</span>t[,<span class="dv">1</span>]), <span class="fu">sd</span>(results<span class="sc">$</span>t[,<span class="dv">2</span>]),</span>
<span id="cb35-52"><a href="outcome-regression-and-propensity-scores.html#cb35-52" tabindex="-1"></a>        <span class="fu">sd</span>(results<span class="sc">$</span>t[,<span class="dv">3</span>]), <span class="fu">sd</span>(results<span class="sc">$</span>t[,<span class="dv">4</span>]))</span>
<span id="cb35-53"><a href="outcome-regression-and-propensity-scores.html#cb35-53" tabindex="-1"></a>mean <span class="ot">&lt;-</span> results<span class="sc">$</span>t0</span>
<span id="cb35-54"><a href="outcome-regression-and-propensity-scores.html#cb35-54" tabindex="-1"></a>ll <span class="ot">&lt;-</span> mean <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>se</span>
<span id="cb35-55"><a href="outcome-regression-and-propensity-scores.html#cb35-55" tabindex="-1"></a>ul <span class="ot">&lt;-</span> mean <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>se</span>
<span id="cb35-56"><a href="outcome-regression-and-propensity-scores.html#cb35-56" tabindex="-1"></a></span>
<span id="cb35-57"><a href="outcome-regression-and-propensity-scores.html#cb35-57" tabindex="-1"></a>bootstrap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="st">&quot;Observed&quot;</span>, <span class="st">&quot;No Treatment&quot;</span>, <span class="st">&quot;Treatment&quot;</span>,</span>
<span id="cb35-58"><a href="outcome-regression-and-propensity-scores.html#cb35-58" tabindex="-1"></a>                                <span class="st">&quot;Treatment - No Treatment&quot;</span>), mean, se, ll, ul))</span>
<span id="cb35-59"><a href="outcome-regression-and-propensity-scores.html#cb35-59" tabindex="-1"></a>bootstrap</span>
<span id="cb35-60"><a href="outcome-regression-and-propensity-scores.html#cb35-60" tabindex="-1"></a><span class="co">#&gt;                         V1             mean                se               ll</span></span>
<span id="cb35-61"><a href="outcome-regression-and-propensity-scores.html#cb35-61" tabindex="-1"></a><span class="co">#&gt; 1                 Observed 2.63384609228479 0.160413597724036 2.31944121811519</span></span>
<span id="cb35-62"><a href="outcome-regression-and-propensity-scores.html#cb35-62" tabindex="-1"></a><span class="co">#&gt; 2             No Treatment 1.71983636149845 0.156131097659067 1.41382503321998</span></span>
<span id="cb35-63"><a href="outcome-regression-and-propensity-scores.html#cb35-63" tabindex="-1"></a><span class="co">#&gt; 3                Treatment 5.35072300362985 0.351330298191103 4.66212827249757</span></span>
<span id="cb35-64"><a href="outcome-regression-and-propensity-scores.html#cb35-64" tabindex="-1"></a><span class="co">#&gt; 4 Treatment - No Treatment  3.6308866421314 0.479109440149842 2.69184939478456</span></span>
<span id="cb35-65"><a href="outcome-regression-and-propensity-scores.html#cb35-65" tabindex="-1"></a><span class="co">#&gt;                 ul</span></span>
<span id="cb35-66"><a href="outcome-regression-and-propensity-scores.html#cb35-66" tabindex="-1"></a><span class="co">#&gt; 1  2.9482509664544</span></span>
<span id="cb35-67"><a href="outcome-regression-and-propensity-scores.html#cb35-67" tabindex="-1"></a><span class="co">#&gt; 2 2.02584768977693</span></span>
<span id="cb35-68"><a href="outcome-regression-and-propensity-scores.html#cb35-68" tabindex="-1"></a><span class="co">#&gt; 3 6.03931773476213</span></span>
<span id="cb35-69"><a href="outcome-regression-and-propensity-scores.html#cb35-69" tabindex="-1"></a><span class="co">#&gt; 4 4.56992388947824</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="outcome-regression-and-propensity-scores.html#cb36-1" tabindex="-1"></a><span class="co"># regression on the propensity score (linear term)</span></span>
<span id="cb36-2"><a href="outcome-regression-and-propensity-scores.html#cb36-2" tabindex="-1"></a>model6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> ps, <span class="at">data =</span> nhefs) <span class="co"># p.qsmk</span></span>
<span id="cb36-3"><a href="outcome-regression-and-propensity-scores.html#cb36-3" tabindex="-1"></a><span class="fu">summary</span>(model6)</span>
<span id="cb36-4"><a href="outcome-regression-and-propensity-scores.html#cb36-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-5"><a href="outcome-regression-and-propensity-scores.html#cb36-5" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb36-6"><a href="outcome-regression-and-propensity-scores.html#cb36-6" tabindex="-1"></a><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + ps, data = nhefs)</span></span>
<span id="cb36-7"><a href="outcome-regression-and-propensity-scores.html#cb36-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-8"><a href="outcome-regression-and-propensity-scores.html#cb36-8" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb36-9"><a href="outcome-regression-and-propensity-scores.html#cb36-9" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb36-10"><a href="outcome-regression-and-propensity-scores.html#cb36-10" tabindex="-1"></a><span class="co">#&gt; (Intercept)   5.5945     0.4831  11.581  &lt; 2e-16 ***</span></span>
<span id="cb36-11"><a href="outcome-regression-and-propensity-scores.html#cb36-11" tabindex="-1"></a><span class="co">#&gt; qsmk          3.5506     0.4573   7.765 1.47e-14 ***</span></span>
<span id="cb36-12"><a href="outcome-regression-and-propensity-scores.html#cb36-12" tabindex="-1"></a><span class="co">#&gt; ps          -14.8218     1.7576  -8.433  &lt; 2e-16 ***</span></span>
<span id="cb36-13"><a href="outcome-regression-and-propensity-scores.html#cb36-13" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb36-14"><a href="outcome-regression-and-propensity-scores.html#cb36-14" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb36-15"><a href="outcome-regression-and-propensity-scores.html#cb36-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-16"><a href="outcome-regression-and-propensity-scores.html#cb36-16" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 58.28455)</span></span>
<span id="cb36-17"><a href="outcome-regression-and-propensity-scores.html#cb36-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-18"><a href="outcome-regression-and-propensity-scores.html#cb36-18" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span id="cb36-19"><a href="outcome-regression-and-propensity-scores.html#cb36-19" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 91099  on 1563  degrees of freedom</span></span>
<span id="cb36-20"><a href="outcome-regression-and-propensity-scores.html#cb36-20" tabindex="-1"></a><span class="co">#&gt;   (63 observations deleted due to missingness)</span></span>
<span id="cb36-21"><a href="outcome-regression-and-propensity-scores.html#cb36-21" tabindex="-1"></a><span class="co">#&gt; AIC: 10815</span></span>
<span id="cb36-22"><a href="outcome-regression-and-propensity-scores.html#cb36-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb36-23"><a href="outcome-regression-and-propensity-scores.html#cb36-23" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span>
<span id="cb36-24"><a href="outcome-regression-and-propensity-scores.html#cb36-24" tabindex="-1"></a></span>
<span id="cb36-25"><a href="outcome-regression-and-propensity-scores.html#cb36-25" tabindex="-1"></a><span class="co"># standarization on the propensity score</span></span>
<span id="cb36-26"><a href="outcome-regression-and-propensity-scores.html#cb36-26" tabindex="-1"></a><span class="co"># (step 1) create two new datasets, one with all treated and one with all untreated</span></span>
<span id="cb36-27"><a href="outcome-regression-and-propensity-scores.html#cb36-27" tabindex="-1"></a>treated <span class="ot">&lt;-</span> nhefs</span>
<span id="cb36-28"><a href="outcome-regression-and-propensity-scores.html#cb36-28" tabindex="-1"></a>  treated<span class="sc">$</span>qsmk <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb36-29"><a href="outcome-regression-and-propensity-scores.html#cb36-29" tabindex="-1"></a></span>
<span id="cb36-30"><a href="outcome-regression-and-propensity-scores.html#cb36-30" tabindex="-1"></a>untreated <span class="ot">&lt;-</span> nhefs</span>
<span id="cb36-31"><a href="outcome-regression-and-propensity-scores.html#cb36-31" tabindex="-1"></a>  untreated<span class="sc">$</span>qsmk <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-32"><a href="outcome-regression-and-propensity-scores.html#cb36-32" tabindex="-1"></a></span>
<span id="cb36-33"><a href="outcome-regression-and-propensity-scores.html#cb36-33" tabindex="-1"></a><span class="co"># (step 2) predict values for everyone in each new dataset based on above model</span></span>
<span id="cb36-34"><a href="outcome-regression-and-propensity-scores.html#cb36-34" tabindex="-1"></a>treated<span class="sc">$</span>pred.y <span class="ot">&lt;-</span> <span class="fu">predict</span>(model6, treated)</span>
<span id="cb36-35"><a href="outcome-regression-and-propensity-scores.html#cb36-35" tabindex="-1"></a>untreated<span class="sc">$</span>pred.y <span class="ot">&lt;-</span> <span class="fu">predict</span>(model6, untreated)</span>
<span id="cb36-36"><a href="outcome-regression-and-propensity-scores.html#cb36-36" tabindex="-1"></a></span>
<span id="cb36-37"><a href="outcome-regression-and-propensity-scores.html#cb36-37" tabindex="-1"></a><span class="co"># (step 3) compare mean weight loss had all been treated vs. that had all been untreated</span></span>
<span id="cb36-38"><a href="outcome-regression-and-propensity-scores.html#cb36-38" tabindex="-1"></a>mean1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(treated<span class="sc">$</span>pred.y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-39"><a href="outcome-regression-and-propensity-scores.html#cb36-39" tabindex="-1"></a>mean0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(untreated<span class="sc">$</span>pred.y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-40"><a href="outcome-regression-and-propensity-scores.html#cb36-40" tabindex="-1"></a>mean1</span>
<span id="cb36-41"><a href="outcome-regression-and-propensity-scores.html#cb36-41" tabindex="-1"></a><span class="co">#&gt; [1] 5.250824</span></span>
<span id="cb36-42"><a href="outcome-regression-and-propensity-scores.html#cb36-42" tabindex="-1"></a>mean0</span>
<span id="cb36-43"><a href="outcome-regression-and-propensity-scores.html#cb36-43" tabindex="-1"></a><span class="co">#&gt; [1] 1.700228</span></span>
<span id="cb36-44"><a href="outcome-regression-and-propensity-scores.html#cb36-44" tabindex="-1"></a>mean1 <span class="sc">-</span> mean0</span>
<span id="cb36-45"><a href="outcome-regression-and-propensity-scores.html#cb36-45" tabindex="-1"></a><span class="co">#&gt; [1] 3.550596</span></span>
<span id="cb36-46"><a href="outcome-regression-and-propensity-scores.html#cb36-46" tabindex="-1"></a></span>
<span id="cb36-47"><a href="outcome-regression-and-propensity-scores.html#cb36-47" tabindex="-1"></a><span class="co"># (step 4) bootstrap a confidence interval</span></span>
<span id="cb36-48"><a href="outcome-regression-and-propensity-scores.html#cb36-48" tabindex="-1"></a><span class="co"># number of bootstraps</span></span>
<span id="cb36-49"><a href="outcome-regression-and-propensity-scores.html#cb36-49" tabindex="-1"></a>nboot <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb36-50"><a href="outcome-regression-and-propensity-scores.html#cb36-50" tabindex="-1"></a><span class="co"># set up a matrix to store results</span></span>
<span id="cb36-51"><a href="outcome-regression-and-propensity-scores.html#cb36-51" tabindex="-1"></a>boots <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>nboot,</span>
<span id="cb36-52"><a href="outcome-regression-and-propensity-scores.html#cb36-52" tabindex="-1"></a>                    <span class="at">mean1 =</span> <span class="cn">NA</span>,</span>
<span id="cb36-53"><a href="outcome-regression-and-propensity-scores.html#cb36-53" tabindex="-1"></a>                    <span class="at">mean0 =</span> <span class="cn">NA</span>,</span>
<span id="cb36-54"><a href="outcome-regression-and-propensity-scores.html#cb36-54" tabindex="-1"></a>                    <span class="at">difference =</span> <span class="cn">NA</span>)</span>
<span id="cb36-55"><a href="outcome-regression-and-propensity-scores.html#cb36-55" tabindex="-1"></a><span class="co"># loop to perform the bootstrapping</span></span>
<span id="cb36-56"><a href="outcome-regression-and-propensity-scores.html#cb36-56" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhefs, <span class="sc">!</span><span class="fu">is.na</span>(ps) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wt82_71)) <span class="co"># p.qsmk</span></span>
<span id="cb36-57"><a href="outcome-regression-and-propensity-scores.html#cb36-57" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nboot) {</span>
<span id="cb36-58"><a href="outcome-regression-and-propensity-scores.html#cb36-58" tabindex="-1"></a>  <span class="co"># sample with replacement</span></span>
<span id="cb36-59"><a href="outcome-regression-and-propensity-scores.html#cb36-59" tabindex="-1"></a>  sampl <span class="ot">&lt;-</span> nhefs[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(nhefs), <span class="fu">nrow</span>(nhefs), <span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb36-60"><a href="outcome-regression-and-propensity-scores.html#cb36-60" tabindex="-1"></a></span>
<span id="cb36-61"><a href="outcome-regression-and-propensity-scores.html#cb36-61" tabindex="-1"></a>  <span class="co"># fit the model in the bootstrap sample</span></span>
<span id="cb36-62"><a href="outcome-regression-and-propensity-scores.html#cb36-62" tabindex="-1"></a>  bootmod <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> ps, <span class="at">data =</span> sampl) <span class="co"># ps</span></span>
<span id="cb36-63"><a href="outcome-regression-and-propensity-scores.html#cb36-63" tabindex="-1"></a></span>
<span id="cb36-64"><a href="outcome-regression-and-propensity-scores.html#cb36-64" tabindex="-1"></a>  <span class="co"># create new datasets</span></span>
<span id="cb36-65"><a href="outcome-regression-and-propensity-scores.html#cb36-65" tabindex="-1"></a>  sampl.treated <span class="ot">&lt;-</span> sampl <span class="sc">%&gt;%</span></span>
<span id="cb36-66"><a href="outcome-regression-and-propensity-scores.html#cb36-66" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">qsmk =</span> <span class="dv">1</span>)</span>
<span id="cb36-67"><a href="outcome-regression-and-propensity-scores.html#cb36-67" tabindex="-1"></a></span>
<span id="cb36-68"><a href="outcome-regression-and-propensity-scores.html#cb36-68" tabindex="-1"></a>  sampl.untreated <span class="ot">&lt;-</span> sampl <span class="sc">%&gt;%</span></span>
<span id="cb36-69"><a href="outcome-regression-and-propensity-scores.html#cb36-69" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">qsmk =</span> <span class="dv">0</span>)</span>
<span id="cb36-70"><a href="outcome-regression-and-propensity-scores.html#cb36-70" tabindex="-1"></a></span>
<span id="cb36-71"><a href="outcome-regression-and-propensity-scores.html#cb36-71" tabindex="-1"></a>  <span class="co"># predict values</span></span>
<span id="cb36-72"><a href="outcome-regression-and-propensity-scores.html#cb36-72" tabindex="-1"></a>  sampl.treated<span class="sc">$</span>pred.y <span class="ot">&lt;-</span> <span class="fu">predict</span>(bootmod, sampl.treated)</span>
<span id="cb36-73"><a href="outcome-regression-and-propensity-scores.html#cb36-73" tabindex="-1"></a>  sampl.untreated<span class="sc">$</span>pred.y <span class="ot">&lt;-</span> <span class="fu">predict</span>(bootmod, sampl.untreated)</span>
<span id="cb36-74"><a href="outcome-regression-and-propensity-scores.html#cb36-74" tabindex="-1"></a></span>
<span id="cb36-75"><a href="outcome-regression-and-propensity-scores.html#cb36-75" tabindex="-1"></a>  <span class="co"># output results</span></span>
<span id="cb36-76"><a href="outcome-regression-and-propensity-scores.html#cb36-76" tabindex="-1"></a>  boots[i, <span class="st">&#39;mean1&#39;</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(sampl.treated<span class="sc">$</span>pred.y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-77"><a href="outcome-regression-and-propensity-scores.html#cb36-77" tabindex="-1"></a>  boots[i, <span class="st">&#39;mean0&#39;</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(sampl.untreated<span class="sc">$</span>pred.y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-78"><a href="outcome-regression-and-propensity-scores.html#cb36-78" tabindex="-1"></a>  boots[i, <span class="st">&#39;difference&#39;</span>] <span class="ot">&lt;-</span> boots[i, <span class="st">&#39;mean1&#39;</span>] <span class="sc">-</span> boots[i, <span class="st">&#39;mean0&#39;</span>]</span>
<span id="cb36-79"><a href="outcome-regression-and-propensity-scores.html#cb36-79" tabindex="-1"></a></span>
<span id="cb36-80"><a href="outcome-regression-and-propensity-scores.html#cb36-80" tabindex="-1"></a>  <span class="co"># once loop is done, print the results</span></span>
<span id="cb36-81"><a href="outcome-regression-and-propensity-scores.html#cb36-81" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> nboot) {</span>
<span id="cb36-82"><a href="outcome-regression-and-propensity-scores.html#cb36-82" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&#39;95% CI for the causal mean difference</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb36-83"><a href="outcome-regression-and-propensity-scores.html#cb36-83" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">mean</span>(boots<span class="sc">$</span>difference) <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sd</span>(boots<span class="sc">$</span>difference),</span>
<span id="cb36-84"><a href="outcome-regression-and-propensity-scores.html#cb36-84" tabindex="-1"></a>        <span class="st">&#39;,&#39;</span>,</span>
<span id="cb36-85"><a href="outcome-regression-and-propensity-scores.html#cb36-85" tabindex="-1"></a>        <span class="fu">mean</span>(boots<span class="sc">$</span>difference) <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sd</span>(boots<span class="sc">$</span>difference))</span>
<span id="cb36-86"><a href="outcome-regression-and-propensity-scores.html#cb36-86" tabindex="-1"></a>  }</span>
<span id="cb36-87"><a href="outcome-regression-and-propensity-scores.html#cb36-87" tabindex="-1"></a>}</span>
<span id="cb36-88"><a href="outcome-regression-and-propensity-scores.html#cb36-88" tabindex="-1"></a><span class="co">#&gt; 95% CI for the causal mean difference</span></span>
<span id="cb36-89"><a href="outcome-regression-and-propensity-scores.html#cb36-89" tabindex="-1"></a><span class="co">#&gt; 2.697218 , 4.382939</span></span></code></pre></div>
<p>A more flexible and elegant way to do this is to write a function to perform the model fitting, prediction, bootstrapping, and reporting all at once.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="g-estimation-of-structural-nested-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="instrumental-variables-estimation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/remlapmot/cibookex-r/edit/master/15-prop-scores-r.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/remlapmot/cibookex-r/blob/master/15-prop-scores-r.Rmd",
"text": null
},
"download": ["cibookex-r.pdf", "cibookex-r.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
