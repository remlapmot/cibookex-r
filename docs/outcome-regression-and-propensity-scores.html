<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>15. Outcome regression and propensity scores | Causal Inference: What If. R and Stata code for Exercises</title>
  <meta name="description" content="Code examples from Causal Inference: What If by M. A. Hernán and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="15. Outcome regression and propensity scores | Causal Inference: What If. R and Stata code for Exercises" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Code examples from Causal Inference: What If by M. A. Hernán and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="15. Outcome regression and propensity scores | Causal Inference: What If. R and Stata code for Exercises" />
  
  <meta name="twitter:description" content="Code examples from Causal Inference: What If by M. A. Hernán and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

<meta name="author" content="Book by M. A. Hernán and J. M. Robins" />
<meta name="author" content="R code by Joy Shi and Sean McGrath" />
<meta name="author" content="Stata code by Eleanor Murray and Roger Logan" />
<meta name="author" content="R Markdown code by Tom Palmer" />


<meta name="date" content="2024-06-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="g-estimation-of-structural-nested-models.html"/>
<link rel="next" href="instrumental-variables-estimation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Table of Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#downloading-the-code"><i class="fa fa-check"></i>Downloading the code</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#installing-dependency-packages"><i class="fa fa-check"></i>Installing dependency packages</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#downloading-the-datasets"><i class="fa fa-check"></i>Downloading the datasets</a></li>
</ul></li>
<li class="part"><span><b>R code</b></span></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html"><i class="fa fa-check"></i>11. Why model?</a>
<ul>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.2"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.3"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.2"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.3"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.4"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.5"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.6"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.7"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula</a>
<ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.2"><i class="fa fa-check"></i>Program 13.2</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.3"><i class="fa fa-check"></i>Program 13.3</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.4"><i class="fa fa-check"></i>Program 13.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.1"><i class="fa fa-check"></i>Program 14.1</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.2"><i class="fa fa-check"></i>Program 14.2</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-one-possible-value-of-psi"><i class="fa fa-check"></i>G-estimation: Checking one possible value of psi</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-multiple-possible-values-of-psi"><i class="fa fa-check"></i>G-estimation: Checking multiple possible values of psi</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.3"><i class="fa fa-check"></i>Program 14.3</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-linear-mean-models"><i class="fa fa-check"></i>G-estimation: Closed form estimator linear mean models</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-for-2-parameter-model"><i class="fa fa-check"></i>G-estimation: Closed form estimator for 2-parameter model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores</a>
<ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.1"><i class="fa fa-check"></i>Program 15.1</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.2"><i class="fa fa-check"></i>Program 15.2</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.3"><i class="fa fa-check"></i>Program 15.3</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.4"><i class="fa fa-check"></i>Program 15.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html"><i class="fa fa-check"></i>16. Instrumental variables estimation</a>
<ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.1"><i class="fa fa-check"></i>Program 16.1</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.2"><i class="fa fa-check"></i>Program 16.2</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.3"><i class="fa fa-check"></i>Program 16.3</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.4"><i class="fa fa-check"></i>Program 16.4</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.5"><i class="fa fa-check"></i>Program 16.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html"><i class="fa fa-check"></i>17. Causal survival analysis</a>
<ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.1"><i class="fa fa-check"></i>Program 17.1</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.2"><i class="fa fa-check"></i>Program 17.2</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.3"><i class="fa fa-check"></i>Program 17.3</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.4"><i class="fa fa-check"></i>Program 17.4</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.5"><i class="fa fa-check"></i>Program 17.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-information-r.html"><a href="session-information-r.html"><i class="fa fa-check"></i>Session information: R</a></li>
<li class="part"><span><b>Stata code</b></span></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html"><i class="fa fa-check"></i>11. Why model: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.1-1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.2-1"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model-stata.html"><a href="why-model-stata.html#program-11.3-1"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.1-1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.2-1"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.3-1"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.4-1"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.5-1"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.6-1"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-stata.html"><a href="ip-weighting-and-marginal-structural-models-stata.html#program-12.7-1"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.1-1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.2-1"><i class="fa fa-check"></i>Program 13.2</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.3-1"><i class="fa fa-check"></i>Program 13.3</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-stata.html"><a href="standardization-and-the-parametric-g-formula-stata.html#program-13.4-1"><i class="fa fa-check"></i>Program 13.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.1-1"><i class="fa fa-check"></i>Program 14.1</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.2-1"><i class="fa fa-check"></i>Program 14.2</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-stata.html"><a href="g-estimation-of-structural-nested-models-stata.html#program-14.3-1"><i class="fa fa-check"></i>Program 14.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.1-1"><i class="fa fa-check"></i>Program 15.1</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#prorgam-15.2"><i class="fa fa-check"></i>Prorgam 15.2</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.3-1"><i class="fa fa-check"></i>Program 15.3</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-stata.html"><a href="outcome-regression-and-propensity-scores-stata.html#program-15.4-1"><i class="fa fa-check"></i>Program 15.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html"><i class="fa fa-check"></i>16. Instrumental variables estimation: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.1-1"><i class="fa fa-check"></i>Program 16.1</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.2-1"><i class="fa fa-check"></i>Program 16.2</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.3-1"><i class="fa fa-check"></i>Program 16.3</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.4-1"><i class="fa fa-check"></i>Program 16.4</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-stata.html"><a href="instrumental-variables-estimation-stata.html#program-16.5-1"><i class="fa fa-check"></i>Program 16.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html"><i class="fa fa-check"></i>17. Causal survival analysis: Stata</a>
<ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.1-1"><i class="fa fa-check"></i>Program 17.1</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.2-1"><i class="fa fa-check"></i>Program 17.2</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.3-1"><i class="fa fa-check"></i>Program 17.3</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-stata.html"><a href="causal-survival-analysis-stata.html#program-17.4-1"><i class="fa fa-check"></i>Program 17.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="session-information-stata.html"><a href="session-information-stata.html"><i class="fa fa-check"></i>Session information: Stata</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Causal Inference: What If. R and Stata code for Exercises</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="outcome-regression-and-propensity-scores" class="section level1 unnumbered hasAnchor">
<h1>15. Outcome regression and propensity scores<a href="outcome-regression-and-propensity-scores.html#outcome-regression-and-propensity-scores" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="program-15.1" class="section level2 hasAnchor">
<h2>Program 15.1<a href="outcome-regression-and-propensity-scores.html#program-15.1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating the average causal effect within levels of confounders under the assumption of effect-measure modification by smoking intensity ONLY</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="outcome-regression-and-propensity-scores.html#cb111-1" tabindex="-1"></a><span class="fu">library</span>(here)</span></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="outcome-regression-and-propensity-scores.html#cb112-1" tabindex="-1"></a><span class="co">#install.packages(&quot;readxl&quot;) # install package if required</span></span>
<span id="cb112-2"><a href="outcome-regression-and-propensity-scores.html#cb112-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;readxl&quot;</span>)</span>
<span id="cb112-3"><a href="outcome-regression-and-propensity-scores.html#cb112-3" tabindex="-1"></a></span>
<span id="cb112-4"><a href="outcome-regression-and-propensity-scores.html#cb112-4" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;NHEFS.xls&quot;</span>))</span>
<span id="cb112-5"><a href="outcome-regression-and-propensity-scores.html#cb112-5" tabindex="-1"></a>nhefs<span class="sc">$</span>cens <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(nhefs<span class="sc">$</span>wt82), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb112-6"><a href="outcome-regression-and-propensity-scores.html#cb112-6" tabindex="-1"></a></span>
<span id="cb112-7"><a href="outcome-regression-and-propensity-scores.html#cb112-7" tabindex="-1"></a><span class="co"># regression on covariates, allowing for some effect modification</span></span>
<span id="cb112-8"><a href="outcome-regression-and-propensity-scores.html#cb112-8" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">*</span>age) <span class="sc">+</span> <span class="fu">as.factor</span>(education)</span>
<span id="cb112-9"><a href="outcome-regression-and-propensity-scores.html#cb112-9" tabindex="-1"></a>           <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">*</span>smokeintensity) <span class="sc">+</span> smokeyrs</span>
<span id="cb112-10"><a href="outcome-regression-and-propensity-scores.html#cb112-10" tabindex="-1"></a>           <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">*</span>smokeyrs) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active)</span>
<span id="cb112-11"><a href="outcome-regression-and-propensity-scores.html#cb112-11" tabindex="-1"></a>           <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">*</span>wt71) <span class="sc">+</span> <span class="fu">I</span>(qsmk<span class="sc">*</span>smokeintensity), <span class="at">data=</span>nhefs)</span>
<span id="cb112-12"><a href="outcome-regression-and-propensity-scores.html#cb112-12" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb112-13"><a href="outcome-regression-and-propensity-scores.html#cb112-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb112-14"><a href="outcome-regression-and-propensity-scores.html#cb112-14" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb112-15"><a href="outcome-regression-and-propensity-scores.html#cb112-15" tabindex="-1"></a><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age * age) + </span></span>
<span id="cb112-16"><a href="outcome-regression-and-propensity-scores.html#cb112-16" tabindex="-1"></a><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity * </span></span>
<span id="cb112-17"><a href="outcome-regression-and-propensity-scores.html#cb112-17" tabindex="-1"></a><span class="co">#&gt;     smokeintensity) + smokeyrs + I(smokeyrs * smokeyrs) + as.factor(exercise) + </span></span>
<span id="cb112-18"><a href="outcome-regression-and-propensity-scores.html#cb112-18" tabindex="-1"></a><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71 * wt71) + I(qsmk * smokeintensity), </span></span>
<span id="cb112-19"><a href="outcome-regression-and-propensity-scores.html#cb112-19" tabindex="-1"></a><span class="co">#&gt;     data = nhefs)</span></span>
<span id="cb112-20"><a href="outcome-regression-and-propensity-scores.html#cb112-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb112-21"><a href="outcome-regression-and-propensity-scores.html#cb112-21" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb112-22"><a href="outcome-regression-and-propensity-scores.html#cb112-22" tabindex="-1"></a><span class="co">#&gt;                                      Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb112-23"><a href="outcome-regression-and-propensity-scores.html#cb112-23" tabindex="-1"></a><span class="co">#&gt; (Intercept)                        -1.5881657  4.3130359  -0.368 0.712756    </span></span>
<span id="cb112-24"><a href="outcome-regression-and-propensity-scores.html#cb112-24" tabindex="-1"></a><span class="co">#&gt; qsmk                                2.5595941  0.8091486   3.163 0.001590 ** </span></span>
<span id="cb112-25"><a href="outcome-regression-and-propensity-scores.html#cb112-25" tabindex="-1"></a><span class="co">#&gt; sex                                -1.4302717  0.4689576  -3.050 0.002328 ** </span></span>
<span id="cb112-26"><a href="outcome-regression-and-propensity-scores.html#cb112-26" tabindex="-1"></a><span class="co">#&gt; race                                0.5601096  0.5818888   0.963 0.335913    </span></span>
<span id="cb112-27"><a href="outcome-regression-and-propensity-scores.html#cb112-27" tabindex="-1"></a><span class="co">#&gt; age                                 0.3596353  0.1633188   2.202 0.027809 *  </span></span>
<span id="cb112-28"><a href="outcome-regression-and-propensity-scores.html#cb112-28" tabindex="-1"></a><span class="co">#&gt; I(age * age)                       -0.0061010  0.0017261  -3.534 0.000421 ***</span></span>
<span id="cb112-29"><a href="outcome-regression-and-propensity-scores.html#cb112-29" tabindex="-1"></a><span class="co">#&gt; as.factor(education)2               0.7904440  0.6070005   1.302 0.193038    </span></span>
<span id="cb112-30"><a href="outcome-regression-and-propensity-scores.html#cb112-30" tabindex="-1"></a><span class="co">#&gt; as.factor(education)3               0.5563124  0.5561016   1.000 0.317284    </span></span>
<span id="cb112-31"><a href="outcome-regression-and-propensity-scores.html#cb112-31" tabindex="-1"></a><span class="co">#&gt; as.factor(education)4               1.4915695  0.8322704   1.792 0.073301 .  </span></span>
<span id="cb112-32"><a href="outcome-regression-and-propensity-scores.html#cb112-32" tabindex="-1"></a><span class="co">#&gt; as.factor(education)5              -0.1949770  0.7413692  -0.263 0.792589    </span></span>
<span id="cb112-33"><a href="outcome-regression-and-propensity-scores.html#cb112-33" tabindex="-1"></a><span class="co">#&gt; smokeintensity                      0.0491365  0.0517254   0.950 0.342287    </span></span>
<span id="cb112-34"><a href="outcome-regression-and-propensity-scores.html#cb112-34" tabindex="-1"></a><span class="co">#&gt; I(smokeintensity * smokeintensity) -0.0009907  0.0009380  -1.056 0.291097    </span></span>
<span id="cb112-35"><a href="outcome-regression-and-propensity-scores.html#cb112-35" tabindex="-1"></a><span class="co">#&gt; smokeyrs                            0.1343686  0.0917122   1.465 0.143094    </span></span>
<span id="cb112-36"><a href="outcome-regression-and-propensity-scores.html#cb112-36" tabindex="-1"></a><span class="co">#&gt; I(smokeyrs * smokeyrs)             -0.0018664  0.0015437  -1.209 0.226830    </span></span>
<span id="cb112-37"><a href="outcome-regression-and-propensity-scores.html#cb112-37" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)1                0.2959754  0.5351533   0.553 0.580298    </span></span>
<span id="cb112-38"><a href="outcome-regression-and-propensity-scores.html#cb112-38" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)2                0.3539128  0.5588587   0.633 0.526646    </span></span>
<span id="cb112-39"><a href="outcome-regression-and-propensity-scores.html#cb112-39" tabindex="-1"></a><span class="co">#&gt; as.factor(active)1                 -0.9475695  0.4099344  -2.312 0.020935 *  </span></span>
<span id="cb112-40"><a href="outcome-regression-and-propensity-scores.html#cb112-40" tabindex="-1"></a><span class="co">#&gt; as.factor(active)2                 -0.2613779  0.6845577  -0.382 0.702647    </span></span>
<span id="cb112-41"><a href="outcome-regression-and-propensity-scores.html#cb112-41" tabindex="-1"></a><span class="co">#&gt; wt71                                0.0455018  0.0833709   0.546 0.585299    </span></span>
<span id="cb112-42"><a href="outcome-regression-and-propensity-scores.html#cb112-42" tabindex="-1"></a><span class="co">#&gt; I(wt71 * wt71)                     -0.0009653  0.0005247  -1.840 0.066001 .  </span></span>
<span id="cb112-43"><a href="outcome-regression-and-propensity-scores.html#cb112-43" tabindex="-1"></a><span class="co">#&gt; I(qsmk * smokeintensity)            0.0466628  0.0351448   1.328 0.184463    </span></span>
<span id="cb112-44"><a href="outcome-regression-and-propensity-scores.html#cb112-44" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb112-45"><a href="outcome-regression-and-propensity-scores.html#cb112-45" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb112-46"><a href="outcome-regression-and-propensity-scores.html#cb112-46" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb112-47"><a href="outcome-regression-and-propensity-scores.html#cb112-47" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 53.5683)</span></span>
<span id="cb112-48"><a href="outcome-regression-and-propensity-scores.html#cb112-48" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb112-49"><a href="outcome-regression-and-propensity-scores.html#cb112-49" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span id="cb112-50"><a href="outcome-regression-and-propensity-scores.html#cb112-50" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 82763  on 1545  degrees of freedom</span></span>
<span id="cb112-51"><a href="outcome-regression-and-propensity-scores.html#cb112-51" tabindex="-1"></a><span class="co">#&gt;   (63 observations deleted due to missingness)</span></span>
<span id="cb112-52"><a href="outcome-regression-and-propensity-scores.html#cb112-52" tabindex="-1"></a><span class="co">#&gt; AIC: 10701</span></span>
<span id="cb112-53"><a href="outcome-regression-and-propensity-scores.html#cb112-53" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb112-54"><a href="outcome-regression-and-propensity-scores.html#cb112-54" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="outcome-regression-and-propensity-scores.html#cb113-1" tabindex="-1"></a></span>
<span id="cb113-2"><a href="outcome-regression-and-propensity-scores.html#cb113-2" tabindex="-1"></a><span class="co"># (step 1) build the contrast matrix with all zeros</span></span>
<span id="cb113-3"><a href="outcome-regression-and-propensity-scores.html#cb113-3" tabindex="-1"></a><span class="co"># this function builds the blank matrix</span></span>
<span id="cb113-4"><a href="outcome-regression-and-propensity-scores.html#cb113-4" tabindex="-1"></a><span class="co"># install.packages(&quot;multcomp&quot;) # install packages if necessary</span></span>
<span id="cb113-5"><a href="outcome-regression-and-propensity-scores.html#cb113-5" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;multcomp&quot;</span>)</span>
<span id="cb113-6"><a href="outcome-regression-and-propensity-scores.html#cb113-6" tabindex="-1"></a><span class="co">#&gt; Loading required package: mvtnorm</span></span>
<span id="cb113-7"><a href="outcome-regression-and-propensity-scores.html#cb113-7" tabindex="-1"></a><span class="co">#&gt; Loading required package: survival</span></span>
<span id="cb113-8"><a href="outcome-regression-and-propensity-scores.html#cb113-8" tabindex="-1"></a><span class="co">#&gt; Loading required package: TH.data</span></span>
<span id="cb113-9"><a href="outcome-regression-and-propensity-scores.html#cb113-9" tabindex="-1"></a><span class="co">#&gt; Loading required package: MASS</span></span>
<span id="cb113-10"><a href="outcome-regression-and-propensity-scores.html#cb113-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb113-11"><a href="outcome-regression-and-propensity-scores.html#cb113-11" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;TH.data&#39;</span></span>
<span id="cb113-12"><a href="outcome-regression-and-propensity-scores.html#cb113-12" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:MASS&#39;:</span></span>
<span id="cb113-13"><a href="outcome-regression-and-propensity-scores.html#cb113-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb113-14"><a href="outcome-regression-and-propensity-scores.html#cb113-14" tabindex="-1"></a><span class="co">#&gt;     geyser</span></span></code></pre></div>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="outcome-regression-and-propensity-scores.html#cb114-1" tabindex="-1"></a>makeContrastMatrix <span class="ot">&lt;-</span> <span class="cf">function</span>(model, nrow, names) {</span>
<span id="cb114-2"><a href="outcome-regression-and-propensity-scores.html#cb114-2" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nrow, <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">coef</span>(model)))</span>
<span id="cb114-3"><a href="outcome-regression-and-propensity-scores.html#cb114-3" tabindex="-1"></a>  <span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">coef</span>(model))</span>
<span id="cb114-4"><a href="outcome-regression-and-propensity-scores.html#cb114-4" tabindex="-1"></a>  <span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> names</span>
<span id="cb114-5"><a href="outcome-regression-and-propensity-scores.html#cb114-5" tabindex="-1"></a>  <span class="fu">return</span>(m)</span>
<span id="cb114-6"><a href="outcome-regression-and-propensity-scores.html#cb114-6" tabindex="-1"></a>}</span>
<span id="cb114-7"><a href="outcome-regression-and-propensity-scores.html#cb114-7" tabindex="-1"></a>K1 <span class="ot">&lt;-</span></span>
<span id="cb114-8"><a href="outcome-regression-and-propensity-scores.html#cb114-8" tabindex="-1"></a>  <span class="fu">makeContrastMatrix</span>(</span>
<span id="cb114-9"><a href="outcome-regression-and-propensity-scores.html#cb114-9" tabindex="-1"></a>    fit,</span>
<span id="cb114-10"><a href="outcome-regression-and-propensity-scores.html#cb114-10" tabindex="-1"></a>    <span class="dv">2</span>,</span>
<span id="cb114-11"><a href="outcome-regression-and-propensity-scores.html#cb114-11" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb114-12"><a href="outcome-regression-and-propensity-scores.html#cb114-12" tabindex="-1"></a>      <span class="st">&#39;Effect of Quitting Smoking at Smokeintensity of 5&#39;</span>,</span>
<span id="cb114-13"><a href="outcome-regression-and-propensity-scores.html#cb114-13" tabindex="-1"></a>      <span class="st">&#39;Effect of Quitting Smoking at Smokeintensity of 40&#39;</span></span>
<span id="cb114-14"><a href="outcome-regression-and-propensity-scores.html#cb114-14" tabindex="-1"></a>    )</span>
<span id="cb114-15"><a href="outcome-regression-and-propensity-scores.html#cb114-15" tabindex="-1"></a>  )</span>
<span id="cb114-16"><a href="outcome-regression-and-propensity-scores.html#cb114-16" tabindex="-1"></a><span class="co"># (step 2) fill in the relevant non-zero elements</span></span>
<span id="cb114-17"><a href="outcome-regression-and-propensity-scores.html#cb114-17" tabindex="-1"></a>K1[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&#39;qsmk&#39;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb114-18"><a href="outcome-regression-and-propensity-scores.html#cb114-18" tabindex="-1"></a>K1[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&#39;I(qsmk * smokeintensity)&#39;</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">40</span>)</span>
<span id="cb114-19"><a href="outcome-regression-and-propensity-scores.html#cb114-19" tabindex="-1"></a></span>
<span id="cb114-20"><a href="outcome-regression-and-propensity-scores.html#cb114-20" tabindex="-1"></a><span class="co"># (step 3) check the contrast matrix</span></span>
<span id="cb114-21"><a href="outcome-regression-and-propensity-scores.html#cb114-21" tabindex="-1"></a>K1</span>
<span id="cb114-22"><a href="outcome-regression-and-propensity-scores.html#cb114-22" tabindex="-1"></a><span class="co">#&gt;                                                    (Intercept) qsmk sex race</span></span>
<span id="cb114-23"><a href="outcome-regression-and-propensity-scores.html#cb114-23" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5            0    1   0    0</span></span>
<span id="cb114-24"><a href="outcome-regression-and-propensity-scores.html#cb114-24" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40           0    1   0    0</span></span>
<span id="cb114-25"><a href="outcome-regression-and-propensity-scores.html#cb114-25" tabindex="-1"></a><span class="co">#&gt;                                                    age I(age * age)</span></span>
<span id="cb114-26"><a href="outcome-regression-and-propensity-scores.html#cb114-26" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5    0            0</span></span>
<span id="cb114-27"><a href="outcome-regression-and-propensity-scores.html#cb114-27" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40   0            0</span></span>
<span id="cb114-28"><a href="outcome-regression-and-propensity-scores.html#cb114-28" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(education)2</span></span>
<span id="cb114-29"><a href="outcome-regression-and-propensity-scores.html#cb114-29" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                      0</span></span>
<span id="cb114-30"><a href="outcome-regression-and-propensity-scores.html#cb114-30" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                     0</span></span>
<span id="cb114-31"><a href="outcome-regression-and-propensity-scores.html#cb114-31" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(education)3</span></span>
<span id="cb114-32"><a href="outcome-regression-and-propensity-scores.html#cb114-32" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                      0</span></span>
<span id="cb114-33"><a href="outcome-regression-and-propensity-scores.html#cb114-33" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                     0</span></span>
<span id="cb114-34"><a href="outcome-regression-and-propensity-scores.html#cb114-34" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(education)4</span></span>
<span id="cb114-35"><a href="outcome-regression-and-propensity-scores.html#cb114-35" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                      0</span></span>
<span id="cb114-36"><a href="outcome-regression-and-propensity-scores.html#cb114-36" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                     0</span></span>
<span id="cb114-37"><a href="outcome-regression-and-propensity-scores.html#cb114-37" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(education)5</span></span>
<span id="cb114-38"><a href="outcome-regression-and-propensity-scores.html#cb114-38" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                      0</span></span>
<span id="cb114-39"><a href="outcome-regression-and-propensity-scores.html#cb114-39" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                     0</span></span>
<span id="cb114-40"><a href="outcome-regression-and-propensity-scores.html#cb114-40" tabindex="-1"></a><span class="co">#&gt;                                                    smokeintensity</span></span>
<span id="cb114-41"><a href="outcome-regression-and-propensity-scores.html#cb114-41" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5               0</span></span>
<span id="cb114-42"><a href="outcome-regression-and-propensity-scores.html#cb114-42" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40              0</span></span>
<span id="cb114-43"><a href="outcome-regression-and-propensity-scores.html#cb114-43" tabindex="-1"></a><span class="co">#&gt;                                                    I(smokeintensity * smokeintensity)</span></span>
<span id="cb114-44"><a href="outcome-regression-and-propensity-scores.html#cb114-44" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                                   0</span></span>
<span id="cb114-45"><a href="outcome-regression-and-propensity-scores.html#cb114-45" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                                  0</span></span>
<span id="cb114-46"><a href="outcome-regression-and-propensity-scores.html#cb114-46" tabindex="-1"></a><span class="co">#&gt;                                                    smokeyrs</span></span>
<span id="cb114-47"><a href="outcome-regression-and-propensity-scores.html#cb114-47" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5         0</span></span>
<span id="cb114-48"><a href="outcome-regression-and-propensity-scores.html#cb114-48" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40        0</span></span>
<span id="cb114-49"><a href="outcome-regression-and-propensity-scores.html#cb114-49" tabindex="-1"></a><span class="co">#&gt;                                                    I(smokeyrs * smokeyrs)</span></span>
<span id="cb114-50"><a href="outcome-regression-and-propensity-scores.html#cb114-50" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                       0</span></span>
<span id="cb114-51"><a href="outcome-regression-and-propensity-scores.html#cb114-51" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                      0</span></span>
<span id="cb114-52"><a href="outcome-regression-and-propensity-scores.html#cb114-52" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(exercise)1</span></span>
<span id="cb114-53"><a href="outcome-regression-and-propensity-scores.html#cb114-53" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                     0</span></span>
<span id="cb114-54"><a href="outcome-regression-and-propensity-scores.html#cb114-54" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                    0</span></span>
<span id="cb114-55"><a href="outcome-regression-and-propensity-scores.html#cb114-55" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(exercise)2</span></span>
<span id="cb114-56"><a href="outcome-regression-and-propensity-scores.html#cb114-56" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                     0</span></span>
<span id="cb114-57"><a href="outcome-regression-and-propensity-scores.html#cb114-57" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                    0</span></span>
<span id="cb114-58"><a href="outcome-regression-and-propensity-scores.html#cb114-58" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(active)1</span></span>
<span id="cb114-59"><a href="outcome-regression-and-propensity-scores.html#cb114-59" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                   0</span></span>
<span id="cb114-60"><a href="outcome-regression-and-propensity-scores.html#cb114-60" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                  0</span></span>
<span id="cb114-61"><a href="outcome-regression-and-propensity-scores.html#cb114-61" tabindex="-1"></a><span class="co">#&gt;                                                    as.factor(active)2 wt71</span></span>
<span id="cb114-62"><a href="outcome-regression-and-propensity-scores.html#cb114-62" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                   0    0</span></span>
<span id="cb114-63"><a href="outcome-regression-and-propensity-scores.html#cb114-63" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                  0    0</span></span>
<span id="cb114-64"><a href="outcome-regression-and-propensity-scores.html#cb114-64" tabindex="-1"></a><span class="co">#&gt;                                                    I(wt71 * wt71)</span></span>
<span id="cb114-65"><a href="outcome-regression-and-propensity-scores.html#cb114-65" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5               0</span></span>
<span id="cb114-66"><a href="outcome-regression-and-propensity-scores.html#cb114-66" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40              0</span></span>
<span id="cb114-67"><a href="outcome-regression-and-propensity-scores.html#cb114-67" tabindex="-1"></a><span class="co">#&gt;                                                    I(qsmk * smokeintensity)</span></span>
<span id="cb114-68"><a href="outcome-regression-and-propensity-scores.html#cb114-68" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5                         5</span></span>
<span id="cb114-69"><a href="outcome-regression-and-propensity-scores.html#cb114-69" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40                       40</span></span></code></pre></div>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="outcome-regression-and-propensity-scores.html#cb115-1" tabindex="-1"></a></span>
<span id="cb115-2"><a href="outcome-regression-and-propensity-scores.html#cb115-2" tabindex="-1"></a><span class="co"># (step 4) estimate the contrasts, get tests and confidence intervals for them</span></span>
<span id="cb115-3"><a href="outcome-regression-and-propensity-scores.html#cb115-3" tabindex="-1"></a>estimates1 <span class="ot">&lt;-</span> <span class="fu">glht</span>(fit, K1)</span>
<span id="cb115-4"><a href="outcome-regression-and-propensity-scores.html#cb115-4" tabindex="-1"></a>  <span class="fu">summary</span>(estimates1)</span>
<span id="cb115-5"><a href="outcome-regression-and-propensity-scores.html#cb115-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb115-6"><a href="outcome-regression-and-propensity-scores.html#cb115-6" tabindex="-1"></a><span class="co">#&gt;   Simultaneous Tests for General Linear Hypotheses</span></span>
<span id="cb115-7"><a href="outcome-regression-and-propensity-scores.html#cb115-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb115-8"><a href="outcome-regression-and-propensity-scores.html#cb115-8" tabindex="-1"></a><span class="co">#&gt; Fit: glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age * age) + </span></span>
<span id="cb115-9"><a href="outcome-regression-and-propensity-scores.html#cb115-9" tabindex="-1"></a><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity * </span></span>
<span id="cb115-10"><a href="outcome-regression-and-propensity-scores.html#cb115-10" tabindex="-1"></a><span class="co">#&gt;     smokeintensity) + smokeyrs + I(smokeyrs * smokeyrs) + as.factor(exercise) + </span></span>
<span id="cb115-11"><a href="outcome-regression-and-propensity-scores.html#cb115-11" tabindex="-1"></a><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71 * wt71) + I(qsmk * smokeintensity), </span></span>
<span id="cb115-12"><a href="outcome-regression-and-propensity-scores.html#cb115-12" tabindex="-1"></a><span class="co">#&gt;     data = nhefs)</span></span>
<span id="cb115-13"><a href="outcome-regression-and-propensity-scores.html#cb115-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb115-14"><a href="outcome-regression-and-propensity-scores.html#cb115-14" tabindex="-1"></a><span class="co">#&gt; Linear Hypotheses:</span></span>
<span id="cb115-15"><a href="outcome-regression-and-propensity-scores.html#cb115-15" tabindex="-1"></a><span class="co">#&gt;                                                         Estimate Std. Error</span></span>
<span id="cb115-16"><a href="outcome-regression-and-propensity-scores.html#cb115-16" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5 == 0    2.7929     0.6683</span></span>
<span id="cb115-17"><a href="outcome-regression-and-propensity-scores.html#cb115-17" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40 == 0   4.4261     0.8478</span></span>
<span id="cb115-18"><a href="outcome-regression-and-propensity-scores.html#cb115-18" tabindex="-1"></a><span class="co">#&gt;                                                         z value Pr(&gt;|z|)    </span></span>
<span id="cb115-19"><a href="outcome-regression-and-propensity-scores.html#cb115-19" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5 == 0    4.179 5.84e-05 ***</span></span>
<span id="cb115-20"><a href="outcome-regression-and-propensity-scores.html#cb115-20" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40 == 0   5.221 3.56e-07 ***</span></span>
<span id="cb115-21"><a href="outcome-regression-and-propensity-scores.html#cb115-21" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb115-22"><a href="outcome-regression-and-propensity-scores.html#cb115-22" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb115-23"><a href="outcome-regression-and-propensity-scores.html#cb115-23" tabindex="-1"></a><span class="co">#&gt; (Adjusted p values reported -- single-step method)</span></span></code></pre></div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="outcome-regression-and-propensity-scores.html#cb116-1" tabindex="-1"></a>  <span class="fu">confint</span>(estimates1)</span>
<span id="cb116-2"><a href="outcome-regression-and-propensity-scores.html#cb116-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb116-3"><a href="outcome-regression-and-propensity-scores.html#cb116-3" tabindex="-1"></a><span class="co">#&gt;   Simultaneous Confidence Intervals</span></span>
<span id="cb116-4"><a href="outcome-regression-and-propensity-scores.html#cb116-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb116-5"><a href="outcome-regression-and-propensity-scores.html#cb116-5" tabindex="-1"></a><span class="co">#&gt; Fit: glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age * age) + </span></span>
<span id="cb116-6"><a href="outcome-regression-and-propensity-scores.html#cb116-6" tabindex="-1"></a><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity * </span></span>
<span id="cb116-7"><a href="outcome-regression-and-propensity-scores.html#cb116-7" tabindex="-1"></a><span class="co">#&gt;     smokeintensity) + smokeyrs + I(smokeyrs * smokeyrs) + as.factor(exercise) + </span></span>
<span id="cb116-8"><a href="outcome-regression-and-propensity-scores.html#cb116-8" tabindex="-1"></a><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71 * wt71) + I(qsmk * smokeintensity), </span></span>
<span id="cb116-9"><a href="outcome-regression-and-propensity-scores.html#cb116-9" tabindex="-1"></a><span class="co">#&gt;     data = nhefs)</span></span>
<span id="cb116-10"><a href="outcome-regression-and-propensity-scores.html#cb116-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb116-11"><a href="outcome-regression-and-propensity-scores.html#cb116-11" tabindex="-1"></a><span class="co">#&gt; Quantile = 2.2281</span></span>
<span id="cb116-12"><a href="outcome-regression-and-propensity-scores.html#cb116-12" tabindex="-1"></a><span class="co">#&gt; 95% family-wise confidence level</span></span>
<span id="cb116-13"><a href="outcome-regression-and-propensity-scores.html#cb116-13" tabindex="-1"></a><span class="co">#&gt;  </span></span>
<span id="cb116-14"><a href="outcome-regression-and-propensity-scores.html#cb116-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb116-15"><a href="outcome-regression-and-propensity-scores.html#cb116-15" tabindex="-1"></a><span class="co">#&gt; Linear Hypotheses:</span></span>
<span id="cb116-16"><a href="outcome-regression-and-propensity-scores.html#cb116-16" tabindex="-1"></a><span class="co">#&gt;                                                         Estimate lwr    upr   </span></span>
<span id="cb116-17"><a href="outcome-regression-and-propensity-scores.html#cb116-17" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 5 == 0  2.7929   1.3039 4.2819</span></span>
<span id="cb116-18"><a href="outcome-regression-and-propensity-scores.html#cb116-18" tabindex="-1"></a><span class="co">#&gt; Effect of Quitting Smoking at Smokeintensity of 40 == 0 4.4261   2.5372 6.3151</span></span></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="outcome-regression-and-propensity-scores.html#cb117-1" tabindex="-1"></a></span>
<span id="cb117-2"><a href="outcome-regression-and-propensity-scores.html#cb117-2" tabindex="-1"></a><span class="co"># regression on covariates, not allowing for effect modification</span></span>
<span id="cb117-3"><a href="outcome-regression-and-propensity-scores.html#cb117-3" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">*</span>age) <span class="sc">+</span> <span class="fu">as.factor</span>(education)</span>
<span id="cb117-4"><a href="outcome-regression-and-propensity-scores.html#cb117-4" tabindex="-1"></a>           <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">*</span>smokeintensity) <span class="sc">+</span> smokeyrs</span>
<span id="cb117-5"><a href="outcome-regression-and-propensity-scores.html#cb117-5" tabindex="-1"></a>           <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">*</span>smokeyrs) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active)</span>
<span id="cb117-6"><a href="outcome-regression-and-propensity-scores.html#cb117-6" tabindex="-1"></a>           <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">*</span>wt71), <span class="at">data=</span>nhefs)</span>
<span id="cb117-7"><a href="outcome-regression-and-propensity-scores.html#cb117-7" tabindex="-1"></a></span>
<span id="cb117-8"><a href="outcome-regression-and-propensity-scores.html#cb117-8" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span>
<span id="cb117-9"><a href="outcome-regression-and-propensity-scores.html#cb117-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb117-10"><a href="outcome-regression-and-propensity-scores.html#cb117-10" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb117-11"><a href="outcome-regression-and-propensity-scores.html#cb117-11" tabindex="-1"></a><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age * age) + </span></span>
<span id="cb117-12"><a href="outcome-regression-and-propensity-scores.html#cb117-12" tabindex="-1"></a><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity * </span></span>
<span id="cb117-13"><a href="outcome-regression-and-propensity-scores.html#cb117-13" tabindex="-1"></a><span class="co">#&gt;     smokeintensity) + smokeyrs + I(smokeyrs * smokeyrs) + as.factor(exercise) + </span></span>
<span id="cb117-14"><a href="outcome-regression-and-propensity-scores.html#cb117-14" tabindex="-1"></a><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71 * wt71), data = nhefs)</span></span>
<span id="cb117-15"><a href="outcome-regression-and-propensity-scores.html#cb117-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb117-16"><a href="outcome-regression-and-propensity-scores.html#cb117-16" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb117-17"><a href="outcome-regression-and-propensity-scores.html#cb117-17" tabindex="-1"></a><span class="co">#&gt;                                      Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb117-18"><a href="outcome-regression-and-propensity-scores.html#cb117-18" tabindex="-1"></a><span class="co">#&gt; (Intercept)                        -1.6586176  4.3137734  -0.384 0.700666    </span></span>
<span id="cb117-19"><a href="outcome-regression-and-propensity-scores.html#cb117-19" tabindex="-1"></a><span class="co">#&gt; qsmk                                3.4626218  0.4384543   7.897 5.36e-15 ***</span></span>
<span id="cb117-20"><a href="outcome-regression-and-propensity-scores.html#cb117-20" tabindex="-1"></a><span class="co">#&gt; sex                                -1.4650496  0.4683410  -3.128 0.001792 ** </span></span>
<span id="cb117-21"><a href="outcome-regression-and-propensity-scores.html#cb117-21" tabindex="-1"></a><span class="co">#&gt; race                                0.5864117  0.5816949   1.008 0.313560    </span></span>
<span id="cb117-22"><a href="outcome-regression-and-propensity-scores.html#cb117-22" tabindex="-1"></a><span class="co">#&gt; age                                 0.3626624  0.1633431   2.220 0.026546 *  </span></span>
<span id="cb117-23"><a href="outcome-regression-and-propensity-scores.html#cb117-23" tabindex="-1"></a><span class="co">#&gt; I(age * age)                       -0.0061377  0.0017263  -3.555 0.000389 ***</span></span>
<span id="cb117-24"><a href="outcome-regression-and-propensity-scores.html#cb117-24" tabindex="-1"></a><span class="co">#&gt; as.factor(education)2               0.8185263  0.6067815   1.349 0.177546    </span></span>
<span id="cb117-25"><a href="outcome-regression-and-propensity-scores.html#cb117-25" tabindex="-1"></a><span class="co">#&gt; as.factor(education)3               0.5715004  0.5561211   1.028 0.304273    </span></span>
<span id="cb117-26"><a href="outcome-regression-and-propensity-scores.html#cb117-26" tabindex="-1"></a><span class="co">#&gt; as.factor(education)4               1.5085173  0.8323778   1.812 0.070134 .  </span></span>
<span id="cb117-27"><a href="outcome-regression-and-propensity-scores.html#cb117-27" tabindex="-1"></a><span class="co">#&gt; as.factor(education)5              -0.1708264  0.7413289  -0.230 0.817786    </span></span>
<span id="cb117-28"><a href="outcome-regression-and-propensity-scores.html#cb117-28" tabindex="-1"></a><span class="co">#&gt; smokeintensity                      0.0651533  0.0503115   1.295 0.195514    </span></span>
<span id="cb117-29"><a href="outcome-regression-and-propensity-scores.html#cb117-29" tabindex="-1"></a><span class="co">#&gt; I(smokeintensity * smokeintensity) -0.0010468  0.0009373  -1.117 0.264261    </span></span>
<span id="cb117-30"><a href="outcome-regression-and-propensity-scores.html#cb117-30" tabindex="-1"></a><span class="co">#&gt; smokeyrs                            0.1333931  0.0917319   1.454 0.146104    </span></span>
<span id="cb117-31"><a href="outcome-regression-and-propensity-scores.html#cb117-31" tabindex="-1"></a><span class="co">#&gt; I(smokeyrs * smokeyrs)             -0.0018270  0.0015438  -1.183 0.236818    </span></span>
<span id="cb117-32"><a href="outcome-regression-and-propensity-scores.html#cb117-32" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)1                0.3206824  0.5349616   0.599 0.548961    </span></span>
<span id="cb117-33"><a href="outcome-regression-and-propensity-scores.html#cb117-33" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)2                0.3628786  0.5589557   0.649 0.516300    </span></span>
<span id="cb117-34"><a href="outcome-regression-and-propensity-scores.html#cb117-34" tabindex="-1"></a><span class="co">#&gt; as.factor(active)1                 -0.9429574  0.4100208  -2.300 0.021593 *  </span></span>
<span id="cb117-35"><a href="outcome-regression-and-propensity-scores.html#cb117-35" tabindex="-1"></a><span class="co">#&gt; as.factor(active)2                 -0.2580374  0.6847219  -0.377 0.706337    </span></span>
<span id="cb117-36"><a href="outcome-regression-and-propensity-scores.html#cb117-36" tabindex="-1"></a><span class="co">#&gt; wt71                                0.0373642  0.0831658   0.449 0.653297    </span></span>
<span id="cb117-37"><a href="outcome-regression-and-propensity-scores.html#cb117-37" tabindex="-1"></a><span class="co">#&gt; I(wt71 * wt71)                     -0.0009158  0.0005235  -1.749 0.080426 .  </span></span>
<span id="cb117-38"><a href="outcome-regression-and-propensity-scores.html#cb117-38" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb117-39"><a href="outcome-regression-and-propensity-scores.html#cb117-39" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb117-40"><a href="outcome-regression-and-propensity-scores.html#cb117-40" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb117-41"><a href="outcome-regression-and-propensity-scores.html#cb117-41" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 53.59474)</span></span>
<span id="cb117-42"><a href="outcome-regression-and-propensity-scores.html#cb117-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb117-43"><a href="outcome-regression-and-propensity-scores.html#cb117-43" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span id="cb117-44"><a href="outcome-regression-and-propensity-scores.html#cb117-44" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 82857  on 1546  degrees of freedom</span></span>
<span id="cb117-45"><a href="outcome-regression-and-propensity-scores.html#cb117-45" tabindex="-1"></a><span class="co">#&gt;   (63 observations deleted due to missingness)</span></span>
<span id="cb117-46"><a href="outcome-regression-and-propensity-scores.html#cb117-46" tabindex="-1"></a><span class="co">#&gt; AIC: 10701</span></span>
<span id="cb117-47"><a href="outcome-regression-and-propensity-scores.html#cb117-47" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb117-48"><a href="outcome-regression-and-propensity-scores.html#cb117-48" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
</div>
<div id="program-15.2" class="section level2 hasAnchor">
<h2>Program 15.2<a href="outcome-regression-and-propensity-scores.html#program-15.2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Estimating and plotting the propensity score</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="outcome-regression-and-propensity-scores.html#cb118-1" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">*</span>age) <span class="sc">+</span> <span class="fu">as.factor</span>(education)</span>
<span id="cb118-2"><a href="outcome-regression-and-propensity-scores.html#cb118-2" tabindex="-1"></a>            <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">*</span>smokeintensity) <span class="sc">+</span> smokeyrs</span>
<span id="cb118-3"><a href="outcome-regression-and-propensity-scores.html#cb118-3" tabindex="-1"></a>            <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">*</span>smokeyrs) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active)</span>
<span id="cb118-4"><a href="outcome-regression-and-propensity-scores.html#cb118-4" tabindex="-1"></a>            <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">*</span>wt71), <span class="at">data=</span>nhefs, <span class="at">family=</span><span class="fu">binomial</span>())</span>
<span id="cb118-5"><a href="outcome-regression-and-propensity-scores.html#cb118-5" tabindex="-1"></a><span class="fu">summary</span>(fit3)</span>
<span id="cb118-6"><a href="outcome-regression-and-propensity-scores.html#cb118-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb118-7"><a href="outcome-regression-and-propensity-scores.html#cb118-7" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb118-8"><a href="outcome-regression-and-propensity-scores.html#cb118-8" tabindex="-1"></a><span class="co">#&gt; glm(formula = qsmk ~ sex + race + age + I(age * age) + as.factor(education) + </span></span>
<span id="cb118-9"><a href="outcome-regression-and-propensity-scores.html#cb118-9" tabindex="-1"></a><span class="co">#&gt;     smokeintensity + I(smokeintensity * smokeintensity) + smokeyrs + </span></span>
<span id="cb118-10"><a href="outcome-regression-and-propensity-scores.html#cb118-10" tabindex="-1"></a><span class="co">#&gt;     I(smokeyrs * smokeyrs) + as.factor(exercise) + as.factor(active) + </span></span>
<span id="cb118-11"><a href="outcome-regression-and-propensity-scores.html#cb118-11" tabindex="-1"></a><span class="co">#&gt;     wt71 + I(wt71 * wt71), family = binomial(), data = nhefs)</span></span>
<span id="cb118-12"><a href="outcome-regression-and-propensity-scores.html#cb118-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb118-13"><a href="outcome-regression-and-propensity-scores.html#cb118-13" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb118-14"><a href="outcome-regression-and-propensity-scores.html#cb118-14" tabindex="-1"></a><span class="co">#&gt;                                      Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb118-15"><a href="outcome-regression-and-propensity-scores.html#cb118-15" tabindex="-1"></a><span class="co">#&gt; (Intercept)                        -1.9889022  1.2412792  -1.602 0.109089    </span></span>
<span id="cb118-16"><a href="outcome-regression-and-propensity-scores.html#cb118-16" tabindex="-1"></a><span class="co">#&gt; sex                                -0.5075218  0.1482316  -3.424 0.000617 ***</span></span>
<span id="cb118-17"><a href="outcome-regression-and-propensity-scores.html#cb118-17" tabindex="-1"></a><span class="co">#&gt; race                               -0.8502312  0.2058720  -4.130 3.63e-05 ***</span></span>
<span id="cb118-18"><a href="outcome-regression-and-propensity-scores.html#cb118-18" tabindex="-1"></a><span class="co">#&gt; age                                 0.1030132  0.0488996   2.107 0.035150 *  </span></span>
<span id="cb118-19"><a href="outcome-regression-and-propensity-scores.html#cb118-19" tabindex="-1"></a><span class="co">#&gt; I(age * age)                       -0.0006052  0.0005074  -1.193 0.232973    </span></span>
<span id="cb118-20"><a href="outcome-regression-and-propensity-scores.html#cb118-20" tabindex="-1"></a><span class="co">#&gt; as.factor(education)2              -0.0983203  0.1906553  -0.516 0.606066    </span></span>
<span id="cb118-21"><a href="outcome-regression-and-propensity-scores.html#cb118-21" tabindex="-1"></a><span class="co">#&gt; as.factor(education)3               0.0156987  0.1707139   0.092 0.926730    </span></span>
<span id="cb118-22"><a href="outcome-regression-and-propensity-scores.html#cb118-22" tabindex="-1"></a><span class="co">#&gt; as.factor(education)4              -0.0425260  0.2642761  -0.161 0.872160    </span></span>
<span id="cb118-23"><a href="outcome-regression-and-propensity-scores.html#cb118-23" tabindex="-1"></a><span class="co">#&gt; as.factor(education)5               0.3796632  0.2203947   1.723 0.084952 .  </span></span>
<span id="cb118-24"><a href="outcome-regression-and-propensity-scores.html#cb118-24" tabindex="-1"></a><span class="co">#&gt; smokeintensity                     -0.0651561  0.0147589  -4.415 1.01e-05 ***</span></span>
<span id="cb118-25"><a href="outcome-regression-and-propensity-scores.html#cb118-25" tabindex="-1"></a><span class="co">#&gt; I(smokeintensity * smokeintensity)  0.0008461  0.0002758   3.067 0.002160 ** </span></span>
<span id="cb118-26"><a href="outcome-regression-and-propensity-scores.html#cb118-26" tabindex="-1"></a><span class="co">#&gt; smokeyrs                           -0.0733708  0.0269958  -2.718 0.006571 ** </span></span>
<span id="cb118-27"><a href="outcome-regression-and-propensity-scores.html#cb118-27" tabindex="-1"></a><span class="co">#&gt; I(smokeyrs * smokeyrs)              0.0008384  0.0004435   1.891 0.058669 .  </span></span>
<span id="cb118-28"><a href="outcome-regression-and-propensity-scores.html#cb118-28" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)1                0.2914117  0.1735543   1.679 0.093136 .  </span></span>
<span id="cb118-29"><a href="outcome-regression-and-propensity-scores.html#cb118-29" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)2                0.3550517  0.1799293   1.973 0.048463 *  </span></span>
<span id="cb118-30"><a href="outcome-regression-and-propensity-scores.html#cb118-30" tabindex="-1"></a><span class="co">#&gt; as.factor(active)1                  0.0108754  0.1298320   0.084 0.933243    </span></span>
<span id="cb118-31"><a href="outcome-regression-and-propensity-scores.html#cb118-31" tabindex="-1"></a><span class="co">#&gt; as.factor(active)2                  0.0683123  0.2087269   0.327 0.743455    </span></span>
<span id="cb118-32"><a href="outcome-regression-and-propensity-scores.html#cb118-32" tabindex="-1"></a><span class="co">#&gt; wt71                               -0.0128478  0.0222829  -0.577 0.564226    </span></span>
<span id="cb118-33"><a href="outcome-regression-and-propensity-scores.html#cb118-33" tabindex="-1"></a><span class="co">#&gt; I(wt71 * wt71)                      0.0001209  0.0001352   0.895 0.370957    </span></span>
<span id="cb118-34"><a href="outcome-regression-and-propensity-scores.html#cb118-34" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb118-35"><a href="outcome-regression-and-propensity-scores.html#cb118-35" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb118-36"><a href="outcome-regression-and-propensity-scores.html#cb118-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb118-37"><a href="outcome-regression-and-propensity-scores.html#cb118-37" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb118-38"><a href="outcome-regression-and-propensity-scores.html#cb118-38" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb118-39"><a href="outcome-regression-and-propensity-scores.html#cb118-39" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 1876.3  on 1628  degrees of freedom</span></span>
<span id="cb118-40"><a href="outcome-regression-and-propensity-scores.html#cb118-40" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 1766.7  on 1610  degrees of freedom</span></span>
<span id="cb118-41"><a href="outcome-regression-and-propensity-scores.html#cb118-41" tabindex="-1"></a><span class="co">#&gt; AIC: 1804.7</span></span>
<span id="cb118-42"><a href="outcome-regression-and-propensity-scores.html#cb118-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb118-43"><a href="outcome-regression-and-propensity-scores.html#cb118-43" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="outcome-regression-and-propensity-scores.html#cb119-1" tabindex="-1"></a>nhefs<span class="sc">$</span>ps <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit3, nhefs, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb119-2"><a href="outcome-regression-and-propensity-scores.html#cb119-2" tabindex="-1"></a></span>
<span id="cb119-3"><a href="outcome-regression-and-propensity-scores.html#cb119-3" tabindex="-1"></a><span class="fu">summary</span>(nhefs<span class="sc">$</span>ps[nhefs<span class="sc">$</span>qsmk<span class="sc">==</span><span class="dv">0</span>])</span>
<span id="cb119-4"><a href="outcome-regression-and-propensity-scores.html#cb119-4" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb119-5"><a href="outcome-regression-and-propensity-scores.html#cb119-5" tabindex="-1"></a><span class="co">#&gt; 0.05298 0.16949 0.22747 0.24504 0.30441 0.65788</span></span></code></pre></div>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="outcome-regression-and-propensity-scores.html#cb120-1" tabindex="-1"></a><span class="fu">summary</span>(nhefs<span class="sc">$</span>ps[nhefs<span class="sc">$</span>qsmk<span class="sc">==</span><span class="dv">1</span>])</span>
<span id="cb120-2"><a href="outcome-regression-and-propensity-scores.html#cb120-2" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb120-3"><a href="outcome-regression-and-propensity-scores.html#cb120-3" tabindex="-1"></a><span class="co">#&gt; 0.06248 0.22046 0.28897 0.31240 0.38122 0.79320</span></span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="outcome-regression-and-propensity-scores.html#cb121-1" tabindex="-1"></a></span>
<span id="cb121-2"><a href="outcome-regression-and-propensity-scores.html#cb121-2" tabindex="-1"></a><span class="co"># # plotting the estimated propensity score</span></span>
<span id="cb121-3"><a href="outcome-regression-and-propensity-scores.html#cb121-3" tabindex="-1"></a><span class="co"># install.packages(&quot;ggplot2&quot;) # install packages if necessary</span></span>
<span id="cb121-4"><a href="outcome-regression-and-propensity-scores.html#cb121-4" tabindex="-1"></a><span class="co"># install.packages(&quot;dplyr&quot;)</span></span>
<span id="cb121-5"><a href="outcome-regression-and-propensity-scores.html#cb121-5" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb121-6"><a href="outcome-regression-and-propensity-scores.html#cb121-6" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb121-7"><a href="outcome-regression-and-propensity-scores.html#cb121-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb121-8"><a href="outcome-regression-and-propensity-scores.html#cb121-8" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;dplyr&#39;</span></span>
<span id="cb121-9"><a href="outcome-regression-and-propensity-scores.html#cb121-9" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:MASS&#39;:</span></span>
<span id="cb121-10"><a href="outcome-regression-and-propensity-scores.html#cb121-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb121-11"><a href="outcome-regression-and-propensity-scores.html#cb121-11" tabindex="-1"></a><span class="co">#&gt;     select</span></span>
<span id="cb121-12"><a href="outcome-regression-and-propensity-scores.html#cb121-12" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb121-13"><a href="outcome-regression-and-propensity-scores.html#cb121-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb121-14"><a href="outcome-regression-and-propensity-scores.html#cb121-14" tabindex="-1"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb121-15"><a href="outcome-regression-and-propensity-scores.html#cb121-15" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb121-16"><a href="outcome-regression-and-propensity-scores.html#cb121-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb121-17"><a href="outcome-regression-and-propensity-scores.html#cb121-17" tabindex="-1"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="outcome-regression-and-propensity-scores.html#cb122-1" tabindex="-1"></a><span class="fu">ggplot</span>(nhefs, <span class="fu">aes</span>(<span class="at">x =</span> ps, <span class="at">fill =</span> qsmk)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb122-2"><a href="outcome-regression-and-propensity-scores.html#cb122-2" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Probability of Quitting Smoking During Follow-up&#39;</span>) <span class="sc">+</span></span>
<span id="cb122-3"><a href="outcome-regression-and-propensity-scores.html#cb122-3" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Propensity Score Distribution by Treatment Group&#39;</span>) <span class="sc">+</span></span>
<span id="cb122-4"><a href="outcome-regression-and-propensity-scores.html#cb122-4" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="st">&#39;&#39;</span>) <span class="sc">+</span></span>
<span id="cb122-5"><a href="outcome-regression-and-propensity-scores.html#cb122-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>, <span class="at">legend.direction =</span> <span class="st">&#39;vertical&#39;</span>)</span>
<span id="cb122-6"><a href="outcome-regression-and-propensity-scores.html#cb122-6" tabindex="-1"></a><span class="co">#&gt; Warning: The following aesthetics were dropped during statistical transformation: fill.</span></span>
<span id="cb122-7"><a href="outcome-regression-and-propensity-scores.html#cb122-7" tabindex="-1"></a><span class="co">#&gt; ℹ This can happen when ggplot fails to infer the correct grouping structure in</span></span>
<span id="cb122-8"><a href="outcome-regression-and-propensity-scores.html#cb122-8" tabindex="-1"></a><span class="co">#&gt;   the data.</span></span>
<span id="cb122-9"><a href="outcome-regression-and-propensity-scores.html#cb122-9" tabindex="-1"></a><span class="co">#&gt; ℹ Did you forget to specify a `group` aesthetic or to convert a numerical</span></span>
<span id="cb122-10"><a href="outcome-regression-and-propensity-scores.html#cb122-10" tabindex="-1"></a><span class="co">#&gt;   variable into a factor?</span></span></code></pre></div>
<p><img src="15-prop-scores-r_files/figure-html/unnamed-chunk-3-1.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="outcome-regression-and-propensity-scores.html#cb123-1" tabindex="-1"></a></span>
<span id="cb123-2"><a href="outcome-regression-and-propensity-scores.html#cb123-2" tabindex="-1"></a><span class="co"># alternative plot with histograms</span></span>
<span id="cb123-3"><a href="outcome-regression-and-propensity-scores.html#cb123-3" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> nhefs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">qsmklabel =</span> <span class="fu">ifelse</span>(qsmk <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb123-4"><a href="outcome-regression-and-propensity-scores.html#cb123-4" tabindex="-1"></a>                       <span class="at">yes =</span> <span class="st">&#39;Quit Smoking 1971-1982&#39;</span>,</span>
<span id="cb123-5"><a href="outcome-regression-and-propensity-scores.html#cb123-5" tabindex="-1"></a>                       <span class="at">no =</span> <span class="st">&#39;Did Not Quit Smoking 1971-1982&#39;</span>))</span>
<span id="cb123-6"><a href="outcome-regression-and-propensity-scores.html#cb123-6" tabindex="-1"></a><span class="fu">ggplot</span>(nhefs, <span class="fu">aes</span>(<span class="at">x =</span> ps, <span class="at">fill =</span> <span class="fu">as.factor</span>(qsmk), <span class="at">color =</span> <span class="fu">as.factor</span>(qsmk))) <span class="sc">+</span></span>
<span id="cb123-7"><a href="outcome-regression-and-propensity-scores.html#cb123-7" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">position =</span> <span class="st">&#39;identity&#39;</span>, <span class="at">bins=</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb123-8"><a href="outcome-regression-and-propensity-scores.html#cb123-8" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="fu">as.factor</span>(qsmk) <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb123-9"><a href="outcome-regression-and-propensity-scores.html#cb123-9" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Probability of Quitting Smoking During Follow-up&#39;</span>) <span class="sc">+</span></span>
<span id="cb123-10"><a href="outcome-regression-and-propensity-scores.html#cb123-10" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Propensity Score Distribution by Treatment Group&#39;</span>) <span class="sc">+</span></span>
<span id="cb123-11"><a href="outcome-regression-and-propensity-scores.html#cb123-11" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="st">&#39;&#39;</span>) <span class="sc">+</span></span>
<span id="cb123-12"><a href="outcome-regression-and-propensity-scores.html#cb123-12" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="st">&#39;&#39;</span>) <span class="sc">+</span></span>
<span id="cb123-13"><a href="outcome-regression-and-propensity-scores.html#cb123-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>, <span class="at">legend.direction =</span> <span class="st">&#39;vertical&#39;</span>)</span></code></pre></div>
<p><img src="15-prop-scores-r_files/figure-html/unnamed-chunk-3-2.png" width="85%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="outcome-regression-and-propensity-scores.html#cb124-1" tabindex="-1"></a><span class="co"># attempt to reproduce plot from the book</span></span>
<span id="cb124-2"><a href="outcome-regression-and-propensity-scores.html#cb124-2" tabindex="-1"></a>nhefs <span class="sc">%&gt;%</span></span>
<span id="cb124-3"><a href="outcome-regression-and-propensity-scores.html#cb124-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ps.grp =</span> <span class="fu">round</span>(ps<span class="sc">/</span><span class="fl">0.05</span>) <span class="sc">*</span> <span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb124-4"><a href="outcome-regression-and-propensity-scores.html#cb124-4" tabindex="-1"></a>  <span class="fu">group_by</span>(qsmk, ps.grp) <span class="sc">%&gt;%</span></span>
<span id="cb124-5"><a href="outcome-regression-and-propensity-scores.html#cb124-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb124-6"><a href="outcome-regression-and-propensity-scores.html#cb124-6" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb124-7"><a href="outcome-regression-and-propensity-scores.html#cb124-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n2 =</span> <span class="fu">ifelse</span>(qsmk <span class="sc">==</span> <span class="dv">0</span>, <span class="at">yes =</span> n, <span class="at">no =</span>  <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>n)) <span class="sc">%&gt;%</span></span>
<span id="cb124-8"><a href="outcome-regression-and-propensity-scores.html#cb124-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ps.grp, <span class="at">y =</span> n2, <span class="at">fill =</span> <span class="fu">as.factor</span>(qsmk))) <span class="sc">+</span></span>
<span id="cb124-9"><a href="outcome-regression-and-propensity-scores.html#cb124-9" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>, <span class="at">position =</span> <span class="st">&#39;identity&#39;</span>) <span class="sc">+</span></span>
<span id="cb124-10"><a href="outcome-regression-and-propensity-scores.html#cb124-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n, <span class="at">x =</span> ps.grp, <span class="at">y =</span> n2 <span class="sc">+</span> <span class="fu">ifelse</span>(qsmk <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">8</span>, <span class="sc">-</span><span class="dv">8</span>))) <span class="sc">+</span></span>
<span id="cb124-11"><a href="outcome-regression-and-propensity-scores.html#cb124-11" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&#39;Probability of Quitting Smoking During Follow-up&#39;</span>) <span class="sc">+</span></span>
<span id="cb124-12"><a href="outcome-regression-and-propensity-scores.html#cb124-12" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&#39;N&#39;</span>) <span class="sc">+</span></span>
<span id="cb124-13"><a href="outcome-regression-and-propensity-scores.html#cb124-13" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&#39;Propensity Score Distribution by Treatment Group&#39;</span>) <span class="sc">+</span></span>
<span id="cb124-14"><a href="outcome-regression-and-propensity-scores.html#cb124-14" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="st">&#39;&#39;</span>) <span class="sc">+</span></span>
<span id="cb124-15"><a href="outcome-regression-and-propensity-scores.html#cb124-15" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb124-16"><a href="outcome-regression-and-propensity-scores.html#cb124-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;bottom&#39;</span>, <span class="at">legend.direction =</span> <span class="st">&#39;vertical&#39;</span>,</span>
<span id="cb124-17"><a href="outcome-regression-and-propensity-scores.html#cb124-17" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb124-18"><a href="outcome-regression-and-propensity-scores.html#cb124-18" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
</div>
<div id="program-15.3" class="section level2 hasAnchor">
<h2>Program 15.3<a href="outcome-regression-and-propensity-scores.html#program-15.3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Stratification on the propensity score</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="outcome-regression-and-propensity-scores.html#cb125-1" tabindex="-1"></a><span class="co"># calculation of deciles</span></span>
<span id="cb125-2"><a href="outcome-regression-and-propensity-scores.html#cb125-2" tabindex="-1"></a>nhefs<span class="sc">$</span>ps.dec <span class="ot">&lt;-</span> <span class="fu">cut</span>(nhefs<span class="sc">$</span>ps,</span>
<span id="cb125-3"><a href="outcome-regression-and-propensity-scores.html#cb125-3" tabindex="-1"></a>                    <span class="at">breaks=</span><span class="fu">c</span>(<span class="fu">quantile</span>(nhefs<span class="sc">$</span>ps, <span class="at">probs=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.1</span>))),</span>
<span id="cb125-4"><a href="outcome-regression-and-propensity-scores.html#cb125-4" tabindex="-1"></a>                    <span class="at">labels=</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb125-5"><a href="outcome-regression-and-propensity-scores.html#cb125-5" tabindex="-1"></a>                    <span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span>
<span id="cb125-6"><a href="outcome-regression-and-propensity-scores.html#cb125-6" tabindex="-1"></a></span>
<span id="cb125-7"><a href="outcome-regression-and-propensity-scores.html#cb125-7" tabindex="-1"></a><span class="co">#install.packages(&quot;psych&quot;) # install package if required</span></span>
<span id="cb125-8"><a href="outcome-regression-and-propensity-scores.html#cb125-8" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;psych&quot;</span>)</span>
<span id="cb125-9"><a href="outcome-regression-and-propensity-scores.html#cb125-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb125-10"><a href="outcome-regression-and-propensity-scores.html#cb125-10" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;psych&#39;</span></span>
<span id="cb125-11"><a href="outcome-regression-and-propensity-scores.html#cb125-11" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:ggplot2&#39;:</span></span>
<span id="cb125-12"><a href="outcome-regression-and-propensity-scores.html#cb125-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb125-13"><a href="outcome-regression-and-propensity-scores.html#cb125-13" tabindex="-1"></a><span class="co">#&gt;     %+%, alpha</span></span></code></pre></div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="outcome-regression-and-propensity-scores.html#cb126-1" tabindex="-1"></a><span class="fu">describeBy</span>(nhefs<span class="sc">$</span>ps, <span class="fu">list</span>(nhefs<span class="sc">$</span>ps.dec, nhefs<span class="sc">$</span>qsmk))</span>
<span id="cb126-2"><a href="outcome-regression-and-propensity-scores.html#cb126-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb126-3"><a href="outcome-regression-and-propensity-scores.html#cb126-3" tabindex="-1"></a><span class="co">#&gt;  Descriptive statistics by group </span></span>
<span id="cb126-4"><a href="outcome-regression-and-propensity-scores.html#cb126-4" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-5"><a href="outcome-regression-and-propensity-scores.html#cb126-5" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-6"><a href="outcome-regression-and-propensity-scores.html#cb126-6" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb126-7"><a href="outcome-regression-and-propensity-scores.html#cb126-7" tabindex="-1"></a><span class="co">#&gt; X1    1 151  0.1 0.02   0.11     0.1 0.02 0.05 0.13  0.08 -0.55    -0.53  0</span></span>
<span id="cb126-8"><a href="outcome-regression-and-propensity-scores.html#cb126-8" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-9"><a href="outcome-regression-and-propensity-scores.html#cb126-9" tabindex="-1"></a><span class="co">#&gt; : 2</span></span>
<span id="cb126-10"><a href="outcome-regression-and-propensity-scores.html#cb126-10" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-11"><a href="outcome-regression-and-propensity-scores.html#cb126-11" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb126-12"><a href="outcome-regression-and-propensity-scores.html#cb126-12" tabindex="-1"></a><span class="co">#&gt; X1    1 136 0.15 0.01   0.15    0.15 0.01 0.13 0.17  0.04 -0.04    -1.23  0</span></span>
<span id="cb126-13"><a href="outcome-regression-and-propensity-scores.html#cb126-13" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-14"><a href="outcome-regression-and-propensity-scores.html#cb126-14" tabindex="-1"></a><span class="co">#&gt; : 3</span></span>
<span id="cb126-15"><a href="outcome-regression-and-propensity-scores.html#cb126-15" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-16"><a href="outcome-regression-and-propensity-scores.html#cb126-16" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb126-17"><a href="outcome-regression-and-propensity-scores.html#cb126-17" tabindex="-1"></a><span class="co">#&gt; X1    1 134 0.18 0.01   0.18    0.18 0.01 0.17 0.19  0.03 -0.08    -1.34  0</span></span>
<span id="cb126-18"><a href="outcome-regression-and-propensity-scores.html#cb126-18" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-19"><a href="outcome-regression-and-propensity-scores.html#cb126-19" tabindex="-1"></a><span class="co">#&gt; : 4</span></span>
<span id="cb126-20"><a href="outcome-regression-and-propensity-scores.html#cb126-20" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-21"><a href="outcome-regression-and-propensity-scores.html#cb126-21" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb126-22"><a href="outcome-regression-and-propensity-scores.html#cb126-22" tabindex="-1"></a><span class="co">#&gt; X1    1 129 0.21 0.01   0.21    0.21 0.01 0.19 0.22  0.02 -0.04    -1.13  0</span></span>
<span id="cb126-23"><a href="outcome-regression-and-propensity-scores.html#cb126-23" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-24"><a href="outcome-regression-and-propensity-scores.html#cb126-24" tabindex="-1"></a><span class="co">#&gt; : 5</span></span>
<span id="cb126-25"><a href="outcome-regression-and-propensity-scores.html#cb126-25" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-26"><a href="outcome-regression-and-propensity-scores.html#cb126-26" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb126-27"><a href="outcome-regression-and-propensity-scores.html#cb126-27" tabindex="-1"></a><span class="co">#&gt; X1    1 120 0.23 0.01   0.23    0.23 0.01 0.22 0.25  0.03 0.24    -1.22  0</span></span>
<span id="cb126-28"><a href="outcome-regression-and-propensity-scores.html#cb126-28" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-29"><a href="outcome-regression-and-propensity-scores.html#cb126-29" tabindex="-1"></a><span class="co">#&gt; : 6</span></span>
<span id="cb126-30"><a href="outcome-regression-and-propensity-scores.html#cb126-30" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-31"><a href="outcome-regression-and-propensity-scores.html#cb126-31" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb126-32"><a href="outcome-regression-and-propensity-scores.html#cb126-32" tabindex="-1"></a><span class="co">#&gt; X1    1 117 0.26 0.01   0.26    0.26 0.01 0.25 0.27  0.03 -0.11    -1.29  0</span></span>
<span id="cb126-33"><a href="outcome-regression-and-propensity-scores.html#cb126-33" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-34"><a href="outcome-regression-and-propensity-scores.html#cb126-34" tabindex="-1"></a><span class="co">#&gt; : 7</span></span>
<span id="cb126-35"><a href="outcome-regression-and-propensity-scores.html#cb126-35" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-36"><a href="outcome-regression-and-propensity-scores.html#cb126-36" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb126-37"><a href="outcome-regression-and-propensity-scores.html#cb126-37" tabindex="-1"></a><span class="co">#&gt; X1    1 120 0.29 0.01   0.29    0.29 0.01 0.27 0.31  0.03 -0.23    -1.19  0</span></span>
<span id="cb126-38"><a href="outcome-regression-and-propensity-scores.html#cb126-38" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-39"><a href="outcome-regression-and-propensity-scores.html#cb126-39" tabindex="-1"></a><span class="co">#&gt; : 8</span></span>
<span id="cb126-40"><a href="outcome-regression-and-propensity-scores.html#cb126-40" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-41"><a href="outcome-regression-and-propensity-scores.html#cb126-41" tabindex="-1"></a><span class="co">#&gt;    vars   n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb126-42"><a href="outcome-regression-and-propensity-scores.html#cb126-42" tabindex="-1"></a><span class="co">#&gt; X1    1 112 0.33 0.01   0.33    0.33 0.02 0.31 0.35  0.04 0.15     -1.1  0</span></span>
<span id="cb126-43"><a href="outcome-regression-and-propensity-scores.html#cb126-43" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-44"><a href="outcome-regression-and-propensity-scores.html#cb126-44" tabindex="-1"></a><span class="co">#&gt; : 9</span></span>
<span id="cb126-45"><a href="outcome-regression-and-propensity-scores.html#cb126-45" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-46"><a href="outcome-regression-and-propensity-scores.html#cb126-46" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb126-47"><a href="outcome-regression-and-propensity-scores.html#cb126-47" tabindex="-1"></a><span class="co">#&gt; X1    1 96 0.38 0.02   0.38    0.38 0.02 0.35 0.42  0.06 0.13    -1.15  0</span></span>
<span id="cb126-48"><a href="outcome-regression-and-propensity-scores.html#cb126-48" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-49"><a href="outcome-regression-and-propensity-scores.html#cb126-49" tabindex="-1"></a><span class="co">#&gt; : 10</span></span>
<span id="cb126-50"><a href="outcome-regression-and-propensity-scores.html#cb126-50" tabindex="-1"></a><span class="co">#&gt; : 0</span></span>
<span id="cb126-51"><a href="outcome-regression-and-propensity-scores.html#cb126-51" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis   se</span></span>
<span id="cb126-52"><a href="outcome-regression-and-propensity-scores.html#cb126-52" tabindex="-1"></a><span class="co">#&gt; X1    1 86 0.49 0.06   0.47    0.48 0.05 0.42 0.66  0.24  1.1     0.47 0.01</span></span>
<span id="cb126-53"><a href="outcome-regression-and-propensity-scores.html#cb126-53" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-54"><a href="outcome-regression-and-propensity-scores.html#cb126-54" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-55"><a href="outcome-regression-and-propensity-scores.html#cb126-55" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-56"><a href="outcome-regression-and-propensity-scores.html#cb126-56" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis   se</span></span>
<span id="cb126-57"><a href="outcome-regression-and-propensity-scores.html#cb126-57" tabindex="-1"></a><span class="co">#&gt; X1    1 12  0.1 0.02   0.11     0.1 0.03 0.06 0.13  0.07 -0.5    -1.36 0.01</span></span>
<span id="cb126-58"><a href="outcome-regression-and-propensity-scores.html#cb126-58" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-59"><a href="outcome-regression-and-propensity-scores.html#cb126-59" tabindex="-1"></a><span class="co">#&gt; : 2</span></span>
<span id="cb126-60"><a href="outcome-regression-and-propensity-scores.html#cb126-60" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-61"><a href="outcome-regression-and-propensity-scores.html#cb126-61" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb126-62"><a href="outcome-regression-and-propensity-scores.html#cb126-62" tabindex="-1"></a><span class="co">#&gt; X1    1 27 0.15 0.01   0.15    0.15 0.01 0.13 0.17  0.03 -0.03    -1.34  0</span></span>
<span id="cb126-63"><a href="outcome-regression-and-propensity-scores.html#cb126-63" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-64"><a href="outcome-regression-and-propensity-scores.html#cb126-64" tabindex="-1"></a><span class="co">#&gt; : 3</span></span>
<span id="cb126-65"><a href="outcome-regression-and-propensity-scores.html#cb126-65" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-66"><a href="outcome-regression-and-propensity-scores.html#cb126-66" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb126-67"><a href="outcome-regression-and-propensity-scores.html#cb126-67" tabindex="-1"></a><span class="co">#&gt; X1    1 29 0.18 0.01   0.18    0.18 0.01 0.17 0.19  0.03 0.01    -1.34  0</span></span>
<span id="cb126-68"><a href="outcome-regression-and-propensity-scores.html#cb126-68" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-69"><a href="outcome-regression-and-propensity-scores.html#cb126-69" tabindex="-1"></a><span class="co">#&gt; : 4</span></span>
<span id="cb126-70"><a href="outcome-regression-and-propensity-scores.html#cb126-70" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-71"><a href="outcome-regression-and-propensity-scores.html#cb126-71" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range  skew kurtosis se</span></span>
<span id="cb126-72"><a href="outcome-regression-and-propensity-scores.html#cb126-72" tabindex="-1"></a><span class="co">#&gt; X1    1 34 0.21 0.01   0.21    0.21 0.01 0.19 0.22  0.02 -0.31    -1.23  0</span></span>
<span id="cb126-73"><a href="outcome-regression-and-propensity-scores.html#cb126-73" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-74"><a href="outcome-regression-and-propensity-scores.html#cb126-74" tabindex="-1"></a><span class="co">#&gt; : 5</span></span>
<span id="cb126-75"><a href="outcome-regression-and-propensity-scores.html#cb126-75" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-76"><a href="outcome-regression-and-propensity-scores.html#cb126-76" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb126-77"><a href="outcome-regression-and-propensity-scores.html#cb126-77" tabindex="-1"></a><span class="co">#&gt; X1    1 43 0.23 0.01   0.23    0.23 0.01 0.22 0.25  0.03 0.11    -1.23  0</span></span>
<span id="cb126-78"><a href="outcome-regression-and-propensity-scores.html#cb126-78" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-79"><a href="outcome-regression-and-propensity-scores.html#cb126-79" tabindex="-1"></a><span class="co">#&gt; : 6</span></span>
<span id="cb126-80"><a href="outcome-regression-and-propensity-scores.html#cb126-80" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-81"><a href="outcome-regression-and-propensity-scores.html#cb126-81" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb126-82"><a href="outcome-regression-and-propensity-scores.html#cb126-82" tabindex="-1"></a><span class="co">#&gt; X1    1 45 0.26 0.01   0.26    0.26 0.01 0.25 0.27  0.03  0.2    -1.12  0</span></span>
<span id="cb126-83"><a href="outcome-regression-and-propensity-scores.html#cb126-83" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-84"><a href="outcome-regression-and-propensity-scores.html#cb126-84" tabindex="-1"></a><span class="co">#&gt; : 7</span></span>
<span id="cb126-85"><a href="outcome-regression-and-propensity-scores.html#cb126-85" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-86"><a href="outcome-regression-and-propensity-scores.html#cb126-86" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb126-87"><a href="outcome-regression-and-propensity-scores.html#cb126-87" tabindex="-1"></a><span class="co">#&gt; X1    1 43 0.29 0.01   0.29    0.29 0.01 0.27 0.31  0.03 0.16    -1.25  0</span></span>
<span id="cb126-88"><a href="outcome-regression-and-propensity-scores.html#cb126-88" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-89"><a href="outcome-regression-and-propensity-scores.html#cb126-89" tabindex="-1"></a><span class="co">#&gt; : 8</span></span>
<span id="cb126-90"><a href="outcome-regression-and-propensity-scores.html#cb126-90" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-91"><a href="outcome-regression-and-propensity-scores.html#cb126-91" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb126-92"><a href="outcome-regression-and-propensity-scores.html#cb126-92" tabindex="-1"></a><span class="co">#&gt; X1    1 51 0.33 0.01   0.33    0.33 0.02 0.31 0.35  0.04 0.11    -1.19  0</span></span>
<span id="cb126-93"><a href="outcome-regression-and-propensity-scores.html#cb126-93" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-94"><a href="outcome-regression-and-propensity-scores.html#cb126-94" tabindex="-1"></a><span class="co">#&gt; : 9</span></span>
<span id="cb126-95"><a href="outcome-regression-and-propensity-scores.html#cb126-95" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-96"><a href="outcome-regression-and-propensity-scores.html#cb126-96" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis se</span></span>
<span id="cb126-97"><a href="outcome-regression-and-propensity-scores.html#cb126-97" tabindex="-1"></a><span class="co">#&gt; X1    1 67 0.38 0.02   0.38    0.38 0.03 0.35 0.42  0.06 0.19    -1.27  0</span></span>
<span id="cb126-98"><a href="outcome-regression-and-propensity-scores.html#cb126-98" tabindex="-1"></a><span class="co">#&gt; ------------------------------------------------------------ </span></span>
<span id="cb126-99"><a href="outcome-regression-and-propensity-scores.html#cb126-99" tabindex="-1"></a><span class="co">#&gt; : 10</span></span>
<span id="cb126-100"><a href="outcome-regression-and-propensity-scores.html#cb126-100" tabindex="-1"></a><span class="co">#&gt; : 1</span></span>
<span id="cb126-101"><a href="outcome-regression-and-propensity-scores.html#cb126-101" tabindex="-1"></a><span class="co">#&gt;    vars  n mean   sd median trimmed  mad  min  max range skew kurtosis   se</span></span>
<span id="cb126-102"><a href="outcome-regression-and-propensity-scores.html#cb126-102" tabindex="-1"></a><span class="co">#&gt; X1    1 77 0.52 0.08   0.51    0.51 0.08 0.42 0.79  0.38 0.88     0.81 0.01</span></span></code></pre></div>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="outcome-regression-and-propensity-scores.html#cb127-1" tabindex="-1"></a></span>
<span id="cb127-2"><a href="outcome-regression-and-propensity-scores.html#cb127-2" tabindex="-1"></a><span class="co"># function to create deciles easily</span></span>
<span id="cb127-3"><a href="outcome-regression-and-propensity-scores.html#cb127-3" tabindex="-1"></a>decile <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb127-4"><a href="outcome-regression-and-propensity-scores.html#cb127-4" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">factor</span>(<span class="fu">quantcut</span>(x, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">labels =</span> <span class="cn">FALSE</span>)))</span>
<span id="cb127-5"><a href="outcome-regression-and-propensity-scores.html#cb127-5" tabindex="-1"></a>}</span>
<span id="cb127-6"><a href="outcome-regression-and-propensity-scores.html#cb127-6" tabindex="-1"></a></span>
<span id="cb127-7"><a href="outcome-regression-and-propensity-scores.html#cb127-7" tabindex="-1"></a><span class="co"># regression on PS deciles, allowing for effect modification</span></span>
<span id="cb127-8"><a href="outcome-regression-and-propensity-scores.html#cb127-8" tabindex="-1"></a><span class="cf">for</span> (deciles <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) {</span>
<span id="cb127-9"><a href="outcome-regression-and-propensity-scores.html#cb127-9" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">t.test</span>(wt82_71<span class="sc">~</span>qsmk, <span class="at">data=</span>nhefs[<span class="fu">which</span>(nhefs<span class="sc">$</span>ps.dec<span class="sc">==</span>deciles),]))</span>
<span id="cb127-10"><a href="outcome-regression-and-propensity-scores.html#cb127-10" tabindex="-1"></a>}</span>
<span id="cb127-11"><a href="outcome-regression-and-propensity-scores.html#cb127-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-12"><a href="outcome-regression-and-propensity-scores.html#cb127-12" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-13"><a href="outcome-regression-and-propensity-scores.html#cb127-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-14"><a href="outcome-regression-and-propensity-scores.html#cb127-14" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-15"><a href="outcome-regression-and-propensity-scores.html#cb127-15" tabindex="-1"></a><span class="co">#&gt; t = 0.0060506, df = 11.571, p-value = 0.9953</span></span>
<span id="cb127-16"><a href="outcome-regression-and-propensity-scores.html#cb127-16" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-17"><a href="outcome-regression-and-propensity-scores.html#cb127-17" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-18"><a href="outcome-regression-and-propensity-scores.html#cb127-18" tabindex="-1"></a><span class="co">#&gt;  -5.283903  5.313210</span></span>
<span id="cb127-19"><a href="outcome-regression-and-propensity-scores.html#cb127-19" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-20"><a href="outcome-regression-and-propensity-scores.html#cb127-20" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-21"><a href="outcome-regression-and-propensity-scores.html#cb127-21" tabindex="-1"></a><span class="co">#&gt;        3.995205        3.980551 </span></span>
<span id="cb127-22"><a href="outcome-regression-and-propensity-scores.html#cb127-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-23"><a href="outcome-regression-and-propensity-scores.html#cb127-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-24"><a href="outcome-regression-and-propensity-scores.html#cb127-24" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-25"><a href="outcome-regression-and-propensity-scores.html#cb127-25" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-26"><a href="outcome-regression-and-propensity-scores.html#cb127-26" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-27"><a href="outcome-regression-and-propensity-scores.html#cb127-27" tabindex="-1"></a><span class="co">#&gt; t = -3.1117, df = 37.365, p-value = 0.003556</span></span>
<span id="cb127-28"><a href="outcome-regression-and-propensity-scores.html#cb127-28" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-29"><a href="outcome-regression-and-propensity-scores.html#cb127-29" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-30"><a href="outcome-regression-and-propensity-scores.html#cb127-30" tabindex="-1"></a><span class="co">#&gt;  -6.849335 -1.448161</span></span>
<span id="cb127-31"><a href="outcome-regression-and-propensity-scores.html#cb127-31" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-32"><a href="outcome-regression-and-propensity-scores.html#cb127-32" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-33"><a href="outcome-regression-and-propensity-scores.html#cb127-33" tabindex="-1"></a><span class="co">#&gt;        2.904679        7.053426 </span></span>
<span id="cb127-34"><a href="outcome-regression-and-propensity-scores.html#cb127-34" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-35"><a href="outcome-regression-and-propensity-scores.html#cb127-35" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-36"><a href="outcome-regression-and-propensity-scores.html#cb127-36" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-37"><a href="outcome-regression-and-propensity-scores.html#cb127-37" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-38"><a href="outcome-regression-and-propensity-scores.html#cb127-38" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-39"><a href="outcome-regression-and-propensity-scores.html#cb127-39" tabindex="-1"></a><span class="co">#&gt; t = -4.5301, df = 35.79, p-value = 6.317e-05</span></span>
<span id="cb127-40"><a href="outcome-regression-and-propensity-scores.html#cb127-40" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-41"><a href="outcome-regression-and-propensity-scores.html#cb127-41" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-42"><a href="outcome-regression-and-propensity-scores.html#cb127-42" tabindex="-1"></a><span class="co">#&gt;  -9.474961 -3.613990</span></span>
<span id="cb127-43"><a href="outcome-regression-and-propensity-scores.html#cb127-43" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-44"><a href="outcome-regression-and-propensity-scores.html#cb127-44" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-45"><a href="outcome-regression-and-propensity-scores.html#cb127-45" tabindex="-1"></a><span class="co">#&gt;        2.612094        9.156570 </span></span>
<span id="cb127-46"><a href="outcome-regression-and-propensity-scores.html#cb127-46" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-47"><a href="outcome-regression-and-propensity-scores.html#cb127-47" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-48"><a href="outcome-regression-and-propensity-scores.html#cb127-48" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-49"><a href="outcome-regression-and-propensity-scores.html#cb127-49" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-50"><a href="outcome-regression-and-propensity-scores.html#cb127-50" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-51"><a href="outcome-regression-and-propensity-scores.html#cb127-51" tabindex="-1"></a><span class="co">#&gt; t = -1.4117, df = 45.444, p-value = 0.1648</span></span>
<span id="cb127-52"><a href="outcome-regression-and-propensity-scores.html#cb127-52" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-53"><a href="outcome-regression-and-propensity-scores.html#cb127-53" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-54"><a href="outcome-regression-and-propensity-scores.html#cb127-54" tabindex="-1"></a><span class="co">#&gt;  -5.6831731  0.9985715</span></span>
<span id="cb127-55"><a href="outcome-regression-and-propensity-scores.html#cb127-55" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-56"><a href="outcome-regression-and-propensity-scores.html#cb127-56" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-57"><a href="outcome-regression-and-propensity-scores.html#cb127-57" tabindex="-1"></a><span class="co">#&gt;        3.474679        5.816979 </span></span>
<span id="cb127-58"><a href="outcome-regression-and-propensity-scores.html#cb127-58" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-59"><a href="outcome-regression-and-propensity-scores.html#cb127-59" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-60"><a href="outcome-regression-and-propensity-scores.html#cb127-60" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-61"><a href="outcome-regression-and-propensity-scores.html#cb127-61" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-62"><a href="outcome-regression-and-propensity-scores.html#cb127-62" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-63"><a href="outcome-regression-and-propensity-scores.html#cb127-63" tabindex="-1"></a><span class="co">#&gt; t = -3.1371, df = 74.249, p-value = 0.002446</span></span>
<span id="cb127-64"><a href="outcome-regression-and-propensity-scores.html#cb127-64" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-65"><a href="outcome-regression-and-propensity-scores.html#cb127-65" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-66"><a href="outcome-regression-and-propensity-scores.html#cb127-66" tabindex="-1"></a><span class="co">#&gt;  -6.753621 -1.507087</span></span>
<span id="cb127-67"><a href="outcome-regression-and-propensity-scores.html#cb127-67" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-68"><a href="outcome-regression-and-propensity-scores.html#cb127-68" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-69"><a href="outcome-regression-and-propensity-scores.html#cb127-69" tabindex="-1"></a><span class="co">#&gt;        2.098800        6.229154 </span></span>
<span id="cb127-70"><a href="outcome-regression-and-propensity-scores.html#cb127-70" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-71"><a href="outcome-regression-and-propensity-scores.html#cb127-71" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-72"><a href="outcome-regression-and-propensity-scores.html#cb127-72" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-73"><a href="outcome-regression-and-propensity-scores.html#cb127-73" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-74"><a href="outcome-regression-and-propensity-scores.html#cb127-74" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-75"><a href="outcome-regression-and-propensity-scores.html#cb127-75" tabindex="-1"></a><span class="co">#&gt; t = -2.1677, df = 50.665, p-value = 0.0349</span></span>
<span id="cb127-76"><a href="outcome-regression-and-propensity-scores.html#cb127-76" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-77"><a href="outcome-regression-and-propensity-scores.html#cb127-77" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-78"><a href="outcome-regression-and-propensity-scores.html#cb127-78" tabindex="-1"></a><span class="co">#&gt;  -8.7516605 -0.3350127</span></span>
<span id="cb127-79"><a href="outcome-regression-and-propensity-scores.html#cb127-79" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-80"><a href="outcome-regression-and-propensity-scores.html#cb127-80" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-81"><a href="outcome-regression-and-propensity-scores.html#cb127-81" tabindex="-1"></a><span class="co">#&gt;        1.847004        6.390340 </span></span>
<span id="cb127-82"><a href="outcome-regression-and-propensity-scores.html#cb127-82" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-83"><a href="outcome-regression-and-propensity-scores.html#cb127-83" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-84"><a href="outcome-regression-and-propensity-scores.html#cb127-84" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-85"><a href="outcome-regression-and-propensity-scores.html#cb127-85" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-86"><a href="outcome-regression-and-propensity-scores.html#cb127-86" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-87"><a href="outcome-regression-and-propensity-scores.html#cb127-87" tabindex="-1"></a><span class="co">#&gt; t = -3.3155, df = 84.724, p-value = 0.001348</span></span>
<span id="cb127-88"><a href="outcome-regression-and-propensity-scores.html#cb127-88" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-89"><a href="outcome-regression-and-propensity-scores.html#cb127-89" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-90"><a href="outcome-regression-and-propensity-scores.html#cb127-90" tabindex="-1"></a><span class="co">#&gt;  -6.904207 -1.727590</span></span>
<span id="cb127-91"><a href="outcome-regression-and-propensity-scores.html#cb127-91" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-92"><a href="outcome-regression-and-propensity-scores.html#cb127-92" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-93"><a href="outcome-regression-and-propensity-scores.html#cb127-93" tabindex="-1"></a><span class="co">#&gt;        1.560048        5.875946 </span></span>
<span id="cb127-94"><a href="outcome-regression-and-propensity-scores.html#cb127-94" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-95"><a href="outcome-regression-and-propensity-scores.html#cb127-95" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-96"><a href="outcome-regression-and-propensity-scores.html#cb127-96" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-97"><a href="outcome-regression-and-propensity-scores.html#cb127-97" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-98"><a href="outcome-regression-and-propensity-scores.html#cb127-98" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-99"><a href="outcome-regression-and-propensity-scores.html#cb127-99" tabindex="-1"></a><span class="co">#&gt; t = -2.664, df = 75.306, p-value = 0.009441</span></span>
<span id="cb127-100"><a href="outcome-regression-and-propensity-scores.html#cb127-100" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-101"><a href="outcome-regression-and-propensity-scores.html#cb127-101" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-102"><a href="outcome-regression-and-propensity-scores.html#cb127-102" tabindex="-1"></a><span class="co">#&gt;  -6.2396014 -0.9005605</span></span>
<span id="cb127-103"><a href="outcome-regression-and-propensity-scores.html#cb127-103" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-104"><a href="outcome-regression-and-propensity-scores.html#cb127-104" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-105"><a href="outcome-regression-and-propensity-scores.html#cb127-105" tabindex="-1"></a><span class="co">#&gt;       0.2846851       3.8547661 </span></span>
<span id="cb127-106"><a href="outcome-regression-and-propensity-scores.html#cb127-106" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-107"><a href="outcome-regression-and-propensity-scores.html#cb127-107" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-108"><a href="outcome-regression-and-propensity-scores.html#cb127-108" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-109"><a href="outcome-regression-and-propensity-scores.html#cb127-109" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-110"><a href="outcome-regression-and-propensity-scores.html#cb127-110" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-111"><a href="outcome-regression-and-propensity-scores.html#cb127-111" tabindex="-1"></a><span class="co">#&gt; t = -1.9122, df = 129.12, p-value = 0.05806</span></span>
<span id="cb127-112"><a href="outcome-regression-and-propensity-scores.html#cb127-112" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-113"><a href="outcome-regression-and-propensity-scores.html#cb127-113" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-114"><a href="outcome-regression-and-propensity-scores.html#cb127-114" tabindex="-1"></a><span class="co">#&gt;  -4.68143608  0.07973698</span></span>
<span id="cb127-115"><a href="outcome-regression-and-propensity-scores.html#cb127-115" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-116"><a href="outcome-regression-and-propensity-scores.html#cb127-116" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-117"><a href="outcome-regression-and-propensity-scores.html#cb127-117" tabindex="-1"></a><span class="co">#&gt;      -0.8954482       1.4054014 </span></span>
<span id="cb127-118"><a href="outcome-regression-and-propensity-scores.html#cb127-118" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-119"><a href="outcome-regression-and-propensity-scores.html#cb127-119" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-120"><a href="outcome-regression-and-propensity-scores.html#cb127-120" tabindex="-1"></a><span class="co">#&gt;  Welch Two Sample t-test</span></span>
<span id="cb127-121"><a href="outcome-regression-and-propensity-scores.html#cb127-121" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb127-122"><a href="outcome-regression-and-propensity-scores.html#cb127-122" tabindex="-1"></a><span class="co">#&gt; data:  wt82_71 by qsmk</span></span>
<span id="cb127-123"><a href="outcome-regression-and-propensity-scores.html#cb127-123" tabindex="-1"></a><span class="co">#&gt; t = -1.5925, df = 142.72, p-value = 0.1135</span></span>
<span id="cb127-124"><a href="outcome-regression-and-propensity-scores.html#cb127-124" tabindex="-1"></a><span class="co">#&gt; alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0</span></span>
<span id="cb127-125"><a href="outcome-regression-and-propensity-scores.html#cb127-125" tabindex="-1"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb127-126"><a href="outcome-regression-and-propensity-scores.html#cb127-126" tabindex="-1"></a><span class="co">#&gt;  -5.0209284  0.5404697</span></span>
<span id="cb127-127"><a href="outcome-regression-and-propensity-scores.html#cb127-127" tabindex="-1"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb127-128"><a href="outcome-regression-and-propensity-scores.html#cb127-128" tabindex="-1"></a><span class="co">#&gt; mean in group 0 mean in group 1 </span></span>
<span id="cb127-129"><a href="outcome-regression-and-propensity-scores.html#cb127-129" tabindex="-1"></a><span class="co">#&gt;      -0.5043766       1.7358528</span></span></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="outcome-regression-and-propensity-scores.html#cb128-1" tabindex="-1"></a></span>
<span id="cb128-2"><a href="outcome-regression-and-propensity-scores.html#cb128-2" tabindex="-1"></a><span class="co"># regression on PS deciles, not allowing for effect modification</span></span>
<span id="cb128-3"><a href="outcome-regression-and-propensity-scores.html#cb128-3" tabindex="-1"></a>fit.psdec <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> <span class="fu">as.factor</span>(ps.dec), <span class="at">data =</span> nhefs)</span>
<span id="cb128-4"><a href="outcome-regression-and-propensity-scores.html#cb128-4" tabindex="-1"></a><span class="fu">summary</span>(fit.psdec)</span>
<span id="cb128-5"><a href="outcome-regression-and-propensity-scores.html#cb128-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb128-6"><a href="outcome-regression-and-propensity-scores.html#cb128-6" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb128-7"><a href="outcome-regression-and-propensity-scores.html#cb128-7" tabindex="-1"></a><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + as.factor(ps.dec), data = nhefs)</span></span>
<span id="cb128-8"><a href="outcome-regression-and-propensity-scores.html#cb128-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb128-9"><a href="outcome-regression-and-propensity-scores.html#cb128-9" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb128-10"><a href="outcome-regression-and-propensity-scores.html#cb128-10" tabindex="-1"></a><span class="co">#&gt;                     Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb128-11"><a href="outcome-regression-and-propensity-scores.html#cb128-11" tabindex="-1"></a><span class="co">#&gt; (Intercept)           3.7505     0.6089   6.159 9.29e-10 ***</span></span>
<span id="cb128-12"><a href="outcome-regression-and-propensity-scores.html#cb128-12" tabindex="-1"></a><span class="co">#&gt; qsmk                  3.5005     0.4571   7.659 3.28e-14 ***</span></span>
<span id="cb128-13"><a href="outcome-regression-and-propensity-scores.html#cb128-13" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)2   -0.7391     0.8611  -0.858   0.3908    </span></span>
<span id="cb128-14"><a href="outcome-regression-and-propensity-scores.html#cb128-14" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)3   -0.6182     0.8612  -0.718   0.4730    </span></span>
<span id="cb128-15"><a href="outcome-regression-and-propensity-scores.html#cb128-15" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)4   -0.5204     0.8584  -0.606   0.5444    </span></span>
<span id="cb128-16"><a href="outcome-regression-and-propensity-scores.html#cb128-16" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)5   -1.4884     0.8590  -1.733   0.0834 .  </span></span>
<span id="cb128-17"><a href="outcome-regression-and-propensity-scores.html#cb128-17" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)6   -1.6227     0.8675  -1.871   0.0616 .  </span></span>
<span id="cb128-18"><a href="outcome-regression-and-propensity-scores.html#cb128-18" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)7   -1.9853     0.8681  -2.287   0.0223 *  </span></span>
<span id="cb128-19"><a href="outcome-regression-and-propensity-scores.html#cb128-19" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)8   -3.4447     0.8749  -3.937 8.61e-05 ***</span></span>
<span id="cb128-20"><a href="outcome-regression-and-propensity-scores.html#cb128-20" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)9   -5.1544     0.8848  -5.825 6.91e-09 ***</span></span>
<span id="cb128-21"><a href="outcome-regression-and-propensity-scores.html#cb128-21" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)10  -4.8403     0.8828  -5.483 4.87e-08 ***</span></span>
<span id="cb128-22"><a href="outcome-regression-and-propensity-scores.html#cb128-22" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb128-23"><a href="outcome-regression-and-propensity-scores.html#cb128-23" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb128-24"><a href="outcome-regression-and-propensity-scores.html#cb128-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb128-25"><a href="outcome-regression-and-propensity-scores.html#cb128-25" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 58.42297)</span></span>
<span id="cb128-26"><a href="outcome-regression-and-propensity-scores.html#cb128-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb128-27"><a href="outcome-regression-and-propensity-scores.html#cb128-27" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span id="cb128-28"><a href="outcome-regression-and-propensity-scores.html#cb128-28" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 90848  on 1555  degrees of freedom</span></span>
<span id="cb128-29"><a href="outcome-regression-and-propensity-scores.html#cb128-29" tabindex="-1"></a><span class="co">#&gt;   (63 observations deleted due to missingness)</span></span>
<span id="cb128-30"><a href="outcome-regression-and-propensity-scores.html#cb128-30" tabindex="-1"></a><span class="co">#&gt; AIC: 10827</span></span>
<span id="cb128-31"><a href="outcome-regression-and-propensity-scores.html#cb128-31" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb128-32"><a href="outcome-regression-and-propensity-scores.html#cb128-32" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="outcome-regression-and-propensity-scores.html#cb129-1" tabindex="-1"></a><span class="fu">confint.lm</span>(fit.psdec)</span>
<span id="cb129-2"><a href="outcome-regression-and-propensity-scores.html#cb129-2" tabindex="-1"></a><span class="co">#&gt;                         2.5 %      97.5 %</span></span>
<span id="cb129-3"><a href="outcome-regression-and-propensity-scores.html#cb129-3" tabindex="-1"></a><span class="co">#&gt; (Intercept)          2.556098  4.94486263</span></span>
<span id="cb129-4"><a href="outcome-regression-and-propensity-scores.html#cb129-4" tabindex="-1"></a><span class="co">#&gt; qsmk                 2.603953  4.39700504</span></span>
<span id="cb129-5"><a href="outcome-regression-and-propensity-scores.html#cb129-5" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)2  -2.428074  0.94982494</span></span>
<span id="cb129-6"><a href="outcome-regression-and-propensity-scores.html#cb129-6" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)3  -2.307454  1.07103569</span></span>
<span id="cb129-7"><a href="outcome-regression-and-propensity-scores.html#cb129-7" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)4  -2.204103  1.16333143</span></span>
<span id="cb129-8"><a href="outcome-regression-and-propensity-scores.html#cb129-8" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)5  -3.173337  0.19657938</span></span>
<span id="cb129-9"><a href="outcome-regression-and-propensity-scores.html#cb129-9" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)6  -3.324345  0.07893027</span></span>
<span id="cb129-10"><a href="outcome-regression-and-propensity-scores.html#cb129-10" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)7  -3.688043 -0.28248110</span></span>
<span id="cb129-11"><a href="outcome-regression-and-propensity-scores.html#cb129-11" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)8  -5.160862 -1.72860113</span></span>
<span id="cb129-12"><a href="outcome-regression-and-propensity-scores.html#cb129-12" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)9  -6.889923 -3.41883853</span></span>
<span id="cb129-13"><a href="outcome-regression-and-propensity-scores.html#cb129-13" tabindex="-1"></a><span class="co">#&gt; as.factor(ps.dec)10 -6.571789 -3.10873731</span></span></code></pre></div>
</div>
<div id="program-15.4" class="section level2 hasAnchor">
<h2>Program 15.4<a href="outcome-regression-and-propensity-scores.html#program-15.4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Standardization using the propensity score</li>
<li>Data from NHEFS</li>
</ul>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="outcome-regression-and-propensity-scores.html#cb130-1" tabindex="-1"></a><span class="co">#install.packages(&quot;boot&quot;) # install package if required</span></span>
<span id="cb130-2"><a href="outcome-regression-and-propensity-scores.html#cb130-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;boot&quot;</span>)</span>
<span id="cb130-3"><a href="outcome-regression-and-propensity-scores.html#cb130-3" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb130-4"><a href="outcome-regression-and-propensity-scores.html#cb130-4" tabindex="-1"></a><span class="co">#&gt; Attaching package: &#39;boot&#39;</span></span>
<span id="cb130-5"><a href="outcome-regression-and-propensity-scores.html#cb130-5" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:psych&#39;:</span></span>
<span id="cb130-6"><a href="outcome-regression-and-propensity-scores.html#cb130-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb130-7"><a href="outcome-regression-and-propensity-scores.html#cb130-7" tabindex="-1"></a><span class="co">#&gt;     logit</span></span>
<span id="cb130-8"><a href="outcome-regression-and-propensity-scores.html#cb130-8" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:survival&#39;:</span></span>
<span id="cb130-9"><a href="outcome-regression-and-propensity-scores.html#cb130-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb130-10"><a href="outcome-regression-and-propensity-scores.html#cb130-10" tabindex="-1"></a><span class="co">#&gt;     aml</span></span></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="outcome-regression-and-propensity-scores.html#cb131-1" tabindex="-1"></a></span>
<span id="cb131-2"><a href="outcome-regression-and-propensity-scores.html#cb131-2" tabindex="-1"></a><span class="co"># standardization by propensity score, agnostic regarding effect modification</span></span>
<span id="cb131-3"><a href="outcome-regression-and-propensity-scores.html#cb131-3" tabindex="-1"></a>std.ps <span class="ot">&lt;-</span> <span class="cf">function</span>(data, indices) {</span>
<span id="cb131-4"><a href="outcome-regression-and-propensity-scores.html#cb131-4" tabindex="-1"></a>  d <span class="ot">&lt;-</span> data[indices,] <span class="co"># 1st copy: equal to original one`</span></span>
<span id="cb131-5"><a href="outcome-regression-and-propensity-scores.html#cb131-5" tabindex="-1"></a>  <span class="co"># calculating propensity scores</span></span>
<span id="cb131-6"><a href="outcome-regression-and-propensity-scores.html#cb131-6" tabindex="-1"></a>  ps.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">*</span>age)</span>
<span id="cb131-7"><a href="outcome-regression-and-propensity-scores.html#cb131-7" tabindex="-1"></a>                <span class="sc">+</span> <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity</span>
<span id="cb131-8"><a href="outcome-regression-and-propensity-scores.html#cb131-8" tabindex="-1"></a>                <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">*</span>smokeintensity) <span class="sc">+</span> smokeyrs</span>
<span id="cb131-9"><a href="outcome-regression-and-propensity-scores.html#cb131-9" tabindex="-1"></a>                <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">*</span>smokeyrs) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise)</span>
<span id="cb131-10"><a href="outcome-regression-and-propensity-scores.html#cb131-10" tabindex="-1"></a>                <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span> wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">*</span>wt71),</span>
<span id="cb131-11"><a href="outcome-regression-and-propensity-scores.html#cb131-11" tabindex="-1"></a>                <span class="at">data=</span>d, <span class="at">family=</span><span class="fu">binomial</span>())</span>
<span id="cb131-12"><a href="outcome-regression-and-propensity-scores.html#cb131-12" tabindex="-1"></a>  d<span class="sc">$</span>pscore <span class="ot">&lt;-</span> <span class="fu">predict</span>(ps.fit, d, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb131-13"><a href="outcome-regression-and-propensity-scores.html#cb131-13" tabindex="-1"></a></span>
<span id="cb131-14"><a href="outcome-regression-and-propensity-scores.html#cb131-14" tabindex="-1"></a>  <span class="co"># create a dataset with 3 copies of each subject</span></span>
<span id="cb131-15"><a href="outcome-regression-and-propensity-scores.html#cb131-15" tabindex="-1"></a>  d<span class="sc">$</span>interv <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span> <span class="co"># 1st copy: equal to original one`</span></span>
<span id="cb131-16"><a href="outcome-regression-and-propensity-scores.html#cb131-16" tabindex="-1"></a>  d0 <span class="ot">&lt;-</span> d <span class="co"># 2nd copy: treatment set to 0, outcome to missing</span></span>
<span id="cb131-17"><a href="outcome-regression-and-propensity-scores.html#cb131-17" tabindex="-1"></a>  d0<span class="sc">$</span>interv <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb131-18"><a href="outcome-regression-and-propensity-scores.html#cb131-18" tabindex="-1"></a>  d0<span class="sc">$</span>qsmk <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb131-19"><a href="outcome-regression-and-propensity-scores.html#cb131-19" tabindex="-1"></a>  d0<span class="sc">$</span>wt82_71 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb131-20"><a href="outcome-regression-and-propensity-scores.html#cb131-20" tabindex="-1"></a>  d1 <span class="ot">&lt;-</span> d <span class="co"># 3rd copy: treatment set to 1, outcome to missing</span></span>
<span id="cb131-21"><a href="outcome-regression-and-propensity-scores.html#cb131-21" tabindex="-1"></a>  d1<span class="sc">$</span>interv <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb131-22"><a href="outcome-regression-and-propensity-scores.html#cb131-22" tabindex="-1"></a>  d1<span class="sc">$</span>qsmk <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb131-23"><a href="outcome-regression-and-propensity-scores.html#cb131-23" tabindex="-1"></a>  d1<span class="sc">$</span>wt82_71 <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb131-24"><a href="outcome-regression-and-propensity-scores.html#cb131-24" tabindex="-1"></a>  d.onesample <span class="ot">&lt;-</span> <span class="fu">rbind</span>(d, d0, d1) <span class="co"># combining datasets</span></span>
<span id="cb131-25"><a href="outcome-regression-and-propensity-scores.html#cb131-25" tabindex="-1"></a></span>
<span id="cb131-26"><a href="outcome-regression-and-propensity-scores.html#cb131-26" tabindex="-1"></a>  std.fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> pscore <span class="sc">+</span> <span class="fu">I</span>(qsmk<span class="sc">*</span>pscore), <span class="at">data=</span>d.onesample)</span>
<span id="cb131-27"><a href="outcome-regression-and-propensity-scores.html#cb131-27" tabindex="-1"></a>  d.onesample<span class="sc">$</span>predicted_meanY <span class="ot">&lt;-</span> <span class="fu">predict</span>(std.fit, d.onesample)</span>
<span id="cb131-28"><a href="outcome-regression-and-propensity-scores.html#cb131-28" tabindex="-1"></a></span>
<span id="cb131-29"><a href="outcome-regression-and-propensity-scores.html#cb131-29" tabindex="-1"></a>  <span class="co"># estimate mean outcome in each of the groups interv=-1, interv=0, and interv=1</span></span>
<span id="cb131-30"><a href="outcome-regression-and-propensity-scores.html#cb131-30" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==-</span><span class="dv">1</span>]),</span>
<span id="cb131-31"><a href="outcome-regression-and-propensity-scores.html#cb131-31" tabindex="-1"></a>           <span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==</span><span class="dv">0</span>]),</span>
<span id="cb131-32"><a href="outcome-regression-and-propensity-scores.html#cb131-32" tabindex="-1"></a>           <span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==</span><span class="dv">1</span>]),</span>
<span id="cb131-33"><a href="outcome-regression-and-propensity-scores.html#cb131-33" tabindex="-1"></a>           <span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==</span><span class="dv">1</span>])<span class="sc">-</span></span>
<span id="cb131-34"><a href="outcome-regression-and-propensity-scores.html#cb131-34" tabindex="-1"></a>             <span class="fu">mean</span>(d.onesample<span class="sc">$</span>predicted_meanY[d.onesample<span class="sc">$</span>interv<span class="sc">==</span><span class="dv">0</span>])))</span>
<span id="cb131-35"><a href="outcome-regression-and-propensity-scores.html#cb131-35" tabindex="-1"></a>}</span>
<span id="cb131-36"><a href="outcome-regression-and-propensity-scores.html#cb131-36" tabindex="-1"></a></span>
<span id="cb131-37"><a href="outcome-regression-and-propensity-scores.html#cb131-37" tabindex="-1"></a><span class="co"># bootstrap</span></span>
<span id="cb131-38"><a href="outcome-regression-and-propensity-scores.html#cb131-38" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">boot</span>(<span class="at">data=</span>nhefs, <span class="at">statistic=</span>std.ps, <span class="at">R=</span><span class="dv">5</span>)</span>
<span id="cb131-39"><a href="outcome-regression-and-propensity-scores.html#cb131-39" tabindex="-1"></a></span>
<span id="cb131-40"><a href="outcome-regression-and-propensity-scores.html#cb131-40" tabindex="-1"></a><span class="co"># generating confidence intervals</span></span>
<span id="cb131-41"><a href="outcome-regression-and-propensity-scores.html#cb131-41" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sd</span>(results<span class="sc">$</span>t[,<span class="dv">1</span>]), <span class="fu">sd</span>(results<span class="sc">$</span>t[,<span class="dv">2</span>]),</span>
<span id="cb131-42"><a href="outcome-regression-and-propensity-scores.html#cb131-42" tabindex="-1"></a>        <span class="fu">sd</span>(results<span class="sc">$</span>t[,<span class="dv">3</span>]), <span class="fu">sd</span>(results<span class="sc">$</span>t[,<span class="dv">4</span>]))</span>
<span id="cb131-43"><a href="outcome-regression-and-propensity-scores.html#cb131-43" tabindex="-1"></a>mean <span class="ot">&lt;-</span> results<span class="sc">$</span>t0</span>
<span id="cb131-44"><a href="outcome-regression-and-propensity-scores.html#cb131-44" tabindex="-1"></a>ll <span class="ot">&lt;-</span> mean <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>se</span>
<span id="cb131-45"><a href="outcome-regression-and-propensity-scores.html#cb131-45" tabindex="-1"></a>ul <span class="ot">&lt;-</span> mean <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>)<span class="sc">*</span>se</span>
<span id="cb131-46"><a href="outcome-regression-and-propensity-scores.html#cb131-46" tabindex="-1"></a></span>
<span id="cb131-47"><a href="outcome-regression-and-propensity-scores.html#cb131-47" tabindex="-1"></a>bootstrap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="st">&quot;Observed&quot;</span>, <span class="st">&quot;No Treatment&quot;</span>, <span class="st">&quot;Treatment&quot;</span>,</span>
<span id="cb131-48"><a href="outcome-regression-and-propensity-scores.html#cb131-48" tabindex="-1"></a>                                <span class="st">&quot;Treatment - No Treatment&quot;</span>), mean, se, ll, ul))</span>
<span id="cb131-49"><a href="outcome-regression-and-propensity-scores.html#cb131-49" tabindex="-1"></a>bootstrap</span>
<span id="cb131-50"><a href="outcome-regression-and-propensity-scores.html#cb131-50" tabindex="-1"></a><span class="co">#&gt;                         V1             mean                se               ll</span></span>
<span id="cb131-51"><a href="outcome-regression-and-propensity-scores.html#cb131-51" tabindex="-1"></a><span class="co">#&gt; 1                 Observed 2.63384609228479 0.257431993398983 2.12928865675443</span></span>
<span id="cb131-52"><a href="outcome-regression-and-propensity-scores.html#cb131-52" tabindex="-1"></a><span class="co">#&gt; 2             No Treatment 1.71983636149845 0.231785902506788 1.26554434046104</span></span>
<span id="cb131-53"><a href="outcome-regression-and-propensity-scores.html#cb131-53" tabindex="-1"></a><span class="co">#&gt; 3                Treatment 5.35072300362985 0.248611665961784 4.86345309220825</span></span>
<span id="cb131-54"><a href="outcome-regression-and-propensity-scores.html#cb131-54" tabindex="-1"></a><span class="co">#&gt; 4 Treatment - No Treatment  3.6308866421314 0.284117716001535 3.07402615139861</span></span>
<span id="cb131-55"><a href="outcome-regression-and-propensity-scores.html#cb131-55" tabindex="-1"></a><span class="co">#&gt;                 ul</span></span>
<span id="cb131-56"><a href="outcome-regression-and-propensity-scores.html#cb131-56" tabindex="-1"></a><span class="co">#&gt; 1 3.13840352781515</span></span>
<span id="cb131-57"><a href="outcome-regression-and-propensity-scores.html#cb131-57" tabindex="-1"></a><span class="co">#&gt; 2 2.17412838253587</span></span>
<span id="cb131-58"><a href="outcome-regression-and-propensity-scores.html#cb131-58" tabindex="-1"></a><span class="co">#&gt; 3 5.83799291505145</span></span>
<span id="cb131-59"><a href="outcome-regression-and-propensity-scores.html#cb131-59" tabindex="-1"></a><span class="co">#&gt; 4 4.18774713286419</span></span></code></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="outcome-regression-and-propensity-scores.html#cb132-1" tabindex="-1"></a><span class="co"># regression on the propensity score (linear term)</span></span>
<span id="cb132-2"><a href="outcome-regression-and-propensity-scores.html#cb132-2" tabindex="-1"></a>model6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> ps, <span class="at">data =</span> nhefs) <span class="co"># p.qsmk</span></span>
<span id="cb132-3"><a href="outcome-regression-and-propensity-scores.html#cb132-3" tabindex="-1"></a><span class="fu">summary</span>(model6)</span>
<span id="cb132-4"><a href="outcome-regression-and-propensity-scores.html#cb132-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb132-5"><a href="outcome-regression-and-propensity-scores.html#cb132-5" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb132-6"><a href="outcome-regression-and-propensity-scores.html#cb132-6" tabindex="-1"></a><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + ps, data = nhefs)</span></span>
<span id="cb132-7"><a href="outcome-regression-and-propensity-scores.html#cb132-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb132-8"><a href="outcome-regression-and-propensity-scores.html#cb132-8" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb132-9"><a href="outcome-regression-and-propensity-scores.html#cb132-9" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb132-10"><a href="outcome-regression-and-propensity-scores.html#cb132-10" tabindex="-1"></a><span class="co">#&gt; (Intercept)   5.5945     0.4831  11.581  &lt; 2e-16 ***</span></span>
<span id="cb132-11"><a href="outcome-regression-and-propensity-scores.html#cb132-11" tabindex="-1"></a><span class="co">#&gt; qsmk          3.5506     0.4573   7.765 1.47e-14 ***</span></span>
<span id="cb132-12"><a href="outcome-regression-and-propensity-scores.html#cb132-12" tabindex="-1"></a><span class="co">#&gt; ps          -14.8218     1.7576  -8.433  &lt; 2e-16 ***</span></span>
<span id="cb132-13"><a href="outcome-regression-and-propensity-scores.html#cb132-13" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb132-14"><a href="outcome-regression-and-propensity-scores.html#cb132-14" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb132-15"><a href="outcome-regression-and-propensity-scores.html#cb132-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb132-16"><a href="outcome-regression-and-propensity-scores.html#cb132-16" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 58.28455)</span></span>
<span id="cb132-17"><a href="outcome-regression-and-propensity-scores.html#cb132-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb132-18"><a href="outcome-regression-and-propensity-scores.html#cb132-18" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span id="cb132-19"><a href="outcome-regression-and-propensity-scores.html#cb132-19" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 91099  on 1563  degrees of freedom</span></span>
<span id="cb132-20"><a href="outcome-regression-and-propensity-scores.html#cb132-20" tabindex="-1"></a><span class="co">#&gt;   (63 observations deleted due to missingness)</span></span>
<span id="cb132-21"><a href="outcome-regression-and-propensity-scores.html#cb132-21" tabindex="-1"></a><span class="co">#&gt; AIC: 10815</span></span>
<span id="cb132-22"><a href="outcome-regression-and-propensity-scores.html#cb132-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb132-23"><a href="outcome-regression-and-propensity-scores.html#cb132-23" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="outcome-regression-and-propensity-scores.html#cb133-1" tabindex="-1"></a></span>
<span id="cb133-2"><a href="outcome-regression-and-propensity-scores.html#cb133-2" tabindex="-1"></a><span class="co"># standarization on the propensity score</span></span>
<span id="cb133-3"><a href="outcome-regression-and-propensity-scores.html#cb133-3" tabindex="-1"></a><span class="co"># (step 1) create two new datasets, one with all treated and one with all untreated</span></span>
<span id="cb133-4"><a href="outcome-regression-and-propensity-scores.html#cb133-4" tabindex="-1"></a>treated <span class="ot">&lt;-</span> nhefs</span>
<span id="cb133-5"><a href="outcome-regression-and-propensity-scores.html#cb133-5" tabindex="-1"></a>  treated<span class="sc">$</span>qsmk <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb133-6"><a href="outcome-regression-and-propensity-scores.html#cb133-6" tabindex="-1"></a></span>
<span id="cb133-7"><a href="outcome-regression-and-propensity-scores.html#cb133-7" tabindex="-1"></a>untreated <span class="ot">&lt;-</span> nhefs</span>
<span id="cb133-8"><a href="outcome-regression-and-propensity-scores.html#cb133-8" tabindex="-1"></a>  untreated<span class="sc">$</span>qsmk <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb133-9"><a href="outcome-regression-and-propensity-scores.html#cb133-9" tabindex="-1"></a></span>
<span id="cb133-10"><a href="outcome-regression-and-propensity-scores.html#cb133-10" tabindex="-1"></a><span class="co"># (step 2) predict values for everyone in each new dataset based on above model</span></span>
<span id="cb133-11"><a href="outcome-regression-and-propensity-scores.html#cb133-11" tabindex="-1"></a>treated<span class="sc">$</span>pred.y <span class="ot">&lt;-</span> <span class="fu">predict</span>(model6, treated)</span>
<span id="cb133-12"><a href="outcome-regression-and-propensity-scores.html#cb133-12" tabindex="-1"></a>untreated<span class="sc">$</span>pred.y <span class="ot">&lt;-</span> <span class="fu">predict</span>(model6, untreated)</span>
<span id="cb133-13"><a href="outcome-regression-and-propensity-scores.html#cb133-13" tabindex="-1"></a></span>
<span id="cb133-14"><a href="outcome-regression-and-propensity-scores.html#cb133-14" tabindex="-1"></a><span class="co"># (step 3) compare mean weight loss had all been treated vs. that had all been untreated</span></span>
<span id="cb133-15"><a href="outcome-regression-and-propensity-scores.html#cb133-15" tabindex="-1"></a>mean1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(treated<span class="sc">$</span>pred.y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb133-16"><a href="outcome-regression-and-propensity-scores.html#cb133-16" tabindex="-1"></a>mean0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(untreated<span class="sc">$</span>pred.y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb133-17"><a href="outcome-regression-and-propensity-scores.html#cb133-17" tabindex="-1"></a>mean1</span>
<span id="cb133-18"><a href="outcome-regression-and-propensity-scores.html#cb133-18" tabindex="-1"></a><span class="co">#&gt; [1] 5.250824</span></span></code></pre></div>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="outcome-regression-and-propensity-scores.html#cb134-1" tabindex="-1"></a>mean0</span>
<span id="cb134-2"><a href="outcome-regression-and-propensity-scores.html#cb134-2" tabindex="-1"></a><span class="co">#&gt; [1] 1.700228</span></span></code></pre></div>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="outcome-regression-and-propensity-scores.html#cb135-1" tabindex="-1"></a>mean1 <span class="sc">-</span> mean0</span>
<span id="cb135-2"><a href="outcome-regression-and-propensity-scores.html#cb135-2" tabindex="-1"></a><span class="co">#&gt; [1] 3.550596</span></span></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="outcome-regression-and-propensity-scores.html#cb136-1" tabindex="-1"></a></span>
<span id="cb136-2"><a href="outcome-regression-and-propensity-scores.html#cb136-2" tabindex="-1"></a><span class="co"># (step 4) bootstrap a confidence interval</span></span>
<span id="cb136-3"><a href="outcome-regression-and-propensity-scores.html#cb136-3" tabindex="-1"></a><span class="co"># number of bootstraps</span></span>
<span id="cb136-4"><a href="outcome-regression-and-propensity-scores.html#cb136-4" tabindex="-1"></a>nboot <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb136-5"><a href="outcome-regression-and-propensity-scores.html#cb136-5" tabindex="-1"></a><span class="co"># set up a matrix to store results</span></span>
<span id="cb136-6"><a href="outcome-regression-and-propensity-scores.html#cb136-6" tabindex="-1"></a>boots <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>nboot,</span>
<span id="cb136-7"><a href="outcome-regression-and-propensity-scores.html#cb136-7" tabindex="-1"></a>                    <span class="at">mean1 =</span> <span class="cn">NA</span>,</span>
<span id="cb136-8"><a href="outcome-regression-and-propensity-scores.html#cb136-8" tabindex="-1"></a>                    <span class="at">mean0 =</span> <span class="cn">NA</span>,</span>
<span id="cb136-9"><a href="outcome-regression-and-propensity-scores.html#cb136-9" tabindex="-1"></a>                    <span class="at">difference =</span> <span class="cn">NA</span>)</span>
<span id="cb136-10"><a href="outcome-regression-and-propensity-scores.html#cb136-10" tabindex="-1"></a><span class="co"># loop to perform the bootstrapping</span></span>
<span id="cb136-11"><a href="outcome-regression-and-propensity-scores.html#cb136-11" tabindex="-1"></a>nhefs <span class="ot">&lt;-</span> <span class="fu">subset</span>(nhefs, <span class="sc">!</span><span class="fu">is.na</span>(ps) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wt82_71)) <span class="co"># p.qsmk</span></span>
<span id="cb136-12"><a href="outcome-regression-and-propensity-scores.html#cb136-12" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nboot) {</span>
<span id="cb136-13"><a href="outcome-regression-and-propensity-scores.html#cb136-13" tabindex="-1"></a>  <span class="co"># sample with replacement</span></span>
<span id="cb136-14"><a href="outcome-regression-and-propensity-scores.html#cb136-14" tabindex="-1"></a>  sampl <span class="ot">&lt;-</span> nhefs[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(nhefs), <span class="fu">nrow</span>(nhefs), <span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb136-15"><a href="outcome-regression-and-propensity-scores.html#cb136-15" tabindex="-1"></a></span>
<span id="cb136-16"><a href="outcome-regression-and-propensity-scores.html#cb136-16" tabindex="-1"></a>  <span class="co"># fit the model in the bootstrap sample</span></span>
<span id="cb136-17"><a href="outcome-regression-and-propensity-scores.html#cb136-17" tabindex="-1"></a>  bootmod <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> ps, <span class="at">data =</span> sampl) <span class="co"># ps</span></span>
<span id="cb136-18"><a href="outcome-regression-and-propensity-scores.html#cb136-18" tabindex="-1"></a></span>
<span id="cb136-19"><a href="outcome-regression-and-propensity-scores.html#cb136-19" tabindex="-1"></a>  <span class="co"># create new datasets</span></span>
<span id="cb136-20"><a href="outcome-regression-and-propensity-scores.html#cb136-20" tabindex="-1"></a>  sampl.treated <span class="ot">&lt;-</span> sampl <span class="sc">%&gt;%</span></span>
<span id="cb136-21"><a href="outcome-regression-and-propensity-scores.html#cb136-21" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">qsmk =</span> <span class="dv">1</span>)</span>
<span id="cb136-22"><a href="outcome-regression-and-propensity-scores.html#cb136-22" tabindex="-1"></a></span>
<span id="cb136-23"><a href="outcome-regression-and-propensity-scores.html#cb136-23" tabindex="-1"></a>  sampl.untreated <span class="ot">&lt;-</span> sampl <span class="sc">%&gt;%</span></span>
<span id="cb136-24"><a href="outcome-regression-and-propensity-scores.html#cb136-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">qsmk =</span> <span class="dv">0</span>)</span>
<span id="cb136-25"><a href="outcome-regression-and-propensity-scores.html#cb136-25" tabindex="-1"></a></span>
<span id="cb136-26"><a href="outcome-regression-and-propensity-scores.html#cb136-26" tabindex="-1"></a>  <span class="co"># predict values</span></span>
<span id="cb136-27"><a href="outcome-regression-and-propensity-scores.html#cb136-27" tabindex="-1"></a>  sampl.treated<span class="sc">$</span>pred.y <span class="ot">&lt;-</span> <span class="fu">predict</span>(bootmod, sampl.treated)</span>
<span id="cb136-28"><a href="outcome-regression-and-propensity-scores.html#cb136-28" tabindex="-1"></a>  sampl.untreated<span class="sc">$</span>pred.y <span class="ot">&lt;-</span> <span class="fu">predict</span>(bootmod, sampl.untreated)</span>
<span id="cb136-29"><a href="outcome-regression-and-propensity-scores.html#cb136-29" tabindex="-1"></a></span>
<span id="cb136-30"><a href="outcome-regression-and-propensity-scores.html#cb136-30" tabindex="-1"></a>  <span class="co"># output results</span></span>
<span id="cb136-31"><a href="outcome-regression-and-propensity-scores.html#cb136-31" tabindex="-1"></a>  boots[i, <span class="st">&#39;mean1&#39;</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(sampl.treated<span class="sc">$</span>pred.y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb136-32"><a href="outcome-regression-and-propensity-scores.html#cb136-32" tabindex="-1"></a>  boots[i, <span class="st">&#39;mean0&#39;</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(sampl.untreated<span class="sc">$</span>pred.y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb136-33"><a href="outcome-regression-and-propensity-scores.html#cb136-33" tabindex="-1"></a>  boots[i, <span class="st">&#39;difference&#39;</span>] <span class="ot">&lt;-</span> boots[i, <span class="st">&#39;mean1&#39;</span>] <span class="sc">-</span> boots[i, <span class="st">&#39;mean0&#39;</span>]</span>
<span id="cb136-34"><a href="outcome-regression-and-propensity-scores.html#cb136-34" tabindex="-1"></a></span>
<span id="cb136-35"><a href="outcome-regression-and-propensity-scores.html#cb136-35" tabindex="-1"></a>  <span class="co"># once loop is done, print the results</span></span>
<span id="cb136-36"><a href="outcome-regression-and-propensity-scores.html#cb136-36" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">==</span> nboot) {</span>
<span id="cb136-37"><a href="outcome-regression-and-propensity-scores.html#cb136-37" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&#39;95% CI for the causal mean difference</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb136-38"><a href="outcome-regression-and-propensity-scores.html#cb136-38" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">mean</span>(boots<span class="sc">$</span>difference) <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sd</span>(boots<span class="sc">$</span>difference),</span>
<span id="cb136-39"><a href="outcome-regression-and-propensity-scores.html#cb136-39" tabindex="-1"></a>        <span class="st">&#39;,&#39;</span>,</span>
<span id="cb136-40"><a href="outcome-regression-and-propensity-scores.html#cb136-40" tabindex="-1"></a>        <span class="fu">mean</span>(boots<span class="sc">$</span>difference) <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span><span class="fu">sd</span>(boots<span class="sc">$</span>difference))</span>
<span id="cb136-41"><a href="outcome-regression-and-propensity-scores.html#cb136-41" tabindex="-1"></a>  }</span>
<span id="cb136-42"><a href="outcome-regression-and-propensity-scores.html#cb136-42" tabindex="-1"></a>}</span>
<span id="cb136-43"><a href="outcome-regression-and-propensity-scores.html#cb136-43" tabindex="-1"></a><span class="co">#&gt; 95% CI for the causal mean difference</span></span>
<span id="cb136-44"><a href="outcome-regression-and-propensity-scores.html#cb136-44" tabindex="-1"></a><span class="co">#&gt; 2.585806 , 4.616634</span></span></code></pre></div>
<p>A more flexible and elegant way to do this is to write a function to perform the model fitting, prediction, bootstrapping, and reporting all at once.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="g-estimation-of-structural-nested-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="instrumental-variables-estimation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/remlapmot/cibookex-r/edit/master/15-prop-scores-r.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/remlapmot/cibookex-r/blob/master/15-prop-scores-r.Rmd",
"text": null
},
"download": ["cibookex-r.pdf", "cibookex-r.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
